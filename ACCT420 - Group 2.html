<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Isaac Tan E, Aaren Ng, Law Qi Xue, Akshay Bryan, Justin Ryan Sy Yu">

<title>ACCT420 Group 2 Final Report</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="ACCT420 - Group 2_files/libs/clipboard/clipboard.min.js"></script>
<script src="ACCT420 - Group 2_files/libs/quarto-html/quarto.js"></script>
<script src="ACCT420 - Group 2_files/libs/quarto-html/popper.min.js"></script>
<script src="ACCT420 - Group 2_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="ACCT420 - Group 2_files/libs/quarto-html/anchor.min.js"></script>
<link href="ACCT420 - Group 2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="ACCT420 - Group 2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="ACCT420 - Group 2_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="ACCT420 - Group 2_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="ACCT420 - Group 2_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">ACCT420 Group 2 Final Report</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Isaac Tan E, Aaren Ng, Law Qi Xue, Akshay Bryan, Justin Ryan Sy Yu </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="accounting-manipulation-importance-of-detection-in-healthcare" class="level1">
<h1>1. Accounting Manipulation &amp; Importance of Detection in Healthcare</h1>
<section id="overview-accounting-manipulation-in-healthcare" class="level2">
<h2 class="anchored" data-anchor-id="overview-accounting-manipulation-in-healthcare">1.1 Overview: Accounting Manipulation in Healthcare</h2>
<p>Accounting manipulation refers to the intentional misrepresentation of financial information to present a misleading picture of a company’s financial health. In the healthcare sector, such practices can include inflating revenues through fraudulent billing, misclassifying expenses, or overstating asset values. These actions may be driven by motives to meet financial targets, attract investments, or evade regulatory scrutiny.</p>
<p>A notable example is the Theranos scandal, where founder Elizabeth Holmes and former president Ramesh Balwani were convicted of wire fraud and conspiracy after misleading investors and patients about the capabilities of their blood-testing technology (United States v. Holmes, 2022). This case resulted in significant financial losses and undermined trust in healthcare innovations.</p>
<p>Another case is Kangmei Pharmaceutical, a Chinese company that overstated its revenue by 29 billion RMB and inflated its cash holdings by 88.7 billion RMB between 2016 and 2019 (Chen &amp; Li, 2022). This deception led to severe financial restatements and highlighted the risks of inadequate financial regulation in the healthcare sector.</p>
</section>
<section id="importance-of-detection-in-healthcare" class="level2">
<h2 class="anchored" data-anchor-id="importance-of-detection-in-healthcare">1.2 Importance of Detection in Healthcare</h2>
<p>Detecting accounting manipulation in healthcare is vital due to its far-reaching consequences, including financial losses, compromised patient care, and erosion of public trust. Recent enforcement actions underscore the significance of vigilance in this area.</p>
<p>In 2023, Cigna Group agreed to pay over $172 million to settle allegations of submitting false diagnosis codes to Medicare Advantage, which led to inflated reimbursements (HG.org, 2023). This case emphasizes the need for accurate reporting and the potential repercussions of fraudulent practices.</p>
<p>Similarly, in 2024, Community Health Network Inc.&nbsp;(CHN), an integrated health system, agreed to pay $345 million to resolve allegations of violating the Stark Law by compensating physicians above fair market value and providing incentive-based bonuses tied to referral volumes (JD Supra, 2024). This settlement highlights the importance of adhering to fair compensation practices and the legal risks of non-compliance.</p>
<p>These cases illustrate the critical need for robust detection mechanisms to identify and prevent accounting manipulation in healthcare. Implementing stringent internal controls, conducting regular audits, and fostering a culture of transparency are essential steps in safeguarding the integrity of financial reporting within the industry.</p>
</section>
</section>
<section id="dependent-independent-variables-and-analysis-method" class="level1">
<h1>2. Dependent, Independent Variables and Analysis Method</h1>
<p>Given the high stakes involved, detecting accounting manipulation in the healthcare industry is critical. By analyzing financial indicators such as current ratio, debt-to-equity ratio, overvaluation, and restatement of financial statements, stakeholders can identify red flags that signal potential fraud or financial misrepresentation. This study aims to develop models that predict and detect these manipulations, ensuring greater transparency and accountability within the healthcare sector.</p>
<section id="dependent-variables" class="level2">
<h2 class="anchored" data-anchor-id="dependent-variables">2.1 Dependent Variables</h2>
<section id="debt-to-equity-ratio" class="level3">
<h3 class="anchored" data-anchor-id="debt-to-equity-ratio">Debt-to-Equity Ratio</h3>
<p>This financial metric measures a company’s leverage by dividing total debt by total shareholders’ equity (Total Debt / Total Equity). We selected this ratio as an indicator of financial health and potential business failure. Companies with high debt-to-equity ratios often face financial distress or may be engaging in fraudulent activities. A notable example is Lehman Brothers, whose ratio exceeded 30:1 before its collapse (Berman &amp; Knight, 2009). Similarly, Valeant Pharmaceuticals (now Bausch Health) exemplifies how excessive leverage can lead to financial distress. Between 2010-2015, Valeant pursued an aggressive acquisition strategy financed primarily through debt, causing its debt-to-equity ratio to soar above 5:1 (Ingram &amp; Malenko, 2022). This unsustainable debt burden, combined with accounting irregularities and pricing controversies, triggered a severe stock price collapse in 2015-2016, with the company losing over 90% of its market value (Tan &amp; Benoit, 2017). Valeant’s subsequent years were marked by asset sales, debt restructuring, and a comprehensive business model overhaul as the company struggled to recover from its debt-fueled expansion strategy (Gelles &amp; de la Merced, 2018).</p>
<p>Since our analysis spans multiple industries with varying financial structures, we’ve established industry-specific thresholds for this metric. A company will receive a positive indicator if its debt-to-equity ratio exceeds its industry’s threshold or falls below zero. These thresholds are based on estimated industry norms, as precise standards are not universally established.</p>
<section id="drugs-cosmetics-and-healthcare-3400" class="level4">
<h4 class="anchored" data-anchor-id="drugs-cosmetics-and-healthcare-3400">Drugs, Cosmetics, and Healthcare (3400)</h4>
<p>Debt-to-Equity Threshold: &gt; 1.5 Industry Norm: Approximately 1.0 (CSIMarket, 2024) Rationale: This sector benefits from stable healthcare revenue streams and requires less capital investment, resulting in moderate leverage needs.</p>
</section>
<section id="diversified-3410" class="level4">
<h4 class="anchored" data-anchor-id="diversified-3410">Diversified (3410)</h4>
<p>Debt-to-Equity Threshold: &gt; 2.5 Industry Norm: Around 2.0 (Damodaran, 2025) Rationale: Conglomerates typically maintain higher leverage to support multiple business segments and finance strategic acquisitions across diverse industries.</p>
</section>
<section id="cosmetics-toiletries-3420" class="level4">
<h4 class="anchored" data-anchor-id="cosmetics-toiletries-3420">Cosmetics &amp; Toiletries (3420)</h4>
<p>Debt-to-Equity Threshold: &gt; 1.5 Industry Norm: Generally below 1.0 (FullRatio, 2025) Rationale: This sector prioritizes branding and production capabilities over capital-intensive R&amp;D, allowing for lower leverage ratios.</p>
</section>
<section id="ethical-drug-manufacturers-3430" class="level4">
<h4 class="anchored" data-anchor-id="ethical-drug-manufacturers-3430">Ethical Drug Manufacturers (3430)</h4>
<p>Debt-to-Equity Threshold: &gt; 2.5 Industry Norm: Approximately 2.0 Rationale: Pharmaceutical companies maintain higher leverage to fund substantial R&amp;D investments, exemplified by Eli Lilly’s 2.18 ratio in 2025 (Investopedia, 2025).</p>
</section>
<section id="medical-surgical-dental-suppliers-3440" class="level4">
<h4 class="anchored" data-anchor-id="medical-surgical-dental-suppliers-3440">Medical, Surgical &amp; Dental Suppliers (3440)</h4>
<p>Debt-to-Equity Threshold: &gt; 1.5 Industry Norm: Generally below 1.0 (CSIMarket, 2024) Rationale: These suppliers typically require less R&amp;D investment, allowing them to operate with lower debt levels.</p>
</section>
<section id="drug-store-chains-7040" class="level4">
<h4 class="anchored" data-anchor-id="drug-store-chains-7040">Drug Store Chains (7040)</h4>
<p>Debt-to-Equity Threshold: &gt; 2.5 Industry Norm: 1.0 to 2.0 (CSIMarket, 2024) Rationale: Retail pharmacy chains often leverage debt to finance real estate expansion and maintain substantial inventory requirements.</p>
</section>
<section id="medical-services-8550" class="level4">
<h4 class="anchored" data-anchor-id="medical-services-8550">Medical Services (8550)</h4>
<p>Debt-to-Equity Threshold: &gt; 2.5 Industry Norm: 0.8 to 2.0 (ReadyRatios, 2023) Rationale: Healthcare providers show considerable variation in leverage, reflecting diverse approaches to funding infrastructure development and operational requirements.</p>
</section>
</section>
<section id="current-ratio" class="level3">
<h3 class="anchored" data-anchor-id="current-ratio">Current Ratio</h3>
<p>The Current Ratio is calculated by dividing Current Assets by Current Liabilities, measuring a company’s short-term liquidity and ability to meet immediate financial obligations. The optimal range typically falls between 1 and 2.5. A ratio below 1 indicates that a company may not have sufficient assets to cover its short-term obligations, potentially signaling financial distress or insolvency risk. Conversely, a ratio exceeding 2.5 may indicate excessive inventory accumulation or difficulties in collecting accounts receivable.One of the most notable case of current ratio being an indicator of fraud is the Satyam Computer Services scandal of 2009, known as ‘India’s Enron,’ which exemplifies how an abnormally high and suspiciously stable current ratio served as a key indicator of financial statement fraud, with the company ultimately admitting to inflating cash balances by over $1 billion while overstating accounts receivable, creating a deceptively healthy liquidity position (Bhasin, 2013).</p>
<p>In fraud detection modeling, monitoring abnormal current ratios is crucial as they often provide early indications of financial manipulation. Our model incorporates industry-specific thresholds for this metric, allowing for more effective identification of potential fraud indicators—particularly when these anomalies occur in conjunction with other risk factors. This approach significantly enhances the model’s overall fraud detection capabilities.</p>
<section id="drugs-cosmetics-and-healthcare-3400-1" class="level4">
<h4 class="anchored" data-anchor-id="drugs-cosmetics-and-healthcare-3400-1">Drugs, Cosmetics, and Healthcare (3400)</h4>
<p>Current Ratio Threshold: &lt; 1.3 or &gt; 2.5 Industry Norm: 1.3 to 2.5 Rationale: This diverse sector follows typical liquidity patterns. We’ve conservatively elevated the minimum threshold to 1.3 to account for the industry’s breadth.</p>
</section>
<section id="diversified-3410-1" class="level4">
<h4 class="anchored" data-anchor-id="diversified-3410-1">Diversified (3410)</h4>
<p>Current Ratio Threshold: &lt; 1.3 or &gt; 2.5 Industry Norm: 1.3 to 2.5 Rationale: Companies with multiple revenue streams require balanced liquidity. Major conglomerates like Johnson &amp; Johnson typically maintain ratios around 2.0.</p>
</section>
<section id="cosmetics-toiletries-3420-1" class="level4">
<h4 class="anchored" data-anchor-id="cosmetics-toiletries-3420-1">Cosmetics &amp; Toiletries (3420)</h4>
<p>Current Ratio Threshold: &lt; 1.2 or &gt; 2.0 Industry Norm: 1.2 to 2.0 Rationale: This FMCG segment operates with rapid inventory turnover, requiring sufficient liquidity to manage seasonal demand fluctuations.</p>
</section>
<section id="ethical-drug-manufacturers-3430-1" class="level4">
<h4 class="anchored" data-anchor-id="ethical-drug-manufacturers-3430-1">Ethical Drug Manufacturers (3430)</h4>
<p>Current Ratio Threshold: &lt; 1.5 or &gt; 3.0 Industry Norm: 1.5 to 3.0 Rationale: Pharmaceutical firms balance substantial R&amp;D investments with strong patent-protected revenue streams. The higher upper threshold accommodates cash reserves for future research initiatives.</p>
</section>
<section id="medical-surgical-dental-suppliers-3440-1" class="level4">
<h4 class="anchored" data-anchor-id="medical-surgical-dental-suppliers-3440-1">Medical, Surgical &amp; Dental Suppliers (3440)</h4>
<p>Current Ratio Threshold: &lt; 1.5 or &gt; 2.5 Industry Norm: 1.5 to 2.5 Rationale: Higher minimum threshold reflects capital-intensive operations and the need for enhanced liquidity between major procurement cycles.</p>
</section>
<section id="drug-store-chains-7040-1" class="level4">
<h4 class="anchored" data-anchor-id="drug-store-chains-7040-1">Drug Store Chains (7040)</h4>
<p>Current Ratio Threshold: &lt; 1.0 or &gt; 1.8 Industry Norm: 1.0 to 1.8 Rationale: Retail pharmacies operate with high inventory turnover and narrow margins, justifying lower liquidity requirements.</p>
</section>
<section id="medical-services-8550-1" class="level4">
<h4 class="anchored" data-anchor-id="medical-services-8550-1">Medical Services (8550)</h4>
<p>Current Ratio Threshold: &lt; 1.2 or &gt; 2.0 Industry Norm: 1.2 to 2.0 Rationale: Healthcare providers maintain moderate liquidity due to consistent patient revenue (often subject to insurance processing delays) balanced against substantial operational expenses.</p>
</section>
</section>
<section id="restatement-of-financial-statements" class="level3">
<h3 class="anchored" data-anchor-id="restatement-of-financial-statements">Restatement of Financial Statements</h3>
<p>This indicator is flagged when the auditor requires a company to restate the figures on its financial statements due to misstatements or accounting errors. Some examples of restatements include recording higher sales revenue and lower expenses, therefore indicating higher profits, which raises suspicion of fraudulent activities. Companies with no indication of restatements are a sign of strong internal controls and reduced financial fraud, while in practice, a restatement is a formal admission that past statements were inaccurate, and it often raises red flags about a firm’s accounting practices and internal controls (Center of Audit Quality, 2002). We believe restatements are a crucial fraud detection signal, as a large majority (70%) of misstatements are due to inaccurate revenue and expense recording, rather than simple human errors (Center of Audit Quality, 2002). Healthcaer and Pharma is also the Industry with the second most restatements, taking up 14% of all restatements (Center of Audit Quality, 2002).</p>
<p>Healthcare companies in particular face heightened restatement risk due to complex revenue recognition involving multiple payors and varying reimbursement terms, which makes accurate reporting highly judgmental and error-prone. This is compounded by heavy reliance on subjective estimates—such as claims reserves and doubtful accounts—that are vulnerable to manipulation. Additionally, strict regulatory requirements and performance-linked funding create strong pressure to meet financial targets, increasing the incentive for aggressive or even fraudulent accounting practices.Therefore, we believe that whether a company would be asked to restate its accounts is an important model variable to consider and to predict as a signal for fraud.</p>
</section>
<section id="overvaluation" class="level3">
<h3 class="anchored" data-anchor-id="overvaluation">Overvaluation</h3>
<p>A company is defined to be overvalued when the market valuation of shares exceeds the book value of the company’s Net Assets less retained earnings. This could mean that investors are optimistic towards a particular healthcare company or that the company has aggressive earnings projections.</p>
</section>
</section>
<section id="independent-variables" class="level2">
<h2 class="anchored" data-anchor-id="independent-variables">2.2 Independent Variables</h2>
<section id="current-ratio-1" class="level3">
<h3 class="anchored" data-anchor-id="current-ratio-1">Current Ratio</h3>
<p>The current ratio (current assets / current liabilities) serves as a critical indicator of a company’s short-term debt payment capacity, where an abnormally high ratio may indicate asset inflation through fabricated cash or receivables designed to conceal financial distress (Investopedia, 2023). Enron’s collapse in 2001 exemplifies this risk, as the company concealed significant liabilities in off-balance-sheet entities while artificially inflating its current ratio with falsified cash and receivables; when the fraudulent activities were exposed, Enron’s actual liquidity position was revealed to be virtually nonexistent (History.com, 2019).</p>
</section>
<section id="debt-to-equity-ratio-1" class="level3">
<h3 class="anchored" data-anchor-id="debt-to-equity-ratio-1">Debt-to-Equity Ratio</h3>
<p>This fundamental metric (total debt / shareholders’ equity) quantifies a company’s leverage position, where suspiciously low ratios may conceal hidden debt obligations, while exceptionally high ratios could indicate borrowing activities intended to mask fraudulent operations (Corporate Finance Institute, 2023). WorldCom’s 2002 accounting scandal demonstrates this principle, as the company deliberately misclassified $11 billion in operating expenses as capital assets, artificially reducing its debt-to-equity ratio; when properly reclassified, the corrected ratio revealed the company’s overwhelming debt burden (BBC News, 2002).</p>
</section>
<section id="return-on-equity-roe" class="level3">
<h3 class="anchored" data-anchor-id="return-on-equity-roe">Return on Equity (ROE)</h3>
<p>ROE (net income / shareholders’ equity) provides insight into a company’s profitability relative to shareholder investment, with unusually elevated ROE potentially signaling fabricated profits designed to enhance investor confidence (The Balance, 2022). WorldCom’s fraudulent accounting practices included improperly capitalizing expenses rather than recording them as operational costs, artificially inflating the company’s ROE metrics and misleading investors about its true profitability (Investopedia, n.d.).</p>
</section>
<section id="profit-margin" class="level3">
<h3 class="anchored" data-anchor-id="profit-margin">Profit Margin</h3>
<p>Profit margin (net income / revenue) quantifies the percentage of revenue converted to profit, with unusually high or inconsistent margins potentially indicating overstated revenues or concealed costs. HealthSouth’s 2003 fraud case illustrates this warning sign, as the company reported 15% profit margins by fabricating $2.7 billion in earnings; the scheme ultimately collapsed when the reported profitability failed to correlate with actual cash flow performance (CNN Money, 2003).</p>
</section>
<section id="inventory-turnover" class="level3">
<h3 class="anchored" data-anchor-id="inventory-turnover">Inventory Turnover</h3>
<p>Inventory turnover (cost of goods sold / average inventory) measures sales efficiency and inventory management, where abnormally low turnover rates may indicate deliberately overstated inventory values intended to artificially inflate asset positions (Investopedia, 2023). Prior to its collapse, Enron exhibited unusually low inventory turnover metrics, suggesting potential manipulation of inventory valuations as part of its broader fraudulent financial reporting practices (Investopedia, n.d.).</p>
</section>
<section id="z-score" class="level3">
<h3 class="anchored" data-anchor-id="z-score">Z-Score</h3>
<p>The Z-Score combines multiple financial ratios to predict bankruptcy risk, with low scores signaling financial distress that might motivate fraudulent reporting to conceal underlying problems (Corporate Finance Institute, 2023). Lehman Brothers’ 2008 collapse exemplifies this risk, as the firm concealed approximately $50 billion in debt through “Repo 105” transactions to mask its deteriorating Z-Score; when accurately calculated, the true Z-Score would have revealed the firm’s imminent collapse risk (NY Times, 2010).</p>
</section>
<section id="working-capital" class="level3">
<h3 class="anchored" data-anchor-id="working-capital">Working Capital</h3>
<p>Working capital (current assets - current liabilities) indicates a company’s short-term financial health, with artificially inflated working capital potentially concealing insolvency through fabricated asset valuations (The Balance, 2022). A negative working capital implies that a company does not have sufficient capabilities to run its day-to-day operations. Parmalat’s massive 2003 fraud demonstrates this warning sign, as the company fabricated approximately $5 billion in cash and receivables to inflate working capital metrics; when the fraud was uncovered, the company was revealed to be fundamentally insolvent (BBC News, 2004).</p>
</section>
<section id="industry" class="level3">
<h3 class="anchored" data-anchor-id="industry">Industry</h3>
<p>Industry-specific norms provide essential context for evaluating financial metrics, with significant deviations potentially signaling the manipulation of financial data. Wirecard’s extensive fraud illustrates this concept, as the company exploited the inherent complexity of the fintech industry to conceal fraudulent accounting practices and mislead investors about its true financial condition (Rubio, 2020).</p>
</section>
<section id="restated-later" class="level3">
<h3 class="anchored" data-anchor-id="restated-later">Restated Later</h3>
<p>Financial restatements represent corrections to previously reported financial data, often resulting from fraud, making them a significant indicator of potential reporting irregularities (SEC, 2023). Some methods companies undertake to “cook the books” include overstating revenue and assets and understating expenses and liabilities, which overall helps to paint a picture of higher levels of profits and net assets than it actually is. Toshiba’s 2015 accounting scandal demonstrates this warning sign, as the company was forced to restate $1.9 billion in previously reported profits after systematically inflating earnings over a seven-year period (Pfanner, 2015).</p>
</section>
<section id="overvaluation-1" class="level3">
<h3 class="anchored" data-anchor-id="overvaluation-1">Overvaluation</h3>
<p>Overvaluation occurs when market prices substantially exceed fundamental value, often driven by artificially inflated financial metrics (Investopedia, 2023). Theranos provides a stark example of this phenomenon, as the company achieved massive market valuation through various public relations campaigns boasting their breakthrough technologies, despite having any such industry-leading methods, with the inflated valuation serving to mask underlying fraudulent activities (U.S. Department of Justice, 2022).</p>
</section>
<section id="auditor-opinion" class="level3">
<h3 class="anchored" data-anchor-id="auditor-opinion">Auditor Opinion</h3>
<p>Auditor opinions assess the accuracy and reliability of financial statements, with clean opinions issued despite underlying problems potentially concealing fraudulent activities (PCAOB, 2023). Enron’s 2001 collapse highlights this risk, as Arthur Andersen repeatedly issued unqualified opinions despite Enron’s hidden losses and questionable accounting practices, significantly delaying fraud detection and exacerbating investor losses (History.com, 2019).</p>
</section>
<section id="property-plant-and-equipment-ppe" class="level3">
<h3 class="anchored" data-anchor-id="property-plant-and-equipment-ppe">Property, Plant and Equipment (PPE)</h3>
<p>PPE accounts track tangible operational assets, with overstated valuations potentially inflating both asset positions and reported profitability (Investopedia, 2023). Some methods of overvaluing PPE include capitalising on repairs and maintenance expenses, which should be under the Profit &amp; Loss Statement, or an understatement of annual depreciation expenses, which overstated the PPE’s net book value. WorldCom’s 2002 accounting scandal illustrates this warning sign, as the company improperly classified $3.8 billion in operating expenses as PPE capital investments, artificially inflating asset values until the fraud was exposed by internal auditors (SEC, 2002).</p>
</section>
<section id="brands-patents-net" class="level3">
<h3 class="anchored" data-anchor-id="brands-patents-net">Brands, Patents, Net</h3>
<p>Intangible assets such as brands and patents present valuation challenges that can be exploited to inflate reported assets (Corporate Finance Institute, 2023). For intangible assets to be viable, its valuation should be measured based on how much a third party is willing to pay a premium over the company’s net asset valuation, which is quite subjective, allowing companies to state higher valuation of intangible assets than usual. AOL Time Warner’s 2002 accounting issues demonstrate this risk, as the company overstated intangible asset values by approximately $54 billion during its merger transaction, with the overvaluation subsequently revealed through massive writedowns (NY Times, 2002).</p>
</section>
<section id="year-on-year-change-in-revenue-change" class="level3">
<h3 class="anchored" data-anchor-id="year-on-year-change-in-revenue-change">Year on Year Change in Revenue % Change</h3>
<p>Sudden, substantial revenue increases may indicate fabricated sales transactions or improper revenue recognition (Investopedia, 2023). Enron’s 2001 collapse exemplifies this warning sign, as the company reported a 700% revenue increase between 1999-2000 through fictitious energy trades that generated reported revenue without corresponding cash flow (History.com, 2019).</p>
</section>
<section id="year-on-year-change-in-net-income" class="level3">
<h3 class="anchored" data-anchor-id="year-on-year-change-in-net-income">Year-on-Year Change in Net Income</h3>
<p>Inconsistent or unexplained net income growth patterns may signal artificial profit manipulation (The Balance, 2022), such as overstatement of revenue and understatement or omission of certain operating expenses. HealthSouth’s 2003 fraud case illustrates this indicator, as the company consistently reported 20-30% annual net income growth by fabricating financial entries that concealed $1.4 billion in fraudulent accounting (CNN Money, 2003).</p>
</section>
<section id="year-on-year-change-in-cash-flow" class="level3">
<h3 class="anchored" data-anchor-id="year-on-year-change-in-cash-flow">Year-on-Year Change in Cash Flow</h3>
<p>Cash flow trends that diverge significantly from reported profit metrics may indicate financial manipulation (Investopedia, 2023). Luckin Coffee’s accounting scandal demonstrates this warning sign, as the company reported substantial revenue growth without corresponding cash flow increases, raising suspicions that were later confirmed when extensive fraudulent activities were uncovered (SEC, 2020).</p>
</section>
<section id="year-on-year-change-in-total-debt" class="level3">
<h3 class="anchored" data-anchor-id="year-on-year-change-in-total-debt">Year-on-Year Change in Total Debt</h3>
<p>Rapid debt accumulation may indicate attempts to sustain operations through borrowing while concealing underlying financial problems (Corporate Finance Institute, 2023). Lehman Brothers’ 2008 collapse highlights this risk, as the firm concealed significant debt increases through “Repo 105” transactions, effectively masking approximately $50 billion in leveraged positions (NY Times, 2010).</p>
</section>
<section id="year-on-year-change-in-research-development" class="level3">
<h3 class="anchored" data-anchor-id="year-on-year-change-in-research-development">Year-on-Year Change in Research &amp; Development</h3>
<p>Unusual fluctuations in R&amp;D expenditures may indicate attempts to manipulate earnings or support false operational claims (Investopedia, 2023). Valeant Pharmaceuticals demonstrated this warning sign by implementing dramatic R&amp;D reductions while simultaneously reporting enhanced earnings, drawing regulatory scrutiny that preceded the company’s accounting scandal (Transparently.ai, 2021).</p>
</section>
<section id="year-on-year-change-in-accounts-receivable-days" class="level3">
<h3 class="anchored" data-anchor-id="year-on-year-change-in-accounts-receivable-days">Year-on-Year Change in Accounts Receivable Days</h3>
<p>Increasing accounts receivable days may signal fabricated sales transactions that generate reported revenue without actual cash collection (Fritzell, 2021). This also indicates that companies do not conduct proper due diligence assessing the credit-worthines of their customers before selling its products and services to them. Satyam Computers exhibited this indicator prior to its fraud exposure, with steadily increasing receivable days suggesting uncollectible revenue from potentially fictitious transactions (Jaiswal, 2025).</p>
</section>
<section id="year-on-year-change-in-market-cap" class="level3">
<h3 class="anchored" data-anchor-id="year-on-year-change-in-market-cap">Year-on-Year Change in Market Cap</h3>
<p>Extreme fluctuations in market capitalization may reflect artificial valuation driven by fraudulent financial reporting (Investopedia, 2023). Wirecard’s 2020 collapse exemplifies this warning sign as the company’s market capitalization surged approximately 300% between 2015-2018 based on $2.1 billion in fabricated profits, before catastrophically collapsing when the fraud was exposed (Reuters, 2020).</p>
</section>
</section>
<section id="analysis-method" class="level2">
<h2 class="anchored" data-anchor-id="analysis-method">2.3 Analysis Method</h2>
<p>We have decided to analyse the four indicators above across the whole WRDS healthcare industry dataset. We will indicate fraudulent activities across these four indicators using predicted positives. As long as a company has all four indicators flagged, we will conduct further investigation on these companies for signs of fraudulent activities.</p>
</section>
</section>
<section id="data-cleaning" class="level1">
<h1>3. Data Cleaning</h1>
<section id="percentage-change" class="level2">
<h2 class="anchored" data-anchor-id="percentage-change">3.1 Percentage Change</h2>
<p>Certain raw values were not comparable to each other, which could skew our results. For example, the current ratio and accounts receivable days would be very different numbers due to their different implications. The current ratio simply compares total current assets with total current liabilities while accounts receivable days represent the number of days for a company to collect payment after making a sale on credit. The current ratio would normally be a single-digit number while accounts receivable days can be two digits or even three digits.</p>
<p>Due to these differences, another dataset was created to transform the variables into percentage change to be able to make them more comparable.</p>
</section>
<section id="winsorization" class="level2">
<h2 class="anchored" data-anchor-id="winsorization">3.2 Winsorization</h2>
<p>Winsorization is a statistical transformation that limits extreme values in a dataset by capping them at a predefined percentile threshold, often at the 5th and 95th percentiles. This technique helps reduce the influence of outliers without entirely removing them, ensuring that statistical calculations such as means and standard deviations remain robust.</p>
<p>To ensure data quality and improve the robustness of analysis, Winsorization was applied to impute missing values in numeric columns. The dataset initially contained several missing values across key financial metrics such as profit margin, revenue, accounts receivable days, and total debt. Instead of removing records with missing values, which could result in data loss. Winsorization was used to replace NA values with the trimmed mean of the respective variable.</p>
<p>In this process, missing values (NA) in numeric columns were replaced using a Winsorized mean. First, missing values were removed to avoid interference in the computation. The Winsorized transformation was then applied, ignoring extreme values beyond the 5th and 95th percentiles. The adjusted data was then used to compute the mean, which was subsequently used to impute missing values for each variable. This method was applied within each group of company codes to maintain consistency across firms.</p>
<p>After Winsorization, the dataset exhibited a noticeable reduction in NA values across several variables. For instance, missing values in profit margin decreased from 4,423 to 2,289, revenue from 879 to 179, and inventory turnover from 8,446 to 6,003. This approach preserved data integrity while mitigating the effects of extreme outliers, leading to a cleaner dataset for subsequent analysis. Afterwards, we decided to replace all NA values with zero to keep observations in the data analysis.</p>
</section>
</section>
<section id="part-1-data-cleaning" class="level1">
<h1>Part 1: Data Cleaning</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DescTools)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(alpaca)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(yardstick)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(coefplot)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(DT)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(recipes)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caret)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(parsnip)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(fixest)</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ranger)</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>normal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"FFA_latest_dataset.csv"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>percentageChange <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"FFA_latest_dataset_pct_change.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>##Handling NA values - Nominal Data</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(normal)) <span class="co"># Check missing values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ...1            code        company_name          industry   
 Min.   :    0   Min.   :   677   Length:26044       Min.   :3400  
 1st Qu.: 6511   1st Qu.:102536   Class :character   1st Qu.:3430  
 Median :13022   Median :130339   Mode  :character   Median :3430  
 Mean   :13022   Mean   :114165                      Mean   :4344  
 3rd Qu.:19532   3rd Qu.:144730                      3rd Qu.:3440  
 Max.   :26043   Max.   :162882                      Max.   :8550  
                                                                   
     year_          freq           profit_margin          revenue         
 Min.   :2018   Length:26044       Min.   :-10697050   Min.   :0.000e+00  
 1st Qu.:2019   Class :character   1st Qu.:       23   1st Qu.:2.815e+06  
 Median :2020   Mode  :character   Median :       44   Median :1.760e+08  
 Mean   :2020                      Mean   :    -1009   Mean   :7.513e+10  
 3rd Qu.:2022                      3rd Qu.:       66   3rd Qu.:2.443e+09  
 Max.   :2023                      Max.   :    54243   Max.   :4.297e+13  
                                   NA's   :4423        NA's   :879        
 accounts_receivable_days debt_to_equity      inventory_turnover 
 Min.   :        0        Min.   : -63297.9   Min.   :-77612.54  
 1st Qu.:       50        1st Qu.:      0.0   1st Qu.:     1.52  
 Median :       81        Median :      9.3   Median :     2.68  
 Mean   :    23837        Mean   :     99.8   Mean   :    60.41  
 3rd Qu.:      136        3rd Qu.:     50.3   3rd Qu.:     5.64  
 Max.   :452692254        Max.   :1460694.5   Max.   :223560.60  
 NA's   :5634             NA's   :1193        NA's   :8446       
 return_on_equity         cash             total_debt       
 Min.   :-48737.11   Min.   :0.000e+00   Min.   :0.000e+00  
 1st Qu.:   -48.64   1st Qu.:1.026e+07   1st Qu.:6.417e+05  
 Median :     0.15   Median :8.398e+07   Median :3.234e+07  
 Mean   :   -66.52   Mean   :9.064e+09   Mean   :1.559e+10  
 3rd Qu.:    11.90   3rd Qu.:6.829e+08   3rd Qu.:6.659e+08  
 Max.   : 31560.00   Max.   :6.216e+12   Max.   :8.297e+12  
 NA's   :4414        NA's   :993         NA's   :1038       
  total_assets       property_plant_and_equipment      R&amp;D            
 Min.   :0.000e+00   Min.   :-2.814e+07           Min.   :-4.100e+06  
 1st Qu.:5.173e+07   1st Qu.: 1.278e+07           1st Qu.: 8.706e+06  
 Median :5.338e+08   Median : 2.487e+08           Median : 4.285e+07  
 Mean   :8.930e+10   Mean   : 5.795e+10           Mean   : 2.972e+09  
 3rd Qu.:5.067e+09   3rd Qu.: 2.990e+09           3rd Qu.: 2.249e+08  
 Max.   :2.711e+13   Max.   : 1.683e+13           Max.   : 7.711e+11  
 NA's   :887         NA's   :6767                 NA's   :8726        
 brands_patents_net   brands_patents_gross restatement_type restatement_reason
 Min.   :-1.919e+09   Min.   :-1.000e+03   Mode:logical     Mode:logical      
 1st Qu.: 4.536e+05   1st Qu.: 1.916e+06   NA's:26044       NA's:26044        
 Median : 7.184e+06   Median : 1.809e+07                                      
 Mean   : 1.802e+09   Mean   : 3.308e+09                                      
 3rd Qu.: 9.133e+07   3rd Qu.: 1.484e+08                                      
 Max.   : 3.352e+11   Max.   : 1.390e+12                                      
 NA's   :18957        NA's   :19085                                           
 auditor_opinion   cash_flow         cost_of_goods_sold      total_ca        
 Min.   :1.000   Min.   :0.000e+00   Min.   :-3.359e+11   Min.   :0.000e+00  
 1st Qu.:6.000   1st Qu.:4.565e+05   1st Qu.: 0.000e+00   1st Qu.:3.017e+07  
 Median :6.000   Median :1.189e+07   Median : 0.000e+00   Median :2.966e+08  
 Mean   :5.947   Mean   :4.217e+09   Mean   : 1.480e+08   Mean   :4.405e+10  
 3rd Qu.:6.000   3rd Qu.:2.013e+08   3rd Qu.: 0.000e+00   3rd Qu.:2.508e+09  
 Max.   :7.000   Max.   :1.733e+12   Max.   : 2.966e+11   Max.   :1.671e+13  
 NA's   :5397    NA's   :2465        NA's   :882          NA's   :925        
    total_cl           market_cap             EBIT           
 Min.   :0.000e+00   Min.   :2.170e+02   Min.   :-1.545e+12  
 1st Qu.:9.734e+06   1st Qu.:2.912e+07   1st Qu.:-3.316e+07  
 Median :8.946e+07   Median :1.402e+08   Median :-4.310e+05  
 Mean   :2.623e+10   Mean   :3.016e+09   Mean   : 9.080e+09  
 3rd Qu.:1.164e+09   3rd Qu.:7.730e+08   3rd Qu.: 2.232e+08  
 Max.   :1.336e+13   Max.   :5.534e+11   Max.   : 1.229e+13  
 NA's   :910         NA's   :4641        NA's   :1905        
 retained_earnings      net_income         accounts_payable    
 Min.   :-1.399e+12   Min.   :-9.015e+09   Min.   :-8.526e+06  
 1st Qu.:-1.832e+08   1st Qu.:-1.386e+07   1st Qu.: 1.995e+06  
 Median :-6.068e+06   Median :-6.095e+05   Median : 1.616e+07  
 Mean   : 2.860e+10   Mean   : 6.917e+07   Mean   : 8.732e+09  
 3rd Qu.: 6.070e+08   3rd Qu.: 9.271e+06   3rd Qu.: 2.348e+08  
 Max.   : 2.188e+13   Max.   : 3.515e+10   Max.   : 8.791e+12  
 NA's   :922          NA's   :869          NA's   :1681        
 working_capital         z_score           current_ratio   overvaluation   
 Min.   :-5.032e+12   Min.   :-153993.69   Min.   :0.000   Min.   :0.0000  
 1st Qu.: 5.633e+06   1st Qu.:      1.08   1st Qu.:1.278   1st Qu.:0.0000  
 Median : 1.083e+08   Median :      2.98   Median :2.415   Median :0.0000  
 Mean   : 1.781e+10   Mean   :       Inf   Mean   :  Inf   Mean   :0.2077  
 3rd Qu.: 9.394e+08   3rd Qu.:     40.93   3rd Qu.:5.248   3rd Qu.:0.0000  
 Max.   : 1.267e+13   Max.   :       Inf   Max.   :  Inf   Max.   :1.0000  
 NA's   :936          NA's   :5642         NA's   :944                     
 restated_later  
 Min.   :0.0000  
 1st Qu.:0.0000  
 Median :0.0000  
 Mean   :0.1126  
 3rd Qu.:0.0000  
 Max.   :1.0000  
                 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>winsorized_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">trim =</span> <span class="fl">0.05</span>) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">is.na</span>(x)]  <span class="co"># Remove NAs to avoid issues</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  x_winsorized <span class="ot">&lt;-</span> <span class="fu">Winsorize</span>(x)</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(x_winsorized, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>na_remove <span class="ot">&lt;-</span> <span class="cf">function</span>(x, column_names) {</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> <span class="fu">group_by</span>(code) <span class="co"># Grouping once before mutate</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (column_name <span class="cf">in</span> column_names) {</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name) <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name)), </span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">winsorized_mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name)), </span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="sc">!!</span><span class="fu">sym</span>(column_name)))}</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>exclude_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"industry"</span>, <span class="st">"year_"</span>, <span class="st">"restatement_type"</span>, </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"restatement_reason"</span>, <span class="st">"auditor_opinion"</span>)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>columns.isnumeric <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(normal)[<span class="fu">sapply</span>(normal, is.numeric)], exclude_cols)</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>df_na_removed1 <span class="ot">&lt;-</span> <span class="fu">na_remove</span>(normal, columns.isnumeric) </span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">summary</span>(df_na_removed1)) <span class="co"># After windsorising: result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ...1            code        company_name          industry   
 Min.   :    0   Min.   :   677   Length:26044       Min.   :3400  
 1st Qu.: 6511   1st Qu.:102536   Class :character   1st Qu.:3430  
 Median :13022   Median :130339   Mode  :character   Median :3430  
 Mean   :13022   Mean   :114165                      Mean   :4344  
 3rd Qu.:19532   3rd Qu.:144730                      3rd Qu.:3440  
 Max.   :26043   Max.   :162882                      Max.   :8550  
                                                                   
     year_          freq           profit_margin          revenue         
 Min.   :2018   Length:26044       Min.   :-10697050   Min.   :0.000e+00  
 1st Qu.:2019   Class :character   1st Qu.:       21   1st Qu.:2.602e+06  
 Median :2020   Mode  :character   Median :       44   Median :1.597e+08  
 Mean   :2020                      Mean   :    -1916   Mean   :7.357e+10  
 3rd Qu.:2022                      3rd Qu.:       67   3rd Qu.:2.336e+09  
 Max.   :2023                      Max.   :    54243   Max.   :4.297e+13  
                                   NA's   :2289        NA's   :179        
 accounts_receivable_days debt_to_equity      inventory_turnover 
 Min.   :        0        Min.   : -63297.9   Min.   :-77612.54  
 1st Qu.:       50        1st Qu.:      0.0   1st Qu.:     1.48  
 Median :       83        Median :      9.0   Median :     2.66  
 Mean   :   119175        Mean   :     97.4   Mean   :    51.13  
 3rd Qu.:      147        3rd Qu.:     49.8   3rd Qu.:     5.84  
 Max.   :452692254        Max.   :1460694.5   Max.   :223560.60  
 NA's   :2787             NA's   :238         NA's   :6003       
 return_on_equity         cash             total_debt       
 Min.   :-48737.11   Min.   :0.000e+00   Min.   :0.000e+00  
 1st Qu.:   -61.83   1st Qu.:9.624e+06   1st Qu.:6.096e+05  
 Median :    -4.27   Median :7.941e+07   Median :2.992e+07  
 Mean   :   -95.48   Mean   :8.851e+09   Mean   :1.517e+10  
 3rd Qu.:    11.09   3rd Qu.:6.495e+08   3rd Qu.:6.324e+08  
 Max.   : 31560.00   Max.   :6.216e+12   Max.   :8.297e+12  
 NA's   :1376        NA's   :205         NA's   :195        
  total_assets       property_plant_and_equipment      R&amp;D            
 Min.   :0.000e+00   Min.   :-2.814e+07           Min.   :-4.100e+06  
 1st Qu.:4.947e+07   1st Qu.: 9.087e+06           1st Qu.: 7.092e+06  
 Median :4.986e+08   Median : 1.786e+08           Median : 3.878e+07  
 Mean   :8.747e+10   Mean   : 5.193e+10           Mean   : 2.801e+09  
 3rd Qu.:4.878e+09   3rd Qu.: 2.446e+09           3rd Qu.: 2.029e+08  
 Max.   :2.711e+13   Max.   : 1.683e+13           Max.   : 7.711e+11  
 NA's   :181         NA's   :4245                 NA's   :7421        
 brands_patents_net   brands_patents_gross restatement_type restatement_reason
 Min.   :-1.919e+09   Min.   :-1.000e+03   Mode:logical     Mode:logical      
 1st Qu.: 3.450e+05   1st Qu.: 1.422e+06   NA's:26044       NA's:26044        
 Median : 5.156e+06   Median : 1.326e+07                                      
 Mean   : 1.566e+09   Mean   : 2.792e+09                                      
 3rd Qu.: 6.309e+07   3rd Qu.: 1.164e+08                                      
 Max.   : 3.352e+11   Max.   : 1.390e+12                                      
 NA's   :17175        NA's   :17283                                           
 auditor_opinion   cash_flow         cost_of_goods_sold      total_ca        
 Min.   :1.000   Min.   :0.000e+00   Min.   :-3.359e+11   Min.   :0.000e+00  
 1st Qu.:6.000   1st Qu.:3.383e+05   1st Qu.: 0.000e+00   1st Qu.:2.830e+07  
 Median :6.000   Median :9.053e+06   Median : 0.000e+00   Median :2.811e+08  
 Mean   :5.947   Mean   :3.970e+09   Mean   : 1.438e+08   Mean   :4.318e+10  
 3rd Qu.:6.000   3rd Qu.:1.724e+08   3rd Qu.: 0.000e+00   3rd Qu.:2.380e+09  
 Max.   :7.000   Max.   :1.733e+12   Max.   : 2.966e+11   Max.   :1.671e+13  
 NA's   :5397    NA's   :805         NA's   :183          NA's   :192        
    total_cl           market_cap             EBIT           
 Min.   :0.000e+00   Min.   :2.170e+02   Min.   :-1.545e+12  
 1st Qu.:9.456e+06   1st Qu.:2.961e+07   1st Qu.:-3.367e+07  
 Median :8.519e+07   Median :1.416e+08   Median :-7.719e+05  
 Mean   :2.569e+10   Mean   :2.735e+09   Mean   : 8.599e+09  
 3rd Qu.:1.109e+09   3rd Qu.:7.591e+08   3rd Qu.: 1.950e+08  
 Max.   :1.336e+13   Max.   :5.534e+11   Max.   : 1.229e+13  
 NA's   :187         NA's   :1344        NA's   :348         
 retained_earnings      net_income         accounts_payable    
 Min.   :-1.399e+12   Min.   :-9.015e+09   Min.   :-8.526e+06  
 1st Qu.:-1.867e+08   1st Qu.:-1.430e+07   1st Qu.: 1.929e+06  
 Median :-7.345e+06   Median :-7.281e+05   Median : 1.488e+07  
 Mean   : 2.794e+10   Mean   : 6.679e+07   Mean   : 8.472e+09  
 3rd Qu.: 5.686e+08   3rd Qu.: 8.838e+06   3rd Qu.: 2.220e+08  
 Max.   : 2.188e+13   Max.   : 3.515e+10   Max.   : 8.791e+12  
 NA's   :185          NA's   :180          NA's   :693         
 working_capital         z_score           current_ratio   overvaluation   
 Min.   :-5.032e+12   Min.   :-153993.69   Min.   :0.000   Min.   :0.0000  
 1st Qu.: 5.113e+06   1st Qu.:      1.16   1st Qu.:1.271   1st Qu.:0.0000  
 Median : 1.014e+08   Median :      3.34   Median :2.405   Median :0.0000  
 Mean   : 1.749e+10   Mean   :       Inf   Mean   :  Inf   Mean   :0.2077  
 3rd Qu.: 9.035e+08   3rd Qu.:     92.69   3rd Qu.:5.245   3rd Qu.:0.0000  
 Max.   : 1.267e+13   Max.   :       Inf   Max.   :  Inf   Max.   :1.0000  
 NA's   :192          NA's   :1586         NA's   :192                     
 restated_later  
 Min.   :0.0000  
 1st Qu.:0.0000  
 Median :0.0000  
 Mean   :0.1126  
 3rd Qu.:0.0000  
 Max.   :1.0000  
                 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # change to 0 if NA --&gt; replace nan value manually</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>df_na_removed1[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df_na_removed1, <span class="cf">function</span>(x) {</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if (x) {</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">replace</span>(x, <span class="fu">is.na</span>(x), <span class="dv">0</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># }</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>df_na_removed1[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df_na_removed1, <span class="cf">function</span>(x) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">replace</span>(x, <span class="fu">is.infinite</span>(x), <span class="dv">0</span>)  <span class="co"># Replace Inf and -Inf with 0 in numeric columns</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>##Handling NA values - percentageChange</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>winsorized_mean <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">trim =</span> <span class="fl">0.05</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x[<span class="sc">!</span><span class="fu">is.na</span>(x)]  <span class="co"># Remove NAs to avoid issues</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  x_winsorized <span class="ot">&lt;-</span> <span class="fu">Winsorize</span>(x)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">mean</span>(x_winsorized, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>na_remove <span class="ot">&lt;-</span> <span class="cf">function</span>(x, column_names) {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> <span class="fu">group_by</span>(code) <span class="co"># Grouping once before mutate</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (column_name <span class="cf">in</span> column_names) {</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> x <span class="sc">|&gt;</span> </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name) <span class="sc">:</span><span class="er">=</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name)), </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                                          <span class="fu">winsorized_mean</span>(<span class="sc">!!</span><span class="fu">sym</span>(column_name)), </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                                          <span class="sc">!!</span><span class="fu">sym</span>(column_name)))}</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>exclude_cols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"industry"</span>, <span class="st">"year_"</span>, <span class="st">"restatement_type"</span>, </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"restatement_reason"</span>, <span class="st">"auditor_opinion"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>columns.isnumeric <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(percentageChange)[<span class="fu">sapply</span>(percentageChange, is.numeric)], exclude_cols)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>df_na_removed2 <span class="ot">&lt;-</span> <span class="fu">na_remove</span>(percentageChange, columns.isnumeric) </span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(df_na_removed2) <span class="co"># After windsorising: result</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      ...1            code        company_name          industry   
 Min.   :    1   Min.   :   677   Length:21179       Min.   :3400  
 1st Qu.: 6452   1st Qu.:101946   Class :character   1st Qu.:3430  
 Median :12961   Median :130216   Mode  :character   Median :3430  
 Mean   :12954   Mean   :113846                      Mean   :4336  
 3rd Qu.:19426   3rd Qu.:144515                      3rd Qu.:3440  
 Max.   :26043   Max.   :162882                      Max.   :8550  
                                                                   
     year_          freq           profit_margin         revenue        
 Min.   :2019   Length:21179       Length:21179       Min.   :   -1.00  
 1st Qu.:2020   Class :character   Class :character   1st Qu.:   -0.12  
 Median :2021   Mode  :character   Mode  :character   Median :    0.08  
 Mean   :2021                                         Mean   :    7.60  
 3rd Qu.:2022                                         3rd Qu.:    0.30  
 Max.   :2023                                         Max.   :43795.37  
                                                      NA's   :1947      
 accounts_receivable_days debt_to_equity     inventory_turnover
 Min.   :   -1.00         Length:21179       Length:21179      
 1st Qu.:   -0.21         Class :character   Class :character  
 Median :   -0.01         Mode  :character   Mode  :character  
 Mean   :    5.47                                              
 3rd Qu.:    0.19                                              
 Max.   :33159.98                                              
 NA's   :2411                                                  
 return_on_equity        cash             total_debt        total_assets     
 Length:21179       Min.   :       -1   Min.   :    -1.0   Min.   :    -1.0  
 Class :character   1st Qu.:        0   1st Qu.:    -0.3   1st Qu.:    -0.1  
 Mode  :character   Median :        0   Median :     0.0   Median :     0.1  
                    Mean   :    44088   Mean   :    76.9   Mean   :    42.2  
                    3rd Qu.:        1   3rd Qu.:     0.4   3rd Qu.:     0.3  
                    Max.   :894393487   Max.   :685282.9   Max.   :390346.6  
                    NA's   :120         NA's   :1815       NA's   :91        
 property_plant_and_equipment      R&amp;D           brands_patents_net
 Min.   :  -2.639             Min.   :  -1.359   Min.   :      -6  
 1st Qu.:  -0.004             1st Qu.:  -0.140   1st Qu.:       0  
 Median :   0.079             Median :   0.088   Median :       0  
 Mean   :   0.680             Mean   :   1.246   Mean   :    3721  
 3rd Qu.:   0.273             3rd Qu.:   0.382   3rd Qu.:       0  
 Max.   :1930.726             Max.   :4936.391   Max.   :25034310  
 NA's   :3592                 NA's   :6078       NA's   :14419     
 brands_patents_gross restatement_type restatement_reason auditor_opinion
 Min.   :      -6     Min.   :0        Min.   :0          Min.   :0.000  
 1st Qu.:       0     1st Qu.:0        1st Qu.:0          1st Qu.:6.000  
 Median :       0     Median :0        Median :0          Median :6.000  
 Mean   :    3654     Mean   :0        Mean   :0          Mean   :4.792  
 3rd Qu.:       0     3rd Qu.:0        3rd Qu.:0          3rd Qu.:6.000  
 Max.   :25034310     Max.   :0        Max.   :0          Max.   :7.000  
 NA's   :14294                                                           
   cash_flow        cost_of_goods_sold    total_ca            total_cl        
 Min.   :   -1.00   Length:21179       Min.   :     -1.0   Min.   :    -1.00  
 1st Qu.:   -0.55   Class :character   1st Qu.:     -0.2   1st Qu.:    -0.12  
 Median :   -0.03   Mode  :character   Median :      0.0   Median :     0.10  
 Mean   :    6.78                      Mean   :    158.8   Mean   :     9.70  
 3rd Qu.:    0.80                      3rd Qu.:      0.3   3rd Qu.:     0.43  
 Max.   :34820.14                      Max.   :2614092.0   Max.   :186623.71  
 NA's   :1142                          NA's   :101         NA's   :97         
   market_cap            EBIT           retained_earnings    net_income       
 Min.   :   -1.000   Length:21179       Length:21179       Min.   :-4000.335  
 1st Qu.:   -0.386   Class :character   Class :character   1st Qu.:   -0.499  
 Median :   -0.088   Mode  :character   Mode  :character   Median :    0.002  
 Mean   :    1.121                                         Mean   :    1.632  
 3rd Qu.:    0.279                                         3rd Qu.:    0.468  
 Max.   :12214.827                                         Max.   :10794.500  
 NA's   :1305                                              NA's   :85         
 accounts_payable    working_capital      z_score          current_ratio      
 Min.   :-521346.0   Length:21179       Length:21179       Min.   :    -1.00  
 1st Qu.:     -0.2   Class :character   Class :character   1st Qu.:    -0.29  
 Median :      0.1   Mode  :character   Mode  :character   Median :    -0.03  
 Mean   :    -72.6                                         Mean   :    12.04  
 3rd Qu.:      0.5                                         3rd Qu.:     0.27  
 Max.   :  11549.2                                         Max.   :125501.63  
 NA's   :551                                               NA's   :230        
 overvaluation    restated_later  
 Min.   :0.0000   Min.   :0.0000  
 1st Qu.:0.0000   1st Qu.:0.0000  
 Median :0.0000   Median :0.0000  
 Mean   :0.2175   Mean   :0.1045  
 3rd Qu.:0.0000   3rd Qu.:0.0000  
 Max.   :1.0000   Max.   :1.0000  
                                  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # change to 0 if NA --&gt; replace nan value manually</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>df_na_removed2[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df_na_removed2, <span class="cf">function</span>(x) {</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  x <span class="ot">&lt;-</span> <span class="fu">replace</span>(x, <span class="fu">is.na</span>(x), <span class="dv">0</span>)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>df_na_removed2[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(df_na_removed2, <span class="cf">function</span>(x) {</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">replace</span>(x, <span class="fu">is.infinite</span>(x), <span class="dv">0</span>)<span class="co"># Replace Inf and -Inf with 0 in numeric columns</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="building-models-with-winsorised-data" class="level1">
<h1>Building Models (With winsorised data)</h1>
<p>We divided our dataset into two time periods: dataA (2019-2022) for model development and dataB (2023) for final validation. This approach allows us to build and refine our model using several years of historical data, then test its real-world effectiveness on the most recent, completely unseen data. By using this forward-testing method rather than random sampling, we can confirm our model works reliably on new data and remains effective at detecting emerging fraud patterns which is precisely how it would need to perform in actual implementation. For dataA, we will be splitting it into 80% training and 20% testing.</p>
<section id="debt-to-equity-ratio-model" class="level2">
<h2 class="anchored" data-anchor-id="debt-to-equity-ratio-model">Debt-to-Equity Ratio Model</h2>
<p>Independent variables: profit_margin, inventory_turnover, z_score, industry, restated_later, overvaluation, revenue, property_plant_and_equipment, brands_patents_net, auditor_opinion, net_income_pctc, cash_flow_pctc, accounts_receivable_days_pctc, market_cap_pctc, revenue_pctc. Dependent variable: Industry specific threshold is used to point out Debt-to-Equity ratio red flag.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>normal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"normalCleaned.csv"</span>)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>percentageChange <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"percentageChangeCleaned.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="splitting-into-2019-2022-data-and-2023-data" class="level3">
<h3 class="anchored" data-anchor-id="splitting-into-2019-2022-data-and-2023-data">Splitting into 2019-2022 data and 2023 data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1. remove first column</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co">#2. inner merge raw with %change with relevant data</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change factor variables to factor</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co">#3. create y variables with measurements</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co">#4. select variables to run regression</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>normal_selected <span class="ot">&lt;-</span> normal <span class="sc">%&gt;%</span> </span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, debt_to_equity, profit_margin, inventory_turnover, z_score, industry, restated_later, overvaluation, revenue, property_plant_and_equipment, brands_patents_net, auditor_opinion)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>percentageChange_selected <span class="ot">&lt;-</span> percentageChange <span class="sc">%&gt;%</span> </span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, net_income, cash_flow,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>         accounts_receivable_days, market_cap, revenue) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">net_income_pctc =</span> net_income, <span class="at">cash_flow_pctc =</span> cash_flow, <span class="at">accounts_receivable_days_pctc =</span> accounts_receivable_days, <span class="at">market_cap_pctc =</span> market_cap, <span class="at">revenue_pctc =</span> revenue)</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets on code and year_</span></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>healthcare_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(normal_selected, percentageChange_selected, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"year_"</span>))</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>healthcare_df <span class="ot">&lt;-</span> healthcare_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">dte_flag =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag as 1 if debt_to_equity &lt; 0 (applies to all industries)</span></span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    debt_to_equity <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag as 1 if debt_to_equity exceeds max by industry</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3400</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3410</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3420</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3430</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3440</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;</span> <span class="fl">1.5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">7040</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">8550</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>  ))<span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">dte_flagf =</span> <span class="fu">as.factor</span>(dte_flag), <span class="at">overvaluation =</span> <span class="fu">as.factor</span>(overvaluation), <span class="at">restated_later =</span> <span class="fu">as.factor</span>(restated_later), <span class="at">wgt =</span> <span class="fu">ifelse</span>(restated_later <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span>), <span class="at">industry =</span> <span class="fu">as.factor</span>(industry), <span class="at">auditor_opinion =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(auditor_opinion <span class="sc">==</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>debt_to_equity)</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace Inf and -Inf values with 0 only for numeric columns</span></span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>healthcare_df[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(healthcare_df, <span class="cf">function</span>(x) {</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">replace</span>(x, <span class="fu">is.infinite</span>(x), <span class="dv">0</span>)  <span class="co"># Replace Inf and -Inf with NA in numeric columns</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>restated_healthcare_df <span class="ot">&lt;-</span> healthcare_df</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into:</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a><span class="co"># A: 2019 - 2022 (train and test model with A, pick the best model)</span></span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a><span class="co"># B: 2023 (use 2023 data to predict and flag out debt-to-equity red flags)</span></span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>dataA <span class="ot">&lt;-</span> healthcare_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(year_ <span class="sc">&gt;=</span> <span class="dv">2019</span> <span class="sc">&amp;</span> year_ <span class="sc">&lt;=</span> <span class="dv">2022</span>)</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>dataB <span class="ot">&lt;-</span> healthcare_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(year_ <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>dataB <span class="ot">&lt;-</span> dataB <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Test =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="splitting-2019-2022-data-into-train-and-test-model" class="level3">
<h3 class="anchored" data-anchor-id="splitting-2019-2022-data-into-train-and-test-model">Splitting 2019-2022 data into train and test model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>dataA<span class="sc">$</span>Test <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="fu">nrow</span>(dataA)) <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="simple-logistic-regression" class="level3">
<h3 class="anchored" data-anchor-id="simple-logistic-regression">1. Simple Logistic Regression</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>logm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(dte_flag <span class="sc">~</span>.<span class="sc">-</span>wgt<span class="sc">-</span>Test<span class="sc">-</span>code<span class="sc">-</span>dte_flagf<span class="sc">-</span>year_, <span class="at">data=</span>dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span><span class="dv">0</span>, ], <span class="at">family=</span>binomial, <span class="at">weights =</span> wgt)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = dte_flag ~ . - wgt - Test - code - dte_flagf - 
    year_, family = binomial, data = dataA[dataA$Test == 0, ], 
    weights = wgt)

Coefficients:
                                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                    8.410e-01  1.693e-01   4.967 6.80e-07 ***
profit_margin                  5.618e-06  2.414e-06   2.327  0.01995 *  
inventory_turnover             2.883e-05  1.642e-05   1.755  0.07918 .  
z_score                       -6.385e-04  5.336e-05 -11.965  &lt; 2e-16 ***
industry3410                   3.194e-01  1.735e-01   1.841  0.06561 .  
industry3420                   2.499e-01  1.796e-01   1.391  0.16416    
industry3430                  -1.584e-01  1.697e-01  -0.933  0.35077    
industry3440                   1.301e-01  1.712e-01   0.760  0.44719    
industry7040                   3.977e-01  2.276e-01   1.747  0.08062 .  
industry8550                   2.547e-01  1.720e-01   1.481  0.13855    
restated_later1                5.316e-01  2.852e-02  18.643  &lt; 2e-16 ***
overvaluation1                -1.824e-02  3.470e-02  -0.526  0.59914    
revenue                       -1.947e-14  4.522e-14  -0.431  0.66678    
property_plant_and_equipment   2.398e-13  7.950e-14   3.017  0.00255 ** 
brands_patents_net             3.172e-11  6.256e-12   5.070 3.97e-07 ***
auditor_opinion1               1.806e-02  6.919e-02   0.261  0.79404    
net_income_pctc               -9.529e-04  3.414e-04  -2.791  0.00525 ** 
cash_flow_pctc                 8.332e-05  6.593e-05   1.264  0.20628    
accounts_receivable_days_pctc  2.348e-05  7.111e-05   0.330  0.74121    
market_cap_pctc                3.789e-04  4.877e-04   0.777  0.43729    
revenue_pctc                   6.661e-05  5.148e-05   1.294  0.19564    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 31289  on 13615  degrees of freedom
Residual deviance: 30121  on 13595  degrees of freedom
AIC: 30163

Number of Fisher Scoring iterations: 9</code></pre>
</div>
</div>
<p>Z-score (-6.385e-04, p &lt; 2e-16): Companies with stronger financial health (higher Z-scores) are substantially less likely to have suspicious debt-to-equity ratios, confirming that financial distress is a primary driver of potential manipulation.</p>
<p>Restated_later1 (5.316e-01, p &lt; 2e-16): Companies that subsequently restated their financial statements have approximately 70% higher odds of suspicious debt-to-equity ratios, making this the strongest predictor of potential manipulation.</p>
<p>Brands_patents_net (3.172e-11, p &lt; 0.001): Higher intangible asset values slightly increase the likelihood of suspicious debt-to-equity ratios, suggesting companies may use intangible assets to obscure their true leverage position.</p>
<p>Property_plant_and_equipment (2.398e-13, p = 0.00255): Companies with larger fixed asset bases show a slightly increased probability of suspicious debt-to-equity ratios, possibly indicating asset inflation to mask leverage concerns.</p>
<p>Profit_margin (5.618e-06, p = 0.01995): Higher profit margins correlate with marginally increased likelihood of suspicious debt-to-equity ratios, potentially reflecting earnings manipulation to offset high leverage.</p>
<p>Net_income_pctc (-9.529e-04, p = 0.00525): Companies with stronger year-over-year net income growth are less likely to display suspicious debt-to-equity ratios, suggesting stable profit growth reduces incentives for financial manipulation.</p>
<section id="prediction-logm1" class="level4">
<h4 class="anchored" data-anchor-id="prediction-logm1">Prediction logm1</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>dataA<span class="sc">$</span>pred_dteFlag1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, dataA, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>auc_train1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(dte_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>auc_test1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(dte_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>curve_train1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(dte_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>curve_test1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(dte_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_train1, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In Sample"</span>)) <span class="sc">+</span> </span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_test1, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out of Sample"</span>)) <span class="sc">+</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>aucs1 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_train1<span class="sc">$</span>.estimate, auc_test1<span class="sc">$</span>.estimate)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample AUC"</span>, <span class="st">"Out of sample AUC"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>aucs1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.6290734         0.6485695 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>dataA <span class="ot">&lt;-</span> dataA <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pred_dteFlag1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confusion-matrix" class="level4">
<h4 class="anchored" data-anchor-id="confusion-matrix">Confusion Matrix</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>log.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>log.pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(log.prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>actual_values <span class="ot">&lt;-</span> <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>dte_flag</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(log.pred, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(actual_values, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0   36    5
         1  928 2414
                                          
               Accuracy : 0.7242          
                 95% CI : (0.7088, 0.7392)
    No Information Rate : 0.715           
    P-Value [Acc &gt; NIR] : 0.1225          
                                          
                  Kappa : 0.0495          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.99793         
            Specificity : 0.03734         
         Pos Pred Value : 0.72232         
         Neg Pred Value : 0.87805         
             Prevalence : 0.71505         
         Detection Rate : 0.71357         
   Detection Prevalence : 0.98788         
      Balanced Accuracy : 0.51764         
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="reg-with-fixed-effects" class="level2">
<h2 class="anchored" data-anchor-id="reg-with-fixed-effects">2. Reg with Fixed Effects</h2>
<p>This regression helps to take into consideration company specific characteristics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>logm2 <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(dte_flag <span class="sc">~</span> profit_margin <span class="sc">+</span> </span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>               inventory_turnover <span class="sc">+</span> z_score <span class="sc">+</span> industry <span class="sc">+</span> restated_later <span class="sc">+</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>               overvaluation <span class="sc">+</span> revenue <span class="sc">+</span> property_plant_and_equipment <span class="sc">+</span> brands_patents_net <span class="sc">+</span> auditor_opinion <span class="sc">+</span> net_income_pctc <span class="sc">+</span> cash_flow_pctc <span class="sc">+</span> </span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>               accounts_receivable_days_pctc <span class="sc">+</span> market_cap_pctc <span class="sc">+</span> revenue_pctc <span class="sc">|</span> code, </span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">0</span>, ], </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">'logit'</span>), </span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">weights =</span> <span class="sc">~</span>wgt)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GLM estimation, family = binomial(link = "logit"), Dep. Var.: dte_flag
Observations: 2,990
Weights: wgt
Fixed-effects: code: 910
Standard-errors: Clustered (code) 
                                   Estimate   Std. Error   z value  Pr(&gt;|z|)
profit_margin                  3.229407e-06 1.148116e-06  2.812788 0.0049114
inventory_turnover             5.245079e-04 8.768056e-04  0.598203 0.5497044
z_score                       -1.302972e-03 1.407344e-03 -0.925838 0.3545304
restated_later1                7.258595e-01 3.608069e-01  2.011767 0.0442445
overvaluation1                -1.004638e+00 3.174513e-01 -3.164699 0.0015524
revenue                        1.160000e-12 1.825000e-12  0.633732 0.5262557
property_plant_and_equipment  -2.170000e-12 8.940000e-13 -2.423223 0.0153835
brands_patents_net             3.485100e-10 4.232290e-10  0.823451 0.4102514
auditor_opinion1               5.992840e-01 4.920262e-01  1.217992 0.2232269
net_income_pctc               -4.611363e-03 4.563168e-03 -1.010562 0.3122263
cash_flow_pctc                -4.950370e-04 4.020352e-04 -1.231327 0.2182005
accounts_receivable_days_pctc -5.134379e-03 6.012788e-03 -0.853910 0.3931549
market_cap_pctc               -5.790911e-04 5.137482e-03 -0.112719 0.9102534
revenue_pctc                  -1.262740e-03 1.076465e-03 -1.173043 0.2407787
                                 
profit_margin                 ** 
inventory_turnover               
z_score                          
restated_later1               *  
overvaluation1                ** 
revenue                          
property_plant_and_equipment  *  
brands_patents_net               
auditor_opinion1                 
net_income_pctc                  
cash_flow_pctc                   
accounts_receivable_days_pctc    
market_cap_pctc                  
revenue_pctc                     
... 6 variables were removed because of collinearity (industry3410, industry3420 and 4 others [full set in $collin.var])
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
Log-Likelihood: -2,822.6   Adj. Pseudo R2: 0.098662
           BIC: 13,040.0     Squared Cor.: 0.097831
# Evaluations: lhs: 25 -- no convergence: Maximum number of iterations reached </code></pre>
</div>
</div>
<p>Profit_margin (3.229e-06, p=0.0049): Companies with higher profit margins show a small but significantly increased likelihood of suspicious debt-to-equity ratios, possibly indicating that high reported profitability may mask leverage concerns.</p>
<p>Restated_later1 (7.259e-01, p=0.0442): Companies that subsequently restated their financial statements have approximately double the odds (e^0.726 ≈ 2.07) of suspicious debt-to-equity ratios, confirming that restatements are a key indicator of prior financial manipulation.</p>
<p>Overvaluation1 (-1.005, p=0.0016): Surprisingly, overvalued companies are significantly less likely to exhibit suspicious debt-to-equity ratios, suggesting that market overvaluation may reduce the need for debt ratio manipulation.</p>
<p>Property_plant_and_equipment (-2.170e-12, p=0.0154): Companies with larger fixed asset bases show a slightly decreased probability of suspicious debt-to-equity ratios, potentially indicating that tangible assets provide legitimate collateral that reduces the need to manipulate leverage metrics.</p>
<section id="prediction-logm2" class="level3">
<h3 class="anchored" data-anchor-id="prediction-logm2">Prediction logm2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dataA<span class="sc">$</span>pred_dteFlag2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm2, dataA, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>auc_train2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(dte_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>auc_test2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(dte_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>curve_train2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(dte_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>curve_test2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(dte_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_train2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In Sample"</span>)) <span class="sc">+</span> </span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_test2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out of Sample"</span>)) <span class="sc">+</span></span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>aucs2 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_train2<span class="sc">$</span>.estimate, auc_test2<span class="sc">$</span>.estimate)</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample AUC"</span>, <span class="st">"Out of sample AUC"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>aucs2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.6846420         0.5845242 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dataA <span class="ot">&lt;-</span> dataA <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pred_dteFlag2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="confusion-matrix-1" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-1">Confusion matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>log.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm2, <span class="at">newdata =</span> <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>), <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">fixef.default =</span> <span class="dv">0</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>log.pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(log.prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>actual_values <span class="ot">&lt;-</span> <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>dte_flag</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(log.pred, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(actual_values, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 121 117
         1 121 182
                                          
               Accuracy : 0.5601          
                 95% CI : (0.5171, 0.6024)
    No Information Rate : 0.5527          
    P-Value [Acc &gt; NIR] : 0.3816          
                                          
                  Kappa : 0.1089          
                                          
 Mcnemar's Test P-Value : 0.8458          
                                          
            Sensitivity : 0.6087          
            Specificity : 0.5000          
         Pos Pred Value : 0.6007          
         Neg Pred Value : 0.5084          
             Prevalence : 0.5527          
         Detection Rate : 0.3364          
   Detection Prevalence : 0.5601          
      Balanced Accuracy : 0.5543          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
</section>
</section>
<section id="lasso" class="level2">
<h2 class="anchored" data-anchor-id="lasso">3. LASSO</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fraud_eq <span class="ot">=</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"dte_flag ~.-wgt-Test-code-dte_flagf-year_"</span>, <span class="at">collapse=</span><span class="st">""</span>))</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test<span class="sc">==</span><span class="dv">0</span>,]</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fraud_eq, <span class="at">data=</span>train_data)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(fraud_eq, <span class="at">data=</span>train_data)[,<span class="st">"dte_flag"</span>]</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>fit_LASSO <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x=</span>x_train, <span class="at">y=</span>y_train, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>cvfit <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="at">x=</span>x_train, <span class="at">y=</span>y_train, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">type.measure=</span><span class="st">"auc"</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal lambda value</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>best_lambda <span class="ot">&lt;-</span> cvfit<span class="sc">$</span>lambda.min</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cvfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(cvfit, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>21 x 1 sparse Matrix of class "dgCMatrix"
                                         s1
(Intercept)                    1.100827e+00
profit_margin                  1.970019e-06
inventory_turnover             5.396664e-05
z_score                       -3.339407e-04
industry3410                   4.846102e-02
industry3420                   2.707317e-01
industry3430                  -4.544382e-01
industry3440                  -6.583316e-02
industry7040                   3.084514e-01
industry8550                  -1.216617e-02
restated_later1                5.219371e-01
overvaluation1                -1.259322e-01
revenue                        9.797581e-14
property_plant_and_equipment   2.121491e-13
brands_patents_net             4.108371e-11
auditor_opinion1              -2.915702e-02
net_income_pctc               -8.604178e-04
cash_flow_pctc                -1.116565e-06
accounts_receivable_days_pctc  8.156677e-05
market_cap_pctc                3.871549e-04
revenue_pctc                   3.246419e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>coefplot<span class="sc">::</span><span class="fu">coefplot</span>(cvfit,<span class="at">lambda=</span><span class="st">'lambda.min'</span>,<span class="at">sort=</span><span class="st">'magnitude'</span>)<span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The highest magnitude coefficient is restated_later1 (0.522), indicating companies that subsequently restated their financials have substantially higher odds of suspicious debt-to-equity ratios, making this the strongest warning sign.</p>
<p>Z-score (-0.000334) shows a negative relationship, confirming that financially healthier companies are less likely to have suspicious debt metrics.</p>
<p>Industry effects vary significantly, with industry3430 showing a strong negative association (-0.454) while industry3420 (0.271) and industry7040 (0.308) show positive associations, suggesting industry context matters considerably.</p>
<p>Brands_patents_net (4.11e-11) maintains a small positive effect, indicating companies with more intangible assets may have slightly increased likelihood of suspicious leverage metrics.</p>
<p>Overvaluation1 (-0.126) shows that overvalued companies are somewhat less likely to have suspicious debt ratios, possibly because market overvaluation reduces pressure to manipulate leverage metrics.</p>
<section id="plot-min-prediction-and-auc" class="level3">
<h3 class="anchored" data-anchor-id="plot-min-prediction-and-auc">Plot Min Prediction and AUC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create matrix for test data</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fraud_eq, <span class="at">data=</span>test_data)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(fraud_eq, <span class="at">data=</span>test_data)[,<span class="st">"dte_flag"</span>]</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>pred_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(cvfit, <span class="at">newx=</span>x_train, <span class="at">s=</span><span class="st">"lambda.min"</span>, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>pred_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(cvfit, <span class="at">newx=</span>x_test, <span class="at">s=</span><span class="st">"lambda.min"</span>, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>roc_train <span class="ot">&lt;-</span> <span class="fu">roc</span>(y_train, pred_train)</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>auc_train <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_train)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"In-sample AUC:"</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "In-sample AUC: 0.6274"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for out-of-sample (test) data</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>roc_test <span class="ot">&lt;-</span> <span class="fu">roc</span>(y_test, pred_test)</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>auc_test <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_test)</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Out-of-sample AUC:"</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Out-of-sample AUC: 0.6455"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curves</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_train, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">main=</span><span class="st">"ROC Curves"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_test, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"Training (AUC ="</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>), <span class="st">")"</span>), </span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">paste</span>(<span class="st">"Test (AUC ="</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>), <span class="st">")"</span>)),</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="prediction-performance" class="level4">
<h4 class="anchored" data-anchor-id="prediction-performance">Prediction Performance</h4>
<p>The in-sample AUC is 62.74% and out-sample AUC is 64.55%. After fitting test data into a confusion matrix, we found that precision is 71.98%, recall/sensitivity is around 99.83% and specificity is 2.49%.</p>
</section>
</section>
<section id="confusion-matrix-2" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-2">Confusion matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>log.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(cvfit, <span class="at">newx=</span>x_test, <span class="at">s=</span><span class="st">"lambda.min"</span>, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>log.pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(log.prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>actual_values <span class="ot">&lt;-</span> y_test</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(log.pred, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(actual_values, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0   24    4
         1  940 2415
                                         
               Accuracy : 0.721          
                 95% CI : (0.7055, 0.736)
    No Information Rate : 0.715          
    P-Value [Acc &gt; NIR] : 0.2292         
                                         
                  Kappa : 0.0328         
                                         
 Mcnemar's Test P-Value : &lt;2e-16         
                                         
            Sensitivity : 0.9983         
            Specificity : 0.0249         
         Pos Pred Value : 0.7198         
         Neg Pred Value : 0.8571         
             Prevalence : 0.7150         
         Detection Rate : 0.7139         
   Detection Prevalence : 0.9917         
      Balanced Accuracy : 0.5116         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
</section>
</section>
<section id="random-forest" class="level2">
<h2 class="anchored" data-anchor-id="random-forest">Random Forest</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>fraud_eq <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"dte_flagf ~.-wgt-Test-code-dte_flag-year_"</span>, <span class="at">collapse=</span><span class="st">""</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> fraud_eq,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">100</span>,</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">sqrt</span>(<span class="fu">ncol</span>(train_data)<span class="sc">-</span><span class="dv">4</span>), </span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">proximity =</span> <span class="cn">FALSE</span>,</span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.action =</span> na.omit</span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb41-16"><a href="#cb41-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-17"><a href="#cb41-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print model summary</span></span>
<span id="cb41-18"><a href="#cb41-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = fraud_eq, data = train_data, ntree = 100,      mtry = sqrt(ncol(train_data) - 4), importance = TRUE, proximity = FALSE,      na.action = na.omit) 
               Type of random forest: classification
                     Number of trees: 100
No. of variables tried at each split: 4

        OOB estimate of  error rate: 10.58%
Confusion matrix:
     0    1 class.error
0 2963  863  0.22556194
1  578 9212  0.05903984</code></pre>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get variable importance</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model, <span class="at">sort =</span> <span class="cn">TRUE</span>,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">main =</span> <span class="st">"Random Forest Variable Importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>randomForest<span class="sc">::</span><span class="fu">importance</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                      0         1 MeanDecreaseAccuracy
profit_margin                 14.907512 13.998959            17.652100
inventory_turnover            14.260033 14.386501            20.255022
z_score                       66.896692 62.432162            71.178281
industry                      14.712526 14.662035            20.492781
restated_later                 4.306021  1.879030             4.460523
overvaluation                  7.683937 20.091057            20.183223
revenue                       11.252132 22.013063            26.165541
property_plant_and_equipment  14.645209 16.921552            22.888786
brands_patents_net             9.797520 15.541330            17.924562
auditor_opinion               -1.008758  6.837399             5.143914
net_income_pctc                7.278404  8.866512            10.528115
cash_flow_pctc                 1.500247 12.402967            10.910046
accounts_receivable_days_pctc  5.800179 16.423718            17.031264
market_cap_pctc                1.676730 20.620059            18.643505
revenue_pctc                  10.357634 14.427003            17.284211
                              MeanDecreaseGini
profit_margin                        360.40643
inventory_turnover                   434.35144
z_score                             2063.71706
industry                             160.80959
restated_later                        19.03557
overvaluation                        127.38369
revenue                              403.62925
property_plant_and_equipment         354.87094
brands_patents_net                   126.25621
auditor_opinion                       19.07817
net_income_pctc                      292.47668
cash_flow_pctc                       254.16718
accounts_receivable_days_pctc        235.93457
market_cap_pctc                      350.20777
revenue_pctc                         258.99286</code></pre>
</div>
</div>
<section id="prediction-rfmodel" class="level3">
<h3 class="anchored" data-anchor-id="prediction-rfmodel">Prediction rfmodel</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions for both training and test sets</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For ROC, we need probability predictions</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>pred_train_prob <span class="ot">&lt;-</span> rf_model<span class="sc">$</span>votes[, <span class="dv">2</span>]  <span class="co"># Probability of positive class</span></span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>pred_test_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for in-sample (training) data</span></span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>roc_train <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> train_data<span class="sc">$</span>dte_flag, <span class="at">predictor =</span> pred_train_prob)</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>auc_train <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_train)</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"In-sample (Training) AUC:"</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "In-sample (Training) AUC: 0.9408"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for out-of-sample (test) data</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>roc_test <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> test_data<span class="sc">$</span>dte_flag, <span class="at">predictor =</span> pred_test_prob)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>auc_test <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_test)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Out-of-sample (Test) AUC:"</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Out-of-sample (Test) AUC: 0.9472"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create classification metrics for both sets</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For training</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>pred_train_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, train_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>cm_train <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred_train_class, train_data<span class="sc">$</span>dte_flagf)</span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Training Set Performance:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Training Set Performance:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 3825   27
         1    1 9763
                                         
               Accuracy : 0.9979         
                 95% CI : (0.997, 0.9986)
    No Information Rate : 0.719          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16      
                                         
                  Kappa : 0.9949         
                                         
 Mcnemar's Test P-Value : 2.306e-06      
                                         
            Sensitivity : 0.9997         
            Specificity : 0.9972         
         Pos Pred Value : 0.9930         
         Neg Pred Value : 0.9999         
             Prevalence : 0.2810         
         Detection Rate : 0.2809         
   Detection Prevalence : 0.2829         
      Balanced Accuracy : 0.9985         
                                         
       'Positive' Class : 0              
                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For test</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pred_test_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>cm_test <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred_test_class, test_data<span class="sc">$</span>dte_flagf)</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Test Set Performance:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test Set Performance:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0  773  140
         1  191 2279
                                         
               Accuracy : 0.9022         
                 95% CI : (0.8916, 0.912)
    No Information Rate : 0.715          
    P-Value [Acc &gt; NIR] : &lt; 2.2e-16      
                                         
                  Kappa : 0.756          
                                         
 Mcnemar's Test P-Value : 0.005991       
                                         
            Sensitivity : 0.8019         
            Specificity : 0.9421         
         Pos Pred Value : 0.8467         
         Neg Pred Value : 0.9227         
             Prevalence : 0.2850         
         Detection Rate : 0.2285         
   Detection Prevalence : 0.2699         
      Balanced Accuracy : 0.8720         
                                         
       'Positive' Class : 0              
                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curves</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_train, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">main =</span> <span class="st">"ROC Curves for Random Forest"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_test, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, </span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"Training (AUC ="</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>), <span class="st">")"</span>),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste</span>(<span class="st">"Test (AUC ="</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>), <span class="st">")"</span>)),</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Z-score is by far the most crucial predictor, with the highest values for both accuracy decrease (71.18) and Gini decrease (2063.72), indicating that financial health is the dominant factor in predicting suspicious leverage metrics.</p>
<p>Revenue shows strong importance (MeanDecreaseAccuracy 26.17), particularly for identifying suspicious cases (class 1 accuracy 22.01), suggesting that revenue characteristics significantly help detect problematic debt ratios.</p>
<p>Market_cap_pctc demonstrates a stark contrast between classes (1.68 for class 0 vs 20.62 for class 1), revealing it’s particularly important for identifying suspicious cases but less relevant for confirming normal ones.</p>
<p>Property_plant_and_equipment shows consistent importance across measures (MeanDecreaseAccuracy 22.89), indicating fixed assets provide reliable signals about debt ratio legitimacy.</p>
<p>Overvaluation shows asymmetric importance (7.68 for class 0 vs 20.09 for class 1), suggesting it’s much more useful for identifying suspicious cases than confirming legitimate ones.</p>
<p>Industry demonstrates moderate importance (MeanDecreaseAccuracy 20.49) while having relatively lower Gini decrease (160.81), indicating it provides context-specific information that helps prediction but with less discrimination power than financial metrics.</p>
<p>Prediction Performance The in-sample AUC is 94.08% and out-sample AUC is 94.72%. After fitting test data into a confusion matrix, we found that precision is 84.67%, recall/sensitivity is around 80.19% and specificity is 94.21%.</p>
</section>
</section>
<section id="xgboost" class="level2">
<h2 class="anchored" data-anchor-id="xgboost">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">max_depth=</span><span class="dv">10</span>,</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">eta=</span><span class="fl">0.2</span>,</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">gamma=</span><span class="dv">10</span>,</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">min_child_weight =</span> <span class="dv">5</span>,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">objective =</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"binary:logistic"</span>) <span class="co"># we didn't need to convert to factor because it's done here</span></span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>xgbCV <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(<span class="at">params=</span>params,</span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>x_train, <span class="co"># x data</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">label=</span>y_train, <span class="co"># y data</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrounds=</span><span class="dv">1</span>, <span class="co"># cut down to one to prevent overfitting</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">eval_metric=</span><span class="st">"auc"</span>,</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">nfold=</span><span class="dv">10</span>, <span class="co"># cross validation</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">stratified=</span><span class="cn">TRUE</span>) <span class="co"># stratified sampling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.931882+0.001882 test-auc:0.924407+0.011743 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>numTrees <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">which</span>(</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean <span class="sc">==</span> </span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>fit_optxgb <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">params=</span>params,</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> x_train,</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> y_train,</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrounds =</span> numTrees,</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">eval_metric=</span><span class="st">"auc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.931907 </code></pre>
</div>
</div>
<section id="importance-plot-fit_optxgb" class="level3">
<h3 class="anchored" data-anchor-id="importance-plot-fit_optxgb">Importance plot fit_optxgb</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>xgb.train.data <span class="ot">=</span> <span class="fu">xgb.DMatrix</span>(x_train, <span class="at">label =</span> y_train, <span class="at">missing =</span> <span class="cn">NA</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">=</span> <span class="fu">attr</span>(xgb.train.data, <span class="st">".Dimnames"</span>)[[<span class="dv">2</span>]]</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">=</span> <span class="fu">xgb.importance</span>(col_names, fit_optxgb)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Z-score dominates the model with dramatically higher importance (around 0.6) than any other feature, confirming that financial distress risk is the single most powerful predictor of suspicious debt ratio reporting.</p>
<p>Three financial market indicators form a secondary tier of importance: market capitalization percentage change, overvaluation, and inventory turnover (all with importance values between 0.05-0.10), suggesting that market perceptions and operational efficiency provide valuable signals.</p>
<p>Asset-related variables (property/plant/equipment and revenue) form a third tier of modest importance, indicating that asset composition contributes to prediction but with less impact than financial health metrics.</p>
<p>Most industry classifications and operational metrics (like accounts receivable days) show minimal importance, suggesting sector-specific factors play only a minor role compared to universal financial indicators.</p>
</section>
<section id="get-out-of-sample-error---fit_optxgb" class="level3">
<h3 class="anchored" data-anchor-id="get-out-of-sample-error---fit_optxgb">Get out of sample error - fit_optxgb</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, x_test, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">dte_flag=</span><span class="fu">factor</span>(y_test, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, x_train, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">dte_flag=</span><span class="fu">factor</span>(y_train, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>auc_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(dte_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>auc_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(dte_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>curve_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(dte_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>curve_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(dte_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>aucs_xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_xgb<span class="sc">$</span>.estimate, auc_out_xgb<span class="sc">$</span>.estimate)</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_xgb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, XGBoost"</span>, <span class="st">"Out of sample, XGBoost"</span>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>aucs_xgb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample, XGBoost Out of sample, XGBoost 
             0.9319070              0.9291855 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_in_xgb, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In-Sample XGBoost"</span>)) <span class="sc">+</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_out_xgb, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out-Sample XGBoost"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mapping: intercept = ~intercept, slope = ~slope 
geom_abline: na.rm = FALSE
stat_identity: na.rm = FALSE
position_identity </code></pre>
</div>
</div>
</section>
</section>
<section id="xgboost-confusion-matrix" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-confusion-matrix">XGBoost Confusion matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>preds_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_optxgb, x_test)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>preds_class <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(preds_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>)  <span class="co"># Using 0.5 as threshold, adjust as needed</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(preds_class), <span class="fu">factor</span>(y_test), <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0  780  161
         1  184 2258
                                         
               Accuracy : 0.898          
                 95% CI : (0.8873, 0.908)
    No Information Rate : 0.715          
    P-Value [Acc &gt; NIR] : &lt;2e-16         
                                         
                  Kappa : 0.7479         
                                         
 Mcnemar's Test P-Value : 0.2362         
                                         
            Sensitivity : 0.9334         
            Specificity : 0.8091         
         Pos Pred Value : 0.9247         
         Neg Pred Value : 0.8289         
             Prevalence : 0.7150         
         Detection Rate : 0.6675         
   Detection Prevalence : 0.7218         
      Balanced Accuracy : 0.8713         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>Prediction Performance The in-sample AUC is 93.19% and out-sample AUC is 92.92%. After fitting test data into a confusion matrix, we found that precision is 92.47%, recall/sensitivity is around 93.34% and specificity is 80.91%.</p>
</section>
<section id="prediction-with-logistic-regression-for-debt_to_equity-with-datab" class="level2">
<h2 class="anchored" data-anchor-id="prediction-with-logistic-regression-for-debt_to_equity-with-datab">Prediction with logistic regression for Debt_to_Equity with dataB</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>predicted_probs1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, <span class="at">newdata =</span> dataB, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get logical vector where predicted class is 1 (i.e., probability &gt; 0.5)</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>predicted_class_1 <span class="ot">&lt;-</span> predicted_probs1 <span class="sc">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the original dataset to only those predicted as 1</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>predicted_positive_df1 <span class="ot">&lt;-</span> dataB[predicted_class_1, ]</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(predicted_positive_df1<span class="sc">$</span>code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4152</code></pre>
</div>
</div>
</section>
<section id="prediction-with-rfmodel-for-debt_to_equity-with-datab" class="level2">
<h2 class="anchored" data-anchor-id="prediction-with-rfmodel-for-debt_to_equity-with-datab">Prediction with rfmodel for Debt_to_Equity with dataB</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>predicted_probs2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> dataB, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract probabilities for class '1'</span></span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>predicted_class1_probs2 <span class="ot">&lt;-</span> predicted_probs2[, <span class="st">"1"</span>]</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply threshold (e.g., &gt; 0.5)</span></span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>predicted_class_2 <span class="ot">&lt;-</span> predicted_class1_probs2 <span class="sc">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter original dataset</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a>predicted_positive_df2 <span class="ot">&lt;-</span> dataB[predicted_class_2, ]</span>
<span id="cb73-11"><a href="#cb73-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-12"><a href="#cb73-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Count distinct codes</span></span>
<span id="cb73-13"><a href="#cb73-13" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(predicted_positive_df2<span class="sc">$</span>code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3137</code></pre>
</div>
</div>
</section>
<section id="prediction-with-xgboost-for-debt_to_equity-with-datab---selected" class="level2">
<h2 class="anchored" data-anchor-id="prediction-with-xgboost-for-debt_to_equity-with-datab---selected">Prediction with XGBoost for Debt_to_Equity with dataB - Selected</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fraud_eq, <span class="at">data=</span>dataB)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_optxgb, x_test, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the final dataframe with just code and prediction flag</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>predicted_positive_dte <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">code =</span> dataB<span class="sc">$</span>code,</span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred_dte =</span> <span class="fu">ifelse</span>(pred.xgb <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="current-ratio-2" class="level2">
<h2 class="anchored" data-anchor-id="current-ratio-2">Current Ratio</h2>
<p>Independent variables: profit_margin, inventory_turnover, z_score, industry, restated_later, overvaluation, property_plant_and_equipment, brands_patents_net, auditor_opinion, net_income_pctc, cash_flow_pctc, total_debt_pctc, accounts_receivable_days_pctc, market_cap_pctc, revenue_pctc</p>
<p>Dependent variable: Industry specific threshold is used to point out Current Ratio red flag.</p>
<section id="splitting-into-2019-2022-data-and-2023-data-1" class="level3">
<h3 class="anchored" data-anchor-id="splitting-into-2019-2022-data-and-2023-data-1">Splitting into 2019-2022 data and 2023 data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co">#1. remove first column</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="co">#2. inner merge raw with %change with relevant data</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># change factor variables to factor</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">#3. create y variables with measurements</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="co">#4. select variables to run regression</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>normal_selected <span class="ot">&lt;-</span> normal <span class="sc">%&gt;%</span> </span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, profit_margin, inventory_turnover, z_score, industry, current_ratio, restated_later, overvaluation, property_plant_and_equipment, brands_patents_net, auditor_opinion)</span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a>percentageChange_selected <span class="ot">&lt;-</span> percentageChange <span class="sc">%&gt;%</span> </span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, net_income, cash_flow, total_debt, </span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a>         accounts_receivable_days, market_cap, revenue) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">net_income_pctc =</span> net_income, <span class="at">cash_flow_pctc =</span> cash_flow, <span class="at">total_debt_pctc =</span> total_debt, <span class="at">accounts_receivable_days_pctc =</span> accounts_receivable_days, <span class="at">market_cap_pctc =</span> market_cap, <span class="at">revenue_pctc =</span> revenue)</span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets on code and year_</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a>healthcare_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(normal_selected, percentageChange_selected, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"year_"</span>))</span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-17"><a href="#cb76-17" aria-hidden="true" tabindex="-1"></a>healthcare_df <span class="ot">&lt;-</span> healthcare_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">current_ratio_flag =</span> <span class="fu">case_when</span>(</span>
<span id="cb76-18"><a href="#cb76-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag as 1 if current_ratio &lt; 0 (applies to all industries)</span></span>
<span id="cb76-19"><a href="#cb76-19" aria-hidden="true" tabindex="-1"></a>    current_ratio <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb76-20"><a href="#cb76-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Flag as 1 if current_ratio exceeds max by industry</span></span>
<span id="cb76-21"><a href="#cb76-21" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3400</span> <span class="sc">&amp;</span> (current_ratio <span class="sc">&lt;</span> <span class="fl">1.3</span> <span class="sc">|</span> current_ratio <span class="sc">&gt;</span> <span class="fl">2.5</span>) <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># Drugs, Cosmetics, and Healthcare</span></span>
<span id="cb76-22"><a href="#cb76-22" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3410</span> <span class="sc">&amp;</span> (current_ratio <span class="sc">&lt;</span> <span class="fl">1.3</span> <span class="sc">|</span> current_ratio <span class="sc">&gt;</span> <span class="fl">2.5</span>) <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># Diversified</span></span>
<span id="cb76-23"><a href="#cb76-23" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3420</span> <span class="sc">&amp;</span> (current_ratio <span class="sc">&lt;</span> <span class="fl">1.2</span> <span class="sc">|</span> current_ratio <span class="sc">&gt;</span> <span class="fl">2.0</span>) <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># Cosmetics &amp; Toiletries</span></span>
<span id="cb76-24"><a href="#cb76-24" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3430</span> <span class="sc">&amp;</span> (current_ratio <span class="sc">&lt;</span> <span class="fl">1.5</span> <span class="sc">|</span> current_ratio <span class="sc">&gt;</span> <span class="fl">3.0</span>) <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># Ethical Drug Manufacturers</span></span>
<span id="cb76-25"><a href="#cb76-25" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">3440</span> <span class="sc">&amp;</span> (current_ratio <span class="sc">&lt;</span> <span class="fl">1.5</span> <span class="sc">|</span> current_ratio <span class="sc">&gt;</span> <span class="fl">2.5</span>) <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># Medical, Surgical &amp; Dental Suppliers</span></span>
<span id="cb76-26"><a href="#cb76-26" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">7040</span> <span class="sc">&amp;</span> (current_ratio <span class="sc">&lt;</span> <span class="fl">1.0</span> <span class="sc">|</span> current_ratio <span class="sc">&gt;</span> <span class="fl">1.8</span>) <span class="sc">~</span> <span class="dv">1</span>,  <span class="co"># Drug Store Chains</span></span>
<span id="cb76-27"><a href="#cb76-27" aria-hidden="true" tabindex="-1"></a>    industry <span class="sc">==</span> <span class="dv">8550</span> <span class="sc">&amp;</span> (current_ratio <span class="sc">&lt;</span> <span class="fl">1.2</span> <span class="sc">|</span> current_ratio <span class="sc">&gt;</span> <span class="fl">2.0</span>) <span class="sc">~</span> <span class="dv">1</span>,</span>
<span id="cb76-28"><a href="#cb76-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb76-29"><a href="#cb76-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Default to 0 for all other cases</span></span>
<span id="cb76-30"><a href="#cb76-30" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="dv">0</span></span>
<span id="cb76-31"><a href="#cb76-31" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">current_ratio_flagf =</span> <span class="fu">as.factor</span>(current_ratio_flag), <span class="at">overvaluation =</span> <span class="fu">as.factor</span>(overvaluation), <span class="at">restated_later =</span> <span class="fu">as.factor</span>(restated_later), <span class="at">wgt =</span> <span class="fu">ifelse</span>(restated_later <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span>), <span class="at">industry =</span> <span class="fu">as.factor</span>(industry), <span class="at">auditor_opinion =</span> <span class="fu">as.factor</span>(<span class="fu">ifelse</span>(auditor_opinion <span class="sc">==</span> <span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">0</span>))) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>current_ratio)</span>
<span id="cb76-32"><a href="#cb76-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-33"><a href="#cb76-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace Inf and -Inf values with 0 only for numeric columns</span></span>
<span id="cb76-34"><a href="#cb76-34" aria-hidden="true" tabindex="-1"></a>healthcare_df[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(healthcare_df, <span class="cf">function</span>(x) {</span>
<span id="cb76-35"><a href="#cb76-35" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb76-36"><a href="#cb76-36" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">replace</span>(x, <span class="fu">is.infinite</span>(x), <span class="dv">0</span>)  <span class="co"># Replace Inf and -Inf with NA in numeric columns</span></span>
<span id="cb76-37"><a href="#cb76-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb76-38"><a href="#cb76-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb76-39"><a href="#cb76-39" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb76-40"><a href="#cb76-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-41"><a href="#cb76-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Split data into:</span></span>
<span id="cb76-42"><a href="#cb76-42" aria-hidden="true" tabindex="-1"></a><span class="co"># A: 2019 - 2022 (train and test model with A, pick the best model)</span></span>
<span id="cb76-43"><a href="#cb76-43" aria-hidden="true" tabindex="-1"></a><span class="co"># B: 2023 (use 2023 data to predict and flag out debt-to-equity red flags)</span></span>
<span id="cb76-44"><a href="#cb76-44" aria-hidden="true" tabindex="-1"></a>dataA <span class="ot">&lt;-</span> healthcare_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(year_ <span class="sc">&gt;=</span> <span class="dv">2019</span> <span class="sc">&amp;</span> year_ <span class="sc">&lt;=</span> <span class="dv">2022</span>)</span>
<span id="cb76-45"><a href="#cb76-45" aria-hidden="true" tabindex="-1"></a>dataB <span class="ot">&lt;-</span> healthcare_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(year_ <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb76-46"><a href="#cb76-46" aria-hidden="true" tabindex="-1"></a>dataB <span class="ot">&lt;-</span> dataB <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Test =</span> <span class="dv">0</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="splitting-into-2019-2022-data-into-train-and-test" class="level3">
<h3 class="anchored" data-anchor-id="splitting-into-2019-2022-data-into-train-and-test">Splitting into 2019-2022 data into train and test</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>dataA<span class="sc">$</span>Test <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">runif</span>(<span class="fu">nrow</span>(dataA)) <span class="sc">&lt;</span> <span class="fl">0.8</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="simple-logistic-regression-1" class="level2">
<h2 class="anchored" data-anchor-id="simple-logistic-regression-1">Simple Logistic Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>logm1 <span class="ot">&lt;-</span> <span class="fu">glm</span>(current_ratio_flag <span class="sc">~</span>.<span class="sc">-</span>wgt<span class="sc">-</span>Test<span class="sc">-</span>code<span class="sc">-</span>current_ratio_flagf<span class="sc">-</span>year_, <span class="at">data=</span>dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">0</span>,], <span class="at">family=</span>binomial, <span class="at">weights =</span> wgt)</span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logm1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = current_ratio_flag ~ . - wgt - Test - code - current_ratio_flagf - 
    year_, family = binomial, data = dataA[dataA$Test == 0, ], 
    weights = wgt)

Coefficients:
                                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                    7.574e-01  1.506e-01   5.029 4.92e-07 ***
profit_margin                 -6.498e-05  1.515e-05  -4.290 1.79e-05 ***
inventory_turnover             4.455e-07  2.985e-06   0.149  0.88135    
z_score                       -2.464e-07  2.758e-06  -0.089  0.92883    
industry3410                   2.456e-01  1.536e-01   1.599  0.10978    
industry3420                  -9.183e-02  1.578e-01  -0.582  0.56049    
industry3430                   2.814e-01  1.509e-01   1.865  0.06212 .  
industry3440                   7.250e-01  1.528e-01   4.746 2.08e-06 ***
industry7040                  -5.076e-01  1.885e-01  -2.693  0.00707 ** 
industry8550                   5.014e-01  1.528e-01   3.282  0.00103 ** 
restated_later1               -3.284e-01  2.789e-02 -11.773  &lt; 2e-16 ***
overvaluation1                 1.546e-01  3.367e-02   4.591 4.41e-06 ***
property_plant_and_equipment  -1.392e-14  2.634e-14  -0.528  0.59728    
brands_patents_net             1.819e-12  1.751e-12   1.039  0.29877    
auditor_opinion1               6.203e-01  7.960e-02   7.792 6.57e-15 ***
net_income_pctc                1.311e-04  1.706e-04   0.769  0.44211    
cash_flow_pctc                -1.248e-04  4.719e-05  -2.645  0.00817 ** 
total_debt_pctc               -9.318e-07  2.299e-06  -0.405  0.68522    
accounts_receivable_days_pctc  2.128e-02  3.838e-03   5.545 2.93e-08 ***
market_cap_pctc               -4.643e-04  5.890e-04  -0.788  0.43053    
revenue_pctc                   1.199e-04  1.269e-04   0.945  0.34474    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 33436  on 13615  degrees of freedom
Residual deviance: 32656  on 13595  degrees of freedom
AIC: 32698

Number of Fisher Scoring iterations: 9</code></pre>
</div>
</div>
<section id="prediction-logm1-1" class="level3">
<h3 class="anchored" data-anchor-id="prediction-logm1-1">Prediction logm1</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>dataA<span class="sc">$</span>pred_dteFlag1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, dataA, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a>auc_train1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(current_ratio_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>auc_test1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(current_ratio_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a>curve_train1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(current_ratio_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb80-5"><a href="#cb80-5" aria-hidden="true" tabindex="-1"></a>curve_test1 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(current_ratio_flagf, pred_dteFlag1, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb80-6"><a href="#cb80-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb80-8"><a href="#cb80-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_train1, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In Sample"</span>)) <span class="sc">+</span> </span>
<span id="cb80-9"><a href="#cb80-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_test1, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out of Sample"</span>)) <span class="sc">+</span></span>
<span id="cb80-10"><a href="#cb80-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>aucs1 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_train1<span class="sc">$</span>.estimate, auc_test1<span class="sc">$</span>.estimate)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs1) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample AUC"</span>, <span class="st">"Out of sample AUC"</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>aucs1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.5756977         0.5813345 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a>dataA <span class="ot">&lt;-</span> dataA <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pred_dteFlag1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Profit margin (-6.498e-05, p &lt; 0.001): Lower profit margins significantly increase the likelihood of current ratio red flags, suggesting companies with weaker profitability struggle to maintain adequate short-term liquidity.</p>
<p>Industry 3440 (7.250e-01, p &lt; 0.001): Companies in industry 3440 have a substantially higher likelihood of experiencing current ratio problems, indicating this sector may face distinct liquidity challenges.</p>
<p>Industry 7040 (-5.076e-01, p &lt; 0.01): Companies in industry 7040 have significantly lower likelihood of current ratio red flags, suggesting this sector typically maintains stronger short-term liquidity positions.</p>
<p>Industry 8550 (5.014e-01, p &lt; 0.01): Companies in industry 8550 face significantly higher risk of current ratio red flags, indicating structural liquidity challenges within this industry.</p>
<p>Restated later (-3.284e-01, p &lt; 0.001): Companies that later restate their financial statements initially show fewer current ratio red flags, potentially indicating manipulation of financial reports to mask liquidity problems.</p>
<p>Overvaluation (1.546e-01, p &lt; 0.001): Overvalued companies have higher likelihood of current ratio problems, suggesting market overvaluation may coincide with deteriorating fundamental liquidity positions.</p>
<p>Auditor opinion (6.203e-01, p &lt; 0.001): Qualified or adverse auditor opinions strongly predict current ratio red flags, demonstrating that auditors effectively identify companies with problematic liquidity positions.</p>
<p>Cash flow percentage change (-1.248e-04, p &lt; 0.01): Declining cash flows significantly increase the risk of current ratio problems, highlighting the critical role of cash generation in maintaining short-term financial health.</p>
<p>Accounts receivable days percentage change (2.128e-02, p &lt; 0.001): Increasing collection periods strongly predict liquidity issues, indicating that elongating payment cycles from customers is a key warning sign of deteriorating financial health.</p>
</section>
<section id="confusion-matrix-3" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-3">Confusion Matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>log.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>), <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>log.pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(log.prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>actual_values <span class="ot">&lt;-</span> <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>current_ratio_flag</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(log.pred, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(actual_values, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb84-10"><a href="#cb84-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-11"><a href="#cb84-11" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0    2    3
         1  812 2566
                                          
               Accuracy : 0.7591          
                 95% CI : (0.7443, 0.7734)
    No Information Rate : 0.7594          
    P-Value [Acc &gt; NIR] : 0.5254          
                                          
                  Kappa : 0.002           
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.998832        
            Specificity : 0.002457        
         Pos Pred Value : 0.759621        
         Neg Pred Value : 0.400000        
             Prevalence : 0.759385        
         Detection Rate : 0.758498        
   Detection Prevalence : 0.998522        
      Balanced Accuracy : 0.500645        
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Prediction Performance The in-sample AUC is 57.57% and out-sample AUC is 58.13%. After fitting test data into a confusion matrix, we found that precision 75.96%, recall/sensitivity is around 99.88% and specificity is around 0.2%.</p>
</section>
</section>
<section id="reg-with-fixed-effects-1" class="level2">
<h2 class="anchored" data-anchor-id="reg-with-fixed-effects-1">Reg with Fixed Effects</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>logm2 <span class="ot">&lt;-</span> fixest<span class="sc">::</span><span class="fu">feglm</span>(current_ratio_flag <span class="sc">~</span> profit_margin <span class="sc">+</span> </span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>               inventory_turnover <span class="sc">+</span> z_score <span class="sc">+</span> industry <span class="sc">+</span> restated_later <span class="sc">+</span> </span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>               overvaluation <span class="sc">+</span> property_plant_and_equipment <span class="sc">+</span> net_income_pctc <span class="sc">+</span> cash_flow_pctc <span class="sc">+</span> brands_patents_net <span class="sc">+</span> auditor_opinion <span class="sc">+</span></span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>               accounts_receivable_days_pctc <span class="sc">+</span> market_cap_pctc <span class="sc">+</span> revenue_pctc <span class="sc">|</span> code, </span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">0</span>, ], </span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">family =</span> <span class="fu">binomial</span>(<span class="at">link =</span> <span class="st">'logit'</span>), </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>               <span class="at">weights =</span> <span class="sc">~</span>wgt)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(logm2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>GLM estimation, family = binomial(link = "logit")
Dep. Var.: current_ratio_flag
Observations: 4,802
Weights: wgt
Fixed-effects: code: 1,454
Standard-errors: Clustered (code) 
                                   Estimate   Std. Error   z value   Pr(&gt;|z|)
profit_margin                  3.928965e-05 5.034891e-05  0.780348 0.43518633
inventory_turnover            -1.481941e-04 4.009213e-05 -3.696339 0.00021873
z_score                        5.766284e-07 6.920947e-06  0.083316 0.93359997
restated_later1               -1.210283e-01 2.635078e-01 -0.459297 0.64602094
overvaluation1                 5.284009e-01 3.579560e-01  1.476161 0.13990059
property_plant_and_equipment  -1.430000e-12 2.400000e-12 -0.594955 0.55187387
net_income_pctc               -2.119738e-03 1.293923e-03 -1.638226 0.10137460
cash_flow_pctc                 8.080796e-04 2.346788e-03  0.344334 0.73059495
brands_patents_net             8.646000e-11 7.599000e-11  1.137748 0.25522572
auditor_opinion1              -2.501458e-01 5.620003e-01 -0.445099 0.65624819
accounts_receivable_days_pctc  1.167220e-02 5.218332e-03  2.236768 0.02530153
market_cap_pctc               -1.517847e-02 2.302331e-02 -0.659265 0.50972542
revenue_pctc                   9.770236e-04 1.141167e-03  0.856162 0.39190811
                                 
profit_margin                    
inventory_turnover            ***
z_score                          
restated_later1                  
overvaluation1                   
property_plant_and_equipment     
net_income_pctc                  
cash_flow_pctc                   
brands_patents_net               
auditor_opinion1                 
accounts_receivable_days_pctc *  
market_cap_pctc                  
revenue_pctc                     
... 6 variables were removed because of collinearity (industry3410, industry3420 and 4 others [full set in $collin.var])
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
Log-Likelihood: -5,128.3   Adj. Pseudo R2: 0.11056 
           BIC: 22,692.0     Squared Cor.: 0.056966</code></pre>
</div>
</div>
<section id="prediction-logm2-1" class="level3">
<h3 class="anchored" data-anchor-id="prediction-logm2-1">Prediction logm2</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>dataA<span class="sc">$</span>pred_dteFlag2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm2, dataA, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>auc_train2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(current_ratio_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>auc_test2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(current_ratio_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>curve_train2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(current_ratio_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>curve_test2 <span class="ot">&lt;-</span> dataA <span class="sc">%&gt;%</span> <span class="fu">filter</span>(Test<span class="sc">==</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(current_ratio_flagf, pred_dteFlag2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_train2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In Sample"</span>)) <span class="sc">+</span> </span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_test2, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out of Sample"</span>)) <span class="sc">+</span></span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>aucs2 <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_train2<span class="sc">$</span>.estimate, auc_test2<span class="sc">$</span>.estimate)</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs2) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample AUC"</span>, <span class="st">"Out of sample AUC"</span>)</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>aucs2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample AUC Out of sample AUC 
        0.6373722         0.5417980 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb91"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>dataA <span class="ot">&lt;-</span> dataA <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pred_dteFlag2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Inventory turnover (-1.481941e-04, p &lt; 0.001): Higher inventory turnover significantly decreases the likelihood of current ratio red flags, suggesting companies that efficiently manage inventory have stronger short-term liquidity positions.</p>
<p>Accounts receivable days percentage change (1.167220e-02, p &lt; 0.05): Increasing collection periods significantly predict liquidity issues, indicating that lengthening customer payment cycles serves as an early warning sign of deteriorating financial health.</p>
<p>The other variables in this fixed effects model aren’t statistically significant, which differs notably from the previous model. This suggests that when controlling for fixed effects (likely company-specific or time-specific factors), only inventory management and accounts receivable trends remain significant predictors of current ratio problems.</p>
<p>The loss of significance for variables like profit margin, industry codes, and auditor opinions indicates these factors may be correlated with the fixed effects being controlled for in this model, or their influence is less direct when accounting for unobserved heterogeneity across entities.</p>
</section>
<section id="confusion-matrix-4" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-4">Confusion matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>log.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm2, <span class="at">newdata =</span> <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>), <span class="at">type =</span> <span class="st">"response"</span>, <span class="at">fixef.default =</span> <span class="dv">0</span>)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>log.pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(log.prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>actual_values <span class="ot">&lt;-</span> <span class="fu">subset</span>(dataA, Test <span class="sc">==</span> <span class="dv">1</span>)<span class="sc">$</span>current_ratio_flag</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(log.pred, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(actual_values, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction   0   1
         0 151 226
         1 152 308
                                         
               Accuracy : 0.5484         
                 95% CI : (0.514, 0.5825)
    No Information Rate : 0.638          
    P-Value [Acc &gt; NIR] : 1.0000000      
                                         
                  Kappa : 0.0714         
                                         
 Mcnemar's Test P-Value : 0.0001735      
                                         
            Sensitivity : 0.5768         
            Specificity : 0.4983         
         Pos Pred Value : 0.6696         
         Neg Pred Value : 0.4005         
             Prevalence : 0.6380         
         Detection Rate : 0.3680         
   Detection Prevalence : 0.5496         
      Balanced Accuracy : 0.5376         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>Prediction Performance The in-sample AUC is 63.73% and out-sample AUC is 54.18%. After fitting test data into a confusion matrix, we found that precision is 66.96%, recall/sensitivity is around 57.68% and specificity is 49.83%.</p>
</section>
</section>
<section id="lasso-1" class="level2">
<h2 class="anchored" data-anchor-id="lasso-1">LASSO</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>fraud_eq <span class="ot">=</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"current_ratio_flag ~.-wgt-Test-code-current_ratio_flagf-year_"</span>, <span class="at">collapse=</span><span class="st">""</span>))</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test<span class="sc">==</span><span class="dv">0</span>,]</span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test<span class="sc">==</span><span class="dv">1</span>,]</span>
<span id="cb94-4"><a href="#cb94-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-5"><a href="#cb94-5" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fraud_eq, <span class="at">data=</span>train_data)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb94-6"><a href="#cb94-6" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(fraud_eq, <span class="at">data=</span>train_data)[,<span class="st">"current_ratio_flag"</span>]</span>
<span id="cb94-7"><a href="#cb94-7" aria-hidden="true" tabindex="-1"></a>fit_LASSO <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x=</span>x_train, <span class="at">y=</span>y_train, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>)</span>
<span id="cb94-8"><a href="#cb94-8" aria-hidden="true" tabindex="-1"></a>cvfit <span class="ot">=</span> <span class="fu">cv.glmnet</span>(<span class="at">x=</span>x_train, <span class="at">y=</span>y_train, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">type.measure=</span><span class="st">"auc"</span>)</span>
<span id="cb94-9"><a href="#cb94-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-10"><a href="#cb94-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the optimal lambda value</span></span>
<span id="cb94-11"><a href="#cb94-11" aria-hidden="true" tabindex="-1"></a>best_lambda <span class="ot">&lt;-</span> cvfit<span class="sc">$</span>lambda.min</span>
<span id="cb94-12"><a href="#cb94-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-13"><a href="#cb94-13" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cvfit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(cvfit, <span class="at">s =</span> <span class="st">"lambda.min"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>21 x 1 sparse Matrix of class "dgCMatrix"
                                         s1
(Intercept)                    1.035641e+00
profit_margin                 -1.753865e-05
inventory_turnover             1.836252e-06
z_score                        3.343128e-06
industry3410                  -1.014348e-01
industry3420                  -1.157989e-01
industry3430                   5.915146e-02
industry3440                   3.620956e-01
industry7040                  -1.055710e+00
industry8550                   2.313433e-01
restated_later1               -3.277399e-01
overvaluation1                 1.351323e-01
property_plant_and_equipment  -5.503016e-14
brands_patents_net             1.956963e-12
auditor_opinion1               5.933777e-01
net_income_pctc                1.323428e-04
cash_flow_pctc                -6.991107e-05
total_debt_pctc               -1.148042e-06
accounts_receivable_days_pctc  5.624639e-03
market_cap_pctc               -1.143297e-03
revenue_pctc                   2.583717e-03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a>coefplot<span class="sc">::</span><span class="fu">coefplot</span>(cvfit,<span class="at">lambda=</span><span class="st">'lambda.min'</span>,<span class="at">sort=</span><span class="st">'magnitude'</span>)<span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">15</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-34-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Profit margin (-1.753865e-05): Companies with lower profit margins face increased likelihood of current ratio red flags, indicating profitability directly impacts short-term liquidity health.</p>
<p>Industry 3440 (3.620956e-01): Companies in this industry have substantially higher likelihood of experiencing current ratio problems compared to the reference industry.</p>
<p>Industry 7040 (-1.055710e+00): Companies in this industry show dramatically lower likelihood of current ratio red flags, suggesting structural advantages in maintaining liquidity.</p>
<p>Industry 8550 (2.313433e-01): Companies in this industry face higher risk of current ratio issues, indicating industry-specific liquidity challenges.</p>
<p>Restated later (-3.277399e-01): Companies that later restate financials show fewer initial current ratio red flags, potentially indicating financial manipulation to hide liquidity issues.</p>
<p>Overvaluation (1.351323e-01): Overvalued companies have higher likelihood of current ratio problems, suggesting market overvaluation may coincide with deteriorating fundamentals.</p>
<p>Auditor opinion (5.933777e-01): Qualified or adverse auditor opinions strongly predict current ratio red flags, confirming auditors effectively identify problematic liquidity positions.</p>
<p>Cash flow percentage change (-6.991107e-05): Declining cash flows increase the risk of current ratio issues, highlighting the importance of cash generation for short-term financial health.</p>
<p>Accounts receivable days percentage change (5.624639e-03): Increasing collection periods predict liquidity problems, showing that lengthening payment cycles from customers signal deteriorating financial health.</p>
<p>Market cap percentage change (-1.143297e-03): Declining market capitalization correlates with increased likelihood of current ratio problems, suggesting market participants recognize liquidity deterioration.</p>
<p>Revenue percentage change (2.583717e-03): Rising revenue correlates with increased likelihood of current ratio problems, possibly indicating growth without proper working capital management.</p>
<section id="plot-min-prediction-and-auc-1" class="level3">
<h3 class="anchored" data-anchor-id="plot-min-prediction-and-auc-1">Plot Min prediction and AUC</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create matrix for test data</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fraud_eq, <span class="at">data=</span>test_data)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(fraud_eq, <span class="at">data=</span>test_data)[,<span class="st">"current_ratio_flag"</span>]</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>pred_train <span class="ot">&lt;-</span> <span class="fu">predict</span>(cvfit, <span class="at">newx=</span>x_train, <span class="at">s=</span><span class="st">"lambda.min"</span>, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>pred_test <span class="ot">&lt;-</span> <span class="fu">predict</span>(cvfit, <span class="at">newx=</span>x_test, <span class="at">s=</span><span class="st">"lambda.min"</span>, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb98-7"><a href="#cb98-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-8"><a href="#cb98-8" aria-hidden="true" tabindex="-1"></a>roc_train <span class="ot">&lt;-</span> <span class="fu">roc</span>(y_train, pred_train)</span>
<span id="cb98-9"><a href="#cb98-9" aria-hidden="true" tabindex="-1"></a>auc_train <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_train)</span>
<span id="cb98-10"><a href="#cb98-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"In-sample AUC:"</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "In-sample AUC: 0.5791"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for out-of-sample (test) data</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>roc_test <span class="ot">&lt;-</span> <span class="fu">roc</span>(y_test, pred_test)</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>auc_test <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_test)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Out-of-sample AUC:"</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Out-of-sample AUC: 0.585"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curves</span></span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_train, <span class="at">col=</span><span class="st">"blue"</span>, <span class="at">main=</span><span class="st">"ROC Curves"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_test, <span class="at">col=</span><span class="st">"red"</span>, <span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"Training (AUC ="</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>), <span class="st">")"</span>), </span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">paste</span>(<span class="st">"Test (AUC ="</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>), <span class="st">")"</span>)),</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span><span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lwd=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="confusion-matrix-5" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-5">Confusion matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>log.prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(cvfit, <span class="at">newx=</span>x_test, <span class="at">s=</span><span class="st">"lambda.min"</span>, <span class="at">type=</span><span class="st">"response"</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>log.pred <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(log.prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>actual_values <span class="ot">&lt;-</span> y_test</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(log.pred, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">factor</span>(actual_values, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)), </span>
<span id="cb103-9"><a href="#cb103-9" aria-hidden="true" tabindex="-1"></a>                      <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb103-10"><a href="#cb103-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-11"><a href="#cb103-11" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0   17   16
         1  797 2553
                                         
               Accuracy : 0.7597         
                 95% CI : (0.7449, 0.774)
    No Information Rate : 0.7594         
    P-Value [Acc &gt; NIR] : 0.4934         
                                         
                  Kappa : 0.0218         
                                         
 Mcnemar's Test P-Value : &lt;2e-16         
                                         
            Sensitivity : 0.99377        
            Specificity : 0.02088        
         Pos Pred Value : 0.76209        
         Neg Pred Value : 0.51515        
             Prevalence : 0.75939        
         Detection Rate : 0.75466        
   Detection Prevalence : 0.99025        
      Balanced Accuracy : 0.50733        
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
</div>
<p>Prediction Performance The in-sample AUC is 57.91% and out-sample AUC is 58.5%. After fitting test data into a confusion matrix, we found that precision is 76.2%, recall/sensitivity is around 99.37% and specificity is around 2%.</p>
</section>
</section>
<section id="random-forest-1" class="level2">
<h2 class="anchored" data-anchor-id="random-forest-1">Random Forest</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">0</span>, ]</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>test_data <span class="ot">&lt;-</span> dataA[dataA<span class="sc">$</span>Test <span class="sc">==</span> <span class="dv">1</span>, ]</span>
<span id="cb105-3"><a href="#cb105-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-4"><a href="#cb105-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-5"><a href="#cb105-5" aria-hidden="true" tabindex="-1"></a>fraud_eq <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"current_ratio_flagf ~.-wgt-Test-code-current_ratio_flag-year_"</span>, <span class="at">collapse=</span><span class="st">""</span>))</span>
<span id="cb105-6"><a href="#cb105-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-7"><a href="#cb105-7" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(</span>
<span id="cb105-8"><a href="#cb105-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">formula =</span> fraud_eq,</span>
<span id="cb105-9"><a href="#cb105-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> train_data,</span>
<span id="cb105-10"><a href="#cb105-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">ntree =</span> <span class="dv">100</span>,</span>
<span id="cb105-11"><a href="#cb105-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">mtry =</span> <span class="fu">sqrt</span>(<span class="fu">ncol</span>(train_data)<span class="sc">-</span><span class="dv">4</span>), </span>
<span id="cb105-12"><a href="#cb105-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">importance =</span> <span class="cn">TRUE</span>,</span>
<span id="cb105-13"><a href="#cb105-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">proximity =</span> <span class="cn">FALSE</span>,</span>
<span id="cb105-14"><a href="#cb105-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.action =</span> na.omit</span>
<span id="cb105-15"><a href="#cb105-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb105-16"><a href="#cb105-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb105-17"><a href="#cb105-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Print model summary</span></span>
<span id="cb105-18"><a href="#cb105-18" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = fraud_eq, data = train_data, ntree = 100,      mtry = sqrt(ncol(train_data) - 4), importance = TRUE, proximity = FALSE,      na.action = na.omit) 
               Type of random forest: classification
                     Number of trees: 100
No. of variables tried at each split: 4

        OOB estimate of  error rate: 22.08%
Confusion matrix:
    0    1 class.error
0 652 2591  0.79895159
1 416 9957  0.04010412</code></pre>
</div>
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get variable importance</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model, <span class="at">sort =</span> <span class="cn">TRUE</span>,</span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">main =</span> <span class="st">"Random Forest Variable Importance"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-37-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a>randomForest<span class="sc">::</span><span class="fu">importance</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                       0         1 MeanDecreaseAccuracy
profit_margin                 13.9164718  6.865669          15.23468784
inventory_turnover            18.6886534 11.462054          21.02167536
z_score                       31.0124400  3.356695          21.33246742
industry                      12.3727713  7.034285          13.30242111
restated_later                 1.4814572  2.633874           2.97886614
overvaluation                  4.8707139  6.003918           8.30009631
property_plant_and_equipment  12.5328944 19.645026          27.00792242
brands_patents_net             7.4020629 15.744070          20.05795436
auditor_opinion                0.8953303 -0.319631           0.05721918
net_income_pctc                5.2586866  6.251698           8.83145560
cash_flow_pctc                 7.5419434  3.518466           7.49723790
total_debt_pctc                6.2623185  1.973751           5.77349273
accounts_receivable_days_pctc  7.5611104  6.676805           9.25508883
market_cap_pctc                2.9046886  3.176655           4.36993833
revenue_pctc                   6.6531191  6.773807          10.53292289
                              MeanDecreaseGini
profit_margin                        482.91170
inventory_turnover                   468.91273
z_score                              575.35471
industry                             203.42488
restated_later                        37.54589
overvaluation                         40.72968
property_plant_and_equipment         496.88506
brands_patents_net                   211.93055
auditor_opinion                       14.94096
net_income_pctc                      424.05604
cash_flow_pctc                       406.36913
total_debt_pctc                      395.39552
accounts_receivable_days_pctc        386.40290
market_cap_pctc                      404.98025
revenue_pctc                         390.13453</code></pre>
</div>
</div>
<section id="prediction" class="level3">
<h3 class="anchored" data-anchor-id="prediction">Prediction</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Get predictions for both training and test sets</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For ROC, we need probability predictions</span></span>
<span id="cb110-3"><a href="#cb110-3" aria-hidden="true" tabindex="-1"></a>pred_train_prob <span class="ot">&lt;-</span> rf_model<span class="sc">$</span>votes[, <span class="dv">2</span>]  <span class="co"># Probability of positive class</span></span>
<span id="cb110-4"><a href="#cb110-4" aria-hidden="true" tabindex="-1"></a>pred_test_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test_data, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]</span>
<span id="cb110-5"><a href="#cb110-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb110-6"><a href="#cb110-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for in-sample (training) data</span></span>
<span id="cb110-7"><a href="#cb110-7" aria-hidden="true" tabindex="-1"></a>roc_train <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> train_data<span class="sc">$</span>current_ratio_flag, <span class="at">predictor =</span> pred_train_prob)</span>
<span id="cb110-8"><a href="#cb110-8" aria-hidden="true" tabindex="-1"></a>auc_train <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_train)</span>
<span id="cb110-9"><a href="#cb110-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"In-sample (Training) AUC:"</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "In-sample (Training) AUC: 0.7153"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC for out-of-sample (test) data</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>roc_test <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> test_data<span class="sc">$</span>current_ratio_flag, <span class="at">predictor =</span> pred_test_prob)</span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>auc_test <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_test)</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Out-of-sample (Test) AUC:"</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Out-of-sample (Test) AUC: 0.7465"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create classification metrics for both sets</span></span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For training</span></span>
<span id="cb114-3"><a href="#cb114-3" aria-hidden="true" tabindex="-1"></a>pred_train_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, train_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb114-4"><a href="#cb114-4" aria-hidden="true" tabindex="-1"></a>cm_train <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred_train_class, train_data<span class="sc">$</span>current_ratio_flagf)</span>
<span id="cb114-5"><a href="#cb114-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Training Set Performance:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Training Set Performance:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_train)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction     0     1
         0  3240     0
         1     3 10373
                                     
               Accuracy : 0.9998     
                 95% CI : (0.9994, 1)
    No Information Rate : 0.7618     
    P-Value [Acc &gt; NIR] : &lt;2e-16     
                                     
                  Kappa : 0.9994     
                                     
 Mcnemar's Test P-Value : 0.2482     
                                     
            Sensitivity : 0.9991     
            Specificity : 1.0000     
         Pos Pred Value : 1.0000     
         Neg Pred Value : 0.9997     
             Prevalence : 0.2382     
         Detection Rate : 0.2380     
   Detection Prevalence : 0.2380     
      Balanced Accuracy : 0.9995     
                                     
       'Positive' Class : 0          
                                     </code></pre>
</div>
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For test</span></span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>pred_test_class <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, test_data, <span class="at">type =</span> <span class="st">"class"</span>)</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>cm_test <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(pred_test_class, test_data<span class="sc">$</span>current_ratio_flagf)</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Test Set Performance:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Test Set Performance:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb120"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(cm_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0  149   76
         1  665 2493
                                          
               Accuracy : 0.781           
                 95% CI : (0.7666, 0.7948)
    No Information Rate : 0.7594          
    P-Value [Acc &gt; NIR] : 0.001623        
                                          
                  Kappa : 0.2038          
                                          
 Mcnemar's Test P-Value : &lt; 2.2e-16       
                                          
            Sensitivity : 0.18305         
            Specificity : 0.97042         
         Pos Pred Value : 0.66222         
         Neg Pred Value : 0.78942         
             Prevalence : 0.24061         
         Detection Rate : 0.04404         
   Detection Prevalence : 0.06651         
      Balanced Accuracy : 0.57673         
                                          
       'Positive' Class : 0               
                                          </code></pre>
</div>
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot ROC curves</span></span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_train, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">main =</span> <span class="st">"ROC Curves for Random Forest"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_test, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, </span>
<span id="cb122-5"><a href="#cb122-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(<span class="fu">paste</span>(<span class="st">"Training (AUC ="</span>, <span class="fu">round</span>(auc_train, <span class="dv">4</span>), <span class="st">")"</span>),</span>
<span id="cb122-6"><a href="#cb122-6" aria-hidden="true" tabindex="-1"></a>                 <span class="fu">paste</span>(<span class="st">"Test (AUC ="</span>, <span class="fu">round</span>(auc_test, <span class="dv">4</span>), <span class="st">")"</span>)),</span>
<span id="cb122-7"><a href="#cb122-7" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"red"</span>), <span class="at">lwd =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Property, plant, and equipment: Fixed assets emerge as the most important predictor in both measurements, suggesting a company’s investment in physical assets strongly influences its liquidity position, likely because these assets tie up capital that could otherwise support short-term obligations.</p>
<p>Z-score: This composite financial health metric ranks second in importance, indicating that overall financial distress strongly correlates with current ratio problems.</p>
<p>Inventory turnover: High importance suggests efficient inventory management critically impacts a company’s ability to maintain adequate liquidity.</p>
<p>Brands/patents (intangible assets) and profit margin: These variables round out the top five predictors, indicating both intangible asset values and profitability significantly impact liquidity risk.</p>
<p>The model finds structural factors (fixed assets, industry) and operational metrics (inventory turnover, profit margin) more predictive than financial reporting factors (restatements, auditor opinions), which ranked lowest. This suggests physical asset management and operational efficiency are more fundamental to predicting liquidity issues than accounting indicators or market perceptions.</p>
</section>
</section>
<section id="xgboost-1" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-1">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">max_depth=</span><span class="dv">10</span>,</span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">eta=</span><span class="fl">0.2</span>,</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">gamma=</span><span class="dv">10</span>,</span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">min_child_weight =</span> <span class="dv">5</span>,</span>
<span id="cb123-5"><a href="#cb123-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">objective =</span></span>
<span id="cb123-6"><a href="#cb123-6" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"binary:logistic"</span>)</span>
<span id="cb123-7"><a href="#cb123-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb123-8"><a href="#cb123-8" aria-hidden="true" tabindex="-1"></a><span class="co"># run the model</span></span>
<span id="cb123-9"><a href="#cb123-9" aria-hidden="true" tabindex="-1"></a>xgbCV <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(<span class="at">params=</span>params,</span>
<span id="cb123-10"><a href="#cb123-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">data=</span>x_train, <span class="co"># x data</span></span>
<span id="cb123-11"><a href="#cb123-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">label=</span>y_train, <span class="co"># y data</span></span>
<span id="cb123-12"><a href="#cb123-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrounds=</span><span class="dv">100</span>, <span class="co"># how many times to run</span></span>
<span id="cb123-13"><a href="#cb123-13" aria-hidden="true" tabindex="-1"></a>                <span class="at">eval_metric=</span><span class="st">"auc"</span>,</span>
<span id="cb123-14"><a href="#cb123-14" aria-hidden="true" tabindex="-1"></a>                <span class="at">nfold=</span><span class="dv">10</span>, <span class="co"># cross validation</span></span>
<span id="cb123-15"><a href="#cb123-15" aria-hidden="true" tabindex="-1"></a>                <span class="at">stratified=</span><span class="cn">TRUE</span>) <span class="co"># stratified sampling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.707473+0.004725 test-auc:0.668226+0.018259 
[2] train-auc:0.719467+0.006158 test-auc:0.681713+0.012915 
[3] train-auc:0.728588+0.003932 test-auc:0.685810+0.013199 
[4] train-auc:0.736658+0.004376 test-auc:0.688081+0.013222 
[5] train-auc:0.740957+0.004484 test-auc:0.689947+0.013323 
[6] train-auc:0.744978+0.004328 test-auc:0.691875+0.014027 
[7] train-auc:0.750102+0.005656 test-auc:0.693487+0.013000 
[8] train-auc:0.755113+0.005040 test-auc:0.696363+0.013504 
[9] train-auc:0.759256+0.006170 test-auc:0.697824+0.013004 
[10]    train-auc:0.763935+0.005943 test-auc:0.699631+0.011213 
[11]    train-auc:0.767036+0.005430 test-auc:0.700937+0.010947 
[12]    train-auc:0.770388+0.004944 test-auc:0.701909+0.011824 
[13]    train-auc:0.773624+0.005021 test-auc:0.701909+0.011051 
[14]    train-auc:0.776711+0.004401 test-auc:0.703847+0.011035 
[15]    train-auc:0.779938+0.004325 test-auc:0.704684+0.011148 
[16]    train-auc:0.781797+0.004924 test-auc:0.704786+0.011186 
[17]    train-auc:0.783650+0.006056 test-auc:0.704470+0.011179 
[18]    train-auc:0.784576+0.006631 test-auc:0.704552+0.011166 
[19]    train-auc:0.785980+0.007671 test-auc:0.704990+0.011362 
[20]    train-auc:0.786897+0.008241 test-auc:0.705113+0.011336 
[21]    train-auc:0.787553+0.008336 test-auc:0.705071+0.011530 
[22]    train-auc:0.788312+0.008504 test-auc:0.705015+0.011546 
[23]    train-auc:0.789334+0.008376 test-auc:0.705015+0.011489 
[24]    train-auc:0.790065+0.008251 test-auc:0.705047+0.011604 
[25]    train-auc:0.790587+0.008952 test-auc:0.705012+0.011577 
[26]    train-auc:0.790723+0.009096 test-auc:0.704945+0.011580 
[27]    train-auc:0.790894+0.009408 test-auc:0.704894+0.011577 
[28]    train-auc:0.790972+0.009557 test-auc:0.704812+0.011576 
[29]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[30]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[31]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[32]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011588 
[33]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[34]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[35]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[36]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[37]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[38]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[39]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[40]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011588 
[41]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[42]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011588 
[43]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011588 
[44]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011588 
[45]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[46]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[47]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[48]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[49]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[50]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[51]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[52]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[53]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[54]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[55]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[56]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[57]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[58]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[59]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[60]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[61]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[62]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[63]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[64]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[65]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[66]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[67]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[68]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[69]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[70]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[71]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[72]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[73]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[74]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[75]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[76]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[77]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[78]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[79]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[80]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[81]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[82]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[83]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[84]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[85]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[86]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[87]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[88]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[89]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[90]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[91]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[92]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[93]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[94]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[95]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[96]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[97]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[98]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[99]    train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 
[100]   train-auc:0.791126+0.009859 test-auc:0.704675+0.011587 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a>numTrees <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb125-2"><a href="#cb125-2" aria-hidden="true" tabindex="-1"></a> <span class="fu">which</span>(</span>
<span id="cb125-3"><a href="#cb125-3" aria-hidden="true" tabindex="-1"></a>  xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean <span class="sc">==</span> </span>
<span id="cb125-4"><a href="#cb125-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">max</span>(xgbCV<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean)</span>
<span id="cb125-5"><a href="#cb125-5" aria-hidden="true" tabindex="-1"></a> )</span>
<span id="cb125-6"><a href="#cb125-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb125-7"><a href="#cb125-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-8"><a href="#cb125-8" aria-hidden="true" tabindex="-1"></a>fit_optxgb <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">params=</span>params,</span>
<span id="cb125-9"><a href="#cb125-9" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> x_train,</span>
<span id="cb125-10"><a href="#cb125-10" aria-hidden="true" tabindex="-1"></a>                <span class="at">label =</span> y_train,</span>
<span id="cb125-11"><a href="#cb125-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">nrounds =</span> numTrees,</span>
<span id="cb125-12"><a href="#cb125-12" aria-hidden="true" tabindex="-1"></a>                <span class="at">eval_metric=</span><span class="st">"auc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.713812 
[2] train-auc:0.722226 
[3] train-auc:0.726130 
[4] train-auc:0.738733 
[5] train-auc:0.741610 
[6] train-auc:0.744558 
[7] train-auc:0.747543 
[8] train-auc:0.749675 
[9] train-auc:0.754358 
[10]    train-auc:0.760547 
[11]    train-auc:0.762373 
[12]    train-auc:0.770397 
[13]    train-auc:0.775156 
[14]    train-auc:0.776596 
[15]    train-auc:0.779045 
[16]    train-auc:0.779734 
[17]    train-auc:0.781671 
[18]    train-auc:0.783655 
[19]    train-auc:0.789127 
[20]    train-auc:0.791502 </code></pre>
</div>
</div>
<section id="importance-plot" class="level3">
<h3 class="anchored" data-anchor-id="importance-plot">Importance plot</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a>xgb.train.data <span class="ot">=</span> <span class="fu">xgb.DMatrix</span>(x_train, <span class="at">label =</span> y_train, <span class="at">missing =</span> <span class="cn">NA</span>)</span>
<span id="cb127-2"><a href="#cb127-2" aria-hidden="true" tabindex="-1"></a>col_names <span class="ot">=</span> <span class="fu">attr</span>(xgb.train.data, <span class="st">".Dimnames"</span>)[[<span class="dv">2</span>]]</span>
<span id="cb127-3"><a href="#cb127-3" aria-hidden="true" tabindex="-1"></a>imp <span class="ot">=</span> <span class="fu">xgb.importance</span>(col_names, fit_optxgb)</span>
<span id="cb127-4"><a href="#cb127-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Variable importance</span></span>
<span id="cb127-5"><a href="#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(imp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Z-score (≈0.30): Significantly outranks all other variables, indicating overall financial health is the strongest predictor of liquidity issues, with companies having lower Z-scores (higher financial distress) more likely to experience current ratio problems.</p>
<p>Inventory turnover (≈0.15): Ranks second, confirming that inventory management efficiency strongly impacts a company’s liquidity position, with inefficient inventory management signaling potential current ratio issues.</p>
<p>Property, plant, and equipment (≈0.11): Third most important predictor, suggesting companies with disproportionate capital tied up in fixed assets may face liquidity challenges.</p>
<p>Profit margin (≈0.10): Fourth most influential, indicating profitability directly affects a company’s ability to maintain adequate short-term liquidity.</p>
<p>Revenue percentage change (≈0.05): Companies with rapidly changing revenue may face challenges in managing working capital appropriately.</p>
<p>The results show financial health metrics (Z-score) and operational efficiency indicators (inventory turnover, profit margin) outweigh accounting indicators (restatements) and industry factors in predicting liquidity problems. This differs somewhat from the earlier models where auditor opinions and financial restatements showed higher significance, suggesting XGBoost identifies more fundamental financial patterns while being less sensitive to potential manipulation indicators.</p>
</section>
<section id="get-out-of-sample-error" class="level3">
<h3 class="anchored" data-anchor-id="get-out-of-sample-error">Get out of sample error</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, x_test, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a>df_test <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">current_ratio_flag=</span><span class="fu">factor</span>(y_test, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, x_train, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a>df_train <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb=</span>pred.xgb, <span class="at">current_ratio_flag=</span><span class="fu">factor</span>(y_train, <span class="at">levels=</span><span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-7"><a href="#cb128-7" aria-hidden="true" tabindex="-1"></a>auc_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(current_ratio_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb128-8"><a href="#cb128-8" aria-hidden="true" tabindex="-1"></a>auc_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(current_ratio_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb128-9"><a href="#cb128-9" aria-hidden="true" tabindex="-1"></a>curve_in_xgb <span class="ot">&lt;-</span> df_train <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(current_ratio_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb128-10"><a href="#cb128-10" aria-hidden="true" tabindex="-1"></a>curve_out_xgb <span class="ot">&lt;-</span> df_test <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(current_ratio_flag, pred.xgb, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb128-11"><a href="#cb128-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb128-12"><a href="#cb128-12" aria-hidden="true" tabindex="-1"></a>aucs_xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_in_xgb<span class="sc">$</span>.estimate, auc_out_xgb<span class="sc">$</span>.estimate)</span>
<span id="cb128-13"><a href="#cb128-13" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_xgb) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, XGBoost"</span>, <span class="st">"Out of sample, XGBoost"</span>)</span>
<span id="cb128-14"><a href="#cb128-14" aria-hidden="true" tabindex="-1"></a>aucs_xgb</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    In sample, XGBoost Out of sample, XGBoost 
             0.7915022              0.7252717 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_in_xgb, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"In-Sample XGBoost"</span>)) <span class="sc">+</span> </span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>curve_out_xgb, <span class="fu">aes</span>(<span class="at">y=</span>sensitivity, <span class="at">x=</span><span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color=</span><span class="st">"Out-Sample XGBoost"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope=</span><span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>mapping: intercept = ~intercept, slope = ~slope 
geom_abline: na.rm = FALSE
stat_identity: na.rm = FALSE
position_identity </code></pre>
</div>
</div>
</section>
</section>
<section id="xgboost-confusion-matrix-1" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-confusion-matrix-1">XGBoost Confusion matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>preds_prob <span class="ot">&lt;-</span> <span class="fu">predict</span>(fit_optxgb, x_test)</span>
<span id="cb133-2"><a href="#cb133-2" aria-hidden="true" tabindex="-1"></a>preds_class <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(preds_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>)  <span class="co"># Using 0.5 as threshold, adjust as needed</span></span>
<span id="cb133-3"><a href="#cb133-3" aria-hidden="true" tabindex="-1"></a>cm <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(<span class="fu">factor</span>(preds_class), <span class="fu">factor</span>(y_test), <span class="at">positive =</span> <span class="st">"1"</span>)</span>
<span id="cb133-4"><a href="#cb133-4" aria-hidden="true" tabindex="-1"></a>cm</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0   87   76
         1  727 2493
                                          
               Accuracy : 0.7626          
                 95% CI : (0.7479, 0.7769)
    No Information Rate : 0.7594          
    P-Value [Acc &gt; NIR] : 0.3374          
                                          
                  Kappa : 0.1063          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.9704          
            Specificity : 0.1069          
         Pos Pred Value : 0.7742          
         Neg Pred Value : 0.5337          
             Prevalence : 0.7594          
         Detection Rate : 0.7369          
   Detection Prevalence : 0.9518          
      Balanced Accuracy : 0.5386          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>The in-sample AUC is 79.15% and out-sample AUC is 72.53%. After fitting test data into a confusion matrix, we found that precision is 77.42%, recall/sensitivity is around 97.04% and specificity is 10.69%.</p>
</section>
<section id="prediction-with-logistic-regression-for-current_ratio-with-datab" class="level2">
<h2 class="anchored" data-anchor-id="prediction-with-logistic-regression-for-current_ratio-with-datab">Prediction with logistic regression for Current_ratio with dataB</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a>predicted_probs1 <span class="ot">&lt;-</span> <span class="fu">predict</span>(logm1, <span class="at">newdata =</span> dataB, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb135-2"><a href="#cb135-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-3"><a href="#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Get logical vector where predicted class is 1 (i.e., probability &gt; 0.5)</span></span>
<span id="cb135-4"><a href="#cb135-4" aria-hidden="true" tabindex="-1"></a>predicted_class_1 <span class="ot">&lt;-</span> predicted_probs1 <span class="sc">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb135-5"><a href="#cb135-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-6"><a href="#cb135-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Subset the original dataset to only those predicted as 1</span></span>
<span id="cb135-7"><a href="#cb135-7" aria-hidden="true" tabindex="-1"></a>predicted_positive_df1 <span class="ot">&lt;-</span> dataB[predicted_class_1, ]</span>
<span id="cb135-8"><a href="#cb135-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb135-9"><a href="#cb135-9" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(predicted_positive_df1<span class="sc">$</span>code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4177</code></pre>
</div>
</div>
</section>
<section id="prediction-with-rfmodel-for-current_ratio-with-datab" class="level2">
<h2 class="anchored" data-anchor-id="prediction-with-rfmodel-for-current_ratio-with-datab">Prediction with rfmodel for Current_ratio with dataB</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a>predicted_probs2 <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> dataB, <span class="at">type =</span> <span class="st">"prob"</span>)</span>
<span id="cb137-2"><a href="#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="#cb137-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract probabilities for class '1'</span></span>
<span id="cb137-4"><a href="#cb137-4" aria-hidden="true" tabindex="-1"></a>predicted_class1_probs2 <span class="ot">&lt;-</span> predicted_probs2[, <span class="st">"1"</span>]</span>
<span id="cb137-5"><a href="#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="#cb137-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply threshold (e.g., &gt; 0.5)</span></span>
<span id="cb137-7"><a href="#cb137-7" aria-hidden="true" tabindex="-1"></a>predicted_class_2 <span class="ot">&lt;-</span> predicted_class1_probs2 <span class="sc">&gt;</span> <span class="fl">0.5</span></span>
<span id="cb137-8"><a href="#cb137-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-9"><a href="#cb137-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter original dataset</span></span>
<span id="cb137-10"><a href="#cb137-10" aria-hidden="true" tabindex="-1"></a>predicted_positive_df2 <span class="ot">&lt;-</span> dataB[predicted_class_2, ]</span>
<span id="cb137-11"><a href="#cb137-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-12"><a href="#cb137-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Count distinct codes</span></span>
<span id="cb137-13"><a href="#cb137-13" aria-hidden="true" tabindex="-1"></a><span class="fu">n_distinct</span>(predicted_positive_df2<span class="sc">$</span>code)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3878</code></pre>
</div>
</div>
</section>
<section id="prediction-with-xgboost-for-current_ratio-with-datab---selected" class="level2">
<h2 class="anchored" data-anchor-id="prediction-with-xgboost-for-current_ratio-with-datab---selected">Prediction with XGBoost for Current_ratio with dataB - Selected</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># pick XGBoost over rfmodel because rfmodel is too optimistic, with out sample auc better than in sample auc.</span></span>
<span id="cb139-2"><a href="#cb139-2" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(fraud_eq, <span class="at">data=</span>dataB)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb139-3"><a href="#cb139-3" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(fraud_eq, <span class="at">data=</span>dataB)[,<span class="st">"current_ratio_flag"</span>]</span>
<span id="cb139-4"><a href="#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="#cb139-5" aria-hidden="true" tabindex="-1"></a>pred.xgb <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb, x_test, <span class="at">type=</span><span class="st">"response"</span>))</span>
<span id="cb139-6"><a href="#cb139-6" aria-hidden="true" tabindex="-1"></a>predicted_positive_cr <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb139-7"><a href="#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">pred.xgb =</span> pred.xgb,</span>
<span id="cb139-8"><a href="#cb139-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">current_ratio_flag =</span> <span class="fu">factor</span>(y_test, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)),</span>
<span id="cb139-9"><a href="#cb139-9" aria-hidden="true" tabindex="-1"></a>  dataB  <span class="co"># all original variables from dataB</span></span>
<span id="cb139-10"><a href="#cb139-10" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">pred.xgb =</span> <span class="fu">ifelse</span>(pred.xgb <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code, pred.xgb) <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">pred_cr =</span> pred.xgb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="account-restatements" class="level1">
<h1>Account Restatements</h1>
<p>Financial statement restatements occur when a company must revise previously issued financial reports due to errors or misstatements.</p>
<p>In practice, a restatement is a formal admission that past statements were inaccurate, and it often raises red flags about a firm’s accounting practices and internal controls.</p>
<section id="clean-data-starting-with-healthcare_df" class="level2">
<h2 class="anchored" data-anchor-id="clean-data-starting-with-healthcare_df">Clean data (starting with healthcare_df)</h2>
<p>To prepare the dataset for predictive modeling, two cleaned data files were first imported: one containing raw financial indicators (normalCleaned.csv) and another capturing percentage changes in key financial metrics (percentageChangeCleaned.csv). Relevant variables were selected from each dataset to retain only those most pertinent to the analysis. Column names were standardized for consistency, such as renaming R&amp;D to rd_pctc and aligning all percentage-based variables with a _pctc suffix. The two datasets were then merged using an inner join on company code and year to create a unified panel dataset. Additional feature engineering was performed, including the creation of a binary flag (dte_flag) to indicate firms with potentially risky debt-to-equity ratios. The resulting dataset, restated_healthcare_df, is now fully cleaned, merged, and engineered—ready for regression and classification modeling. These steps are in line with earlier data cleaning steps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="#cb140-1" aria-hidden="true" tabindex="-1"></a>normal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"normalCleaned.csv"</span>)</span>
<span id="cb140-2"><a href="#cb140-2" aria-hidden="true" tabindex="-1"></a>percentageChange <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"percentageChangeCleaned.csv"</span>)</span>
<span id="cb140-3"><a href="#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="#cb140-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-5"><a href="#cb140-5" aria-hidden="true" tabindex="-1"></a><span class="co">#1. remove first column</span></span>
<span id="cb140-6"><a href="#cb140-6" aria-hidden="true" tabindex="-1"></a><span class="co">#2. inner merge raw with %change wit relevant data</span></span>
<span id="cb140-7"><a href="#cb140-7" aria-hidden="true" tabindex="-1"></a><span class="co"># change factor variables to factor</span></span>
<span id="cb140-8"><a href="#cb140-8" aria-hidden="true" tabindex="-1"></a><span class="co">#3. create y variables with measurements</span></span>
<span id="cb140-9"><a href="#cb140-9" aria-hidden="true" tabindex="-1"></a><span class="co">#4. select variables to run regression</span></span>
<span id="cb140-10"><a href="#cb140-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-11"><a href="#cb140-11" aria-hidden="true" tabindex="-1"></a>normal_selected <span class="ot">&lt;-</span> normal <span class="sc">%&gt;%</span> </span>
<span id="cb140-12"><a href="#cb140-12" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, </span>
<span id="cb140-13"><a href="#cb140-13" aria-hidden="true" tabindex="-1"></a>                debt_to_equity, </span>
<span id="cb140-14"><a href="#cb140-14" aria-hidden="true" tabindex="-1"></a>                return_on_equity, </span>
<span id="cb140-15"><a href="#cb140-15" aria-hidden="true" tabindex="-1"></a>                profit_margin, </span>
<span id="cb140-16"><a href="#cb140-16" aria-hidden="true" tabindex="-1"></a>                inventory_turnover, </span>
<span id="cb140-17"><a href="#cb140-17" aria-hidden="true" tabindex="-1"></a>                z_score, </span>
<span id="cb140-18"><a href="#cb140-18" aria-hidden="true" tabindex="-1"></a>                working_capital, </span>
<span id="cb140-19"><a href="#cb140-19" aria-hidden="true" tabindex="-1"></a>                industry, </span>
<span id="cb140-20"><a href="#cb140-20" aria-hidden="true" tabindex="-1"></a>                current_ratio, </span>
<span id="cb140-21"><a href="#cb140-21" aria-hidden="true" tabindex="-1"></a>                restated_later, </span>
<span id="cb140-22"><a href="#cb140-22" aria-hidden="true" tabindex="-1"></a>                overvaluation)</span>
<span id="cb140-23"><a href="#cb140-23" aria-hidden="true" tabindex="-1"></a><span class="co">#, total_debt, total_assets, cost_of_goods_sold, cash_flow, net_income, accounts_payable</span></span>
<span id="cb140-24"><a href="#cb140-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-25"><a href="#cb140-25" aria-hidden="true" tabindex="-1"></a>percentageChange <span class="ot">&lt;-</span> percentageChange <span class="sc">%&gt;%</span></span>
<span id="cb140-26"><a href="#cb140-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rd =</span> <span class="st">`</span><span class="at">R&amp;D</span><span class="st">`</span>)</span>
<span id="cb140-27"><a href="#cb140-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-28"><a href="#cb140-28" aria-hidden="true" tabindex="-1"></a>percentageChange_selected <span class="ot">&lt;-</span> percentageChange <span class="sc">%&gt;%</span> </span>
<span id="cb140-29"><a href="#cb140-29" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, </span>
<span id="cb140-30"><a href="#cb140-30" aria-hidden="true" tabindex="-1"></a>                revenue, </span>
<span id="cb140-31"><a href="#cb140-31" aria-hidden="true" tabindex="-1"></a>                net_income, </span>
<span id="cb140-32"><a href="#cb140-32" aria-hidden="true" tabindex="-1"></a>                cash_flow, </span>
<span id="cb140-33"><a href="#cb140-33" aria-hidden="true" tabindex="-1"></a>                total_debt, </span>
<span id="cb140-34"><a href="#cb140-34" aria-hidden="true" tabindex="-1"></a>                rd,</span>
<span id="cb140-35"><a href="#cb140-35" aria-hidden="true" tabindex="-1"></a>                accounts_receivable_days, </span>
<span id="cb140-36"><a href="#cb140-36" aria-hidden="true" tabindex="-1"></a>                market_cap) <span class="sc">%&gt;%</span> </span>
<span id="cb140-37"><a href="#cb140-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">revenue_pctc =</span> revenue, </span>
<span id="cb140-38"><a href="#cb140-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">net_income_pctc =</span> net_income, </span>
<span id="cb140-39"><a href="#cb140-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">cash_flow_pctc =</span> cash_flow, </span>
<span id="cb140-40"><a href="#cb140-40" aria-hidden="true" tabindex="-1"></a>         <span class="at">total_debt_pctc =</span> total_debt, </span>
<span id="cb140-41"><a href="#cb140-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">accounts_receivable_days_pctc =</span> accounts_receivable_days, </span>
<span id="cb140-42"><a href="#cb140-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">market_cap_pctc =</span> market_cap, </span>
<span id="cb140-43"><a href="#cb140-43" aria-hidden="true" tabindex="-1"></a>         <span class="at">rd_pctc =</span> rd</span>
<span id="cb140-44"><a href="#cb140-44" aria-hidden="true" tabindex="-1"></a>         )</span>
<span id="cb140-45"><a href="#cb140-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-46"><a href="#cb140-46" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets on code and year_</span></span>
<span id="cb140-47"><a href="#cb140-47" aria-hidden="true" tabindex="-1"></a>healthcare_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(normal_selected, percentageChange_selected, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"year_"</span>))</span>
<span id="cb140-48"><a href="#cb140-48" aria-hidden="true" tabindex="-1"></a><span class="co"># View(healthcare_df)</span></span>
<span id="cb140-49"><a href="#cb140-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-50"><a href="#cb140-50" aria-hidden="true" tabindex="-1"></a><span class="co"># Computing weights (Will not be used for this analysis, but will be kept for completion)</span></span>
<span id="cb140-51"><a href="#cb140-51" aria-hidden="true" tabindex="-1"></a>n0 <span class="ot">&lt;-</span> <span class="fu">sum</span>(healthcare_df<span class="sc">$</span>restated_later <span class="sc">==</span> <span class="dv">0</span>)</span>
<span id="cb140-52"><a href="#cb140-52" aria-hidden="true" tabindex="-1"></a>n1 <span class="ot">&lt;-</span> <span class="fu">sum</span>(healthcare_df<span class="sc">$</span>restated_later <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb140-53"><a href="#cb140-53" aria-hidden="true" tabindex="-1"></a>w0 <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb140-54"><a href="#cb140-54" aria-hidden="true" tabindex="-1"></a>w1 <span class="ot">&lt;-</span> n0 <span class="sc">/</span> n1</span>
<span id="cb140-55"><a href="#cb140-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-56"><a href="#cb140-56" aria-hidden="true" tabindex="-1"></a>healthcare_df <span class="ot">&lt;-</span> healthcare_df <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">dte_flag =</span> <span class="fu">ifelse</span>(debt_to_equity <span class="sc">&lt;=</span> <span class="fl">1.5</span> <span class="sc">&amp;</span> debt_to_equity <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="at">overvaluation =</span> <span class="fu">as.factor</span>(overvaluation), <span class="at">restated_later =</span> <span class="fu">as.factor</span>(restated_later), <span class="at">wgt =</span> <span class="fu">ifelse</span>(restated_later <span class="sc">==</span> <span class="dv">1</span>, w1, w0), <span class="at">industry =</span> <span class="fu">as.factor</span>(industry)) <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>debt_to_equity)</span>
<span id="cb140-57"><a href="#cb140-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-58"><a href="#cb140-58" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace Inf and -Inf values with 0 only for numeric columns</span></span>
<span id="cb140-59"><a href="#cb140-59" aria-hidden="true" tabindex="-1"></a>healthcare_df[] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(healthcare_df, <span class="cf">function</span>(x) {</span>
<span id="cb140-60"><a href="#cb140-60" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb140-61"><a href="#cb140-61" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">replace</span>(x, <span class="fu">is.infinite</span>(x), <span class="dv">0</span>)  <span class="co"># Replace Inf and -Inf with NA in numeric columns</span></span>
<span id="cb140-62"><a href="#cb140-62" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb140-63"><a href="#cb140-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(x)</span>
<span id="cb140-64"><a href="#cb140-64" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb140-65"><a href="#cb140-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-66"><a href="#cb140-66" aria-hidden="true" tabindex="-1"></a>restated_healthcare_df <span class="ot">&lt;-</span> healthcare_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="splitting-into-2019-2022-and-2023-data" class="level2">
<h2 class="anchored" data-anchor-id="splitting-into-2019-2022-and-2023-data">Splitting into 2019-2022 and 2023 data</h2>
<p>This is done as the model will be trained and tested on 2019-2022 data, while 2023 data will be used to make the predictions</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a>data_2023 <span class="ot">&lt;-</span> restated_healthcare_df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year_ <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb141-2"><a href="#cb141-2" aria-hidden="true" tabindex="-1"></a>data_2023 <span class="ot">&lt;-</span> data_2023[, <span class="sc">!</span>(<span class="fu">names</span>(restated_healthcare_df) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"year_"</span>,<span class="st">"wgt"</span>))]</span>
<span id="cb141-3"><a href="#cb141-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb141-4"><a href="#cb141-4" aria-hidden="true" tabindex="-1"></a>df_prepped <span class="ot">&lt;-</span> restated_healthcare_df <span class="sc">|&gt;</span> <span class="fu">filter</span>(year_ <span class="sc">!=</span> <span class="dv">2023</span>)</span>
<span id="cb141-5"><a href="#cb141-5" aria-hidden="true" tabindex="-1"></a>df_prepped <span class="ot">&lt;-</span> df_prepped[, <span class="sc">!</span>(<span class="fu">names</span>(restated_healthcare_df) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"code"</span>,<span class="st">"year_"</span>,<span class="st">"wgt"</span>))]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="eda" class="level2">
<h2 class="anchored" data-anchor-id="eda">EDA</h2>
<p>As we can see here, the data is extremely imbalanced. In order to proceed, we will have to apply Synthetic Minority Oversampling Technique to obtain a balanced training dataset. (We note that this method should be used with caution and that it does not always perform well on real world data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="#cb142-1" aria-hidden="true" tabindex="-1"></a>data_2023 <span class="sc">%&gt;%</span></span>
<span id="cb142-2"><a href="#cb142-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(restated_later) <span class="sc">%&gt;%</span></span>
<span id="cb142-3"><a href="#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percentage =</span> n <span class="sc">/</span> <span class="fu">sum</span>(n)) <span class="sc">%&gt;%</span></span>
<span id="cb142-4"><a href="#cb142-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> restated_later, <span class="at">y =</span> percentage)) <span class="sc">+</span></span>
<span id="cb142-5"><a href="#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb142-6"><a href="#cb142-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Proportion of Restatements"</span>, <span class="at">x =</span> <span class="st">"Restated"</span>, <span class="at">y =</span> <span class="st">"Proportion"</span>) <span class="sc">+</span></span>
<span id="cb142-7"><a href="#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-48-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="data-check" class="level2">
<h2 class="anchored" data-anchor-id="data-check">Data check</h2>
<p>Prior to applying SMOTE, the dataset (df_prepped) was thoroughly examined to ensure data integrity and suitability for resampling. First, missing values were identified using anyNA() and sum(is.na()), confirming whether imputation or row removal was necessary. Next, constant columns—those with only one unique value—were flagged across both numeric and categorical variables, as such features provide no discriminative power and can be excluded from modeling. A check was then performed to identify which columns were numeric, followed by calculating the variance of each numeric column to detect features with little or no variability, which may be poor predictors. Lastly, the factor (categorical) variables were inspected to verify that each had more than one level, ensuring they were meaningful for classification. This comprehensive data audit ensured that only relevant, clean, and informative features were passed into the SMOTE algorithm for effective class balancing.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Check for Missing Values ---</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Any NA values in df_prepped:"</span>, <span class="fu">anyNA</span>(df_prepped), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Any NA values in df_prepped: FALSE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Total NA count:"</span>, <span class="fu">sum</span>(<span class="fu">is.na</span>(df_prepped)), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Total NA count: 0 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Identify Constant Columns ---</span></span>
<span id="cb147-2"><a href="#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For numeric columns, constant means only one unique value.</span></span>
<span id="cb147-3"><a href="#cb147-3" aria-hidden="true" tabindex="-1"></a><span class="co"># For factors, constant means only one level.</span></span>
<span id="cb147-4"><a href="#cb147-4" aria-hidden="true" tabindex="-1"></a>constant_cols <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df_prepped, <span class="cf">function</span>(x) {</span>
<span id="cb147-5"><a href="#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.numeric</span>(x)) {</span>
<span id="cb147-6"><a href="#cb147-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">length</span>(<span class="fu">unique</span>(x)) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb147-7"><a href="#cb147-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (<span class="fu">is.factor</span>(x)) {</span>
<span id="cb147-8"><a href="#cb147-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">length</span>(<span class="fu">levels</span>(x)) <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb147-9"><a href="#cb147-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb147-10"><a href="#cb147-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb147-11"><a href="#cb147-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb147-12"><a href="#cb147-12" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb147-13"><a href="#cb147-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Constant columns overall:"</span>, <span class="fu">names</span>(df_prepped)[constant_cols], <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Constant columns overall:  </code></pre>
</div>
<div class="sourceCode cell-code" id="cb149"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb149-1"><a href="#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Check which columns are numeric ---</span></span>
<span id="cb149-2"><a href="#cb149-2" aria-hidden="true" tabindex="-1"></a>numeric_flags <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df_prepped, is.numeric)</span>
<span id="cb149-3"><a href="#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Numeric columns:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numeric columns:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(numeric_flags)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             return_on_equity                 profit_margin 
                         TRUE                          TRUE 
           inventory_turnover                       z_score 
                         TRUE                          TRUE 
              working_capital                      industry 
                         TRUE                         FALSE 
                current_ratio                restated_later 
                         TRUE                         FALSE 
                overvaluation                  revenue_pctc 
                        FALSE                          TRUE 
              net_income_pctc                cash_flow_pctc 
                         TRUE                          TRUE 
              total_debt_pctc                       rd_pctc 
                         TRUE                          TRUE 
accounts_receivable_days_pctc               market_cap_pctc 
                         TRUE                          TRUE 
                     dte_flag 
                         TRUE </code></pre>
</div>
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure we only select numeric columns:</span></span>
<span id="cb153-2"><a href="#cb153-2" aria-hidden="true" tabindex="-1"></a>numeric_data <span class="ot">&lt;-</span> df_prepped[, <span class="fu">which</span>(numeric_flags), drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb153-3"><a href="#cb153-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-4"><a href="#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Calculate variances for numeric columns ---</span></span>
<span id="cb153-5"><a href="#cb153-5" aria-hidden="true" tabindex="-1"></a>variances <span class="ot">&lt;-</span> <span class="fu">sapply</span>(numeric_data, <span class="cf">function</span>(x) <span class="fu">var</span>(x, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb153-6"><a href="#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Variances for numeric columns (overall):</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Variances for numeric columns (overall):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb155"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb155-1"><a href="#cb155-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(variances)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             return_on_equity                 profit_margin 
                 3.562598e+05                  7.037788e+09 
           inventory_turnover                       z_score 
                 7.776366e+06                  4.920515e+07 
              working_capital                 current_ratio 
                 5.184127e+22                  7.732376e+03 
                 revenue_pctc               net_income_pctc 
                 1.811135e+05                  8.120585e+03 
               cash_flow_pctc               total_debt_pctc 
                 5.076415e+04                  4.733340e+07 
                      rd_pctc accounts_receivable_days_pctc 
                 1.860948e+03                  7.230476e+04 
              market_cap_pctc                      dte_flag 
                 9.149879e+03                  1.920227e-01 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb157"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb157-1"><a href="#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 5. Check Categorical Variables ---</span></span>
<span id="cb157-2"><a href="#cb157-2" aria-hidden="true" tabindex="-1"></a>categorical_vars <span class="ot">&lt;-</span> <span class="fu">sapply</span>(df_prepped, is.factor)</span>
<span id="cb157-3"><a href="#cb157-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Categorical variable levels:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Categorical variable levels:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb159"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb159-1"><a href="#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> <span class="fu">names</span>(df_prepped)[categorical_vars]) {</span>
<span id="cb159-2"><a href="#cb159-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(col, <span class="st">"levels:"</span>, <span class="fu">paste</span>(<span class="fu">levels</span>(df_prepped[[col]]), <span class="at">collapse =</span> <span class="st">", "</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb159-3"><a href="#cb159-3" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>industry levels: 3400, 3410, 3420, 3430, 3440, 7040, 8550 
restated_later levels: 0, 1 
overvaluation levels: 0, 1 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb161"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb161-1"><a href="#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="smote" class="level2">
<h2 class="anchored" data-anchor-id="smote">SMOTE</h2>
<section id="preparing-data-for-smote" class="level3">
<h3 class="anchored" data-anchor-id="preparing-data-for-smote">Preparing Data for SMOTE</h3>
<p>Set a train-test split. The SMOTE will only be applied on the training set, but we ensure that the data is similar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb162"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb162-1"><a href="#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb162-2"><a href="#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)  <span class="co"># for reproducibility</span></span>
<span id="cb162-3"><a href="#cb162-3" aria-hidden="true" tabindex="-1"></a>train_indices <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">seq_len</span>(<span class="fu">nrow</span>(df_prepped)), <span class="at">size =</span> <span class="fl">0.8</span> <span class="sc">*</span> <span class="fu">nrow</span>(df_prepped))</span>
<span id="cb162-4"><a href="#cb162-4" aria-hidden="true" tabindex="-1"></a>train_data <span class="ot">&lt;-</span> df_prepped[train_indices, ]</span>
<span id="cb162-5"><a href="#cb162-5" aria-hidden="true" tabindex="-1"></a>test_data  <span class="ot">&lt;-</span> df_prepped[<span class="sc">-</span>train_indices, ]</span>
<span id="cb162-6"><a href="#cb162-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-7"><a href="#cb162-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Training set rows:"</span>, <span class="fu">nrow</span>(train_data), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Training set rows: 13599 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb164"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb164-1"><a href="#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Test set rows:"</span>, <span class="fu">nrow</span>(test_data), <span class="st">"</span><span class="sc">\n\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Test set rows: 3400 </code></pre>
</div>
</div>
<p>Continuous variables are identified and normalized in the training set using the scale() function, which centers and scales them (zero mean, unit variance). This is important to ensure that variables with different units or magnitudes do not dominate the model. The scaling parameters (mean and standard deviation) are stored for later use on the test data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb166"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb166-1"><a href="#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb166-2"><a href="#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 1. Normalization of Continuous Variables ---</span></span>
<span id="cb166-3"><a href="#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="co"># -------------------------------------------------</span></span>
<span id="cb166-4"><a href="#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the continuous variables (adjust as appropriate)</span></span>
<span id="cb166-6"><a href="#cb166-6" aria-hidden="true" tabindex="-1"></a>continuous_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"return_on_equity"</span>, <span class="st">"profit_margin"</span>, <span class="st">"inventory_turnover"</span>,</span>
<span id="cb166-7"><a href="#cb166-7" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"z_score"</span>, <span class="st">"working_capital"</span>, <span class="st">"current_ratio"</span>, <span class="st">"revenue_pctc"</span>,</span>
<span id="cb166-8"><a href="#cb166-8" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"net_income_pctc"</span>, <span class="st">"cash_flow_pctc"</span>, <span class="st">"total_debt_pctc"</span>, <span class="st">"rd_pctc"</span>,</span>
<span id="cb166-9"><a href="#cb166-9" aria-hidden="true" tabindex="-1"></a>                     <span class="st">"accounts_receivable_days_pctc"</span>, <span class="st">"market_cap_pctc"</span>)</span>
<span id="cb166-10"><a href="#cb166-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-11"><a href="#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="do">## Normalize continuous predictors in the training set</span></span>
<span id="cb166-12"><a href="#cb166-12" aria-hidden="true" tabindex="-1"></a>scaled_train <span class="ot">&lt;-</span> <span class="fu">scale</span>(train_data[continuous_vars])</span>
<span id="cb166-13"><a href="#cb166-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-14"><a href="#cb166-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract scaling parameters from the scaled matrix</span></span>
<span id="cb166-15"><a href="#cb166-15" aria-hidden="true" tabindex="-1"></a>center_vals <span class="ot">&lt;-</span> <span class="fu">attr</span>(scaled_train, <span class="st">"scaled:center"</span>)</span>
<span id="cb166-16"><a href="#cb166-16" aria-hidden="true" tabindex="-1"></a>scale_vals  <span class="ot">&lt;-</span> <span class="fu">attr</span>(scaled_train, <span class="st">"scaled:scale"</span>)</span>
<span id="cb166-17"><a href="#cb166-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-18"><a href="#cb166-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Assign the scaled values back to the training set</span></span>
<span id="cb166-19"><a href="#cb166-19" aria-hidden="true" tabindex="-1"></a>train_data[continuous_vars] <span class="ot">&lt;-</span> scaled_train</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The same scaling applied to the training set is used on the test set and 2023 set to ensure consistency. The mean and standard deviation values calculated from the training set (center_vals and scale_vals) are applied to scale the test set variables, ensuring that both sets are on the same scale for model evaluation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb167"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb167-1"><a href="#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb167-2"><a href="#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 2. Apply the Same Scaling to the Test Set ---</span></span>
<span id="cb167-3"><a href="#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb167-4"><a href="#cb167-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-5"><a href="#cb167-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the test set continuous subset to a matrix</span></span>
<span id="cb167-6"><a href="#cb167-6" aria-hidden="true" tabindex="-1"></a>test_continuous <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(test_data[continuous_vars])</span>
<span id="cb167-7"><a href="#cb167-7" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensions of test_continuous matrix:"</span>, <span class="fu">dim</span>(test_continuous), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensions of test_continuous matrix: 3400 13 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb169"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb169-1"><a href="#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply scaling to the test set using the parameters from the training set</span></span>
<span id="cb169-2"><a href="#cb169-2" aria-hidden="true" tabindex="-1"></a>test_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(test_continuous, <span class="at">center =</span> center_vals, <span class="at">scale =</span> scale_vals)</span>
<span id="cb169-3"><a href="#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="#cb169-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the test set continuous columns with the scaled values</span></span>
<span id="cb169-5"><a href="#cb169-5" aria-hidden="true" tabindex="-1"></a>test_data[continuous_vars] <span class="ot">&lt;-</span> test_scaled</span>
<span id="cb169-6"><a href="#cb169-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-7"><a href="#cb169-7" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb169-8"><a href="#cb169-8" aria-hidden="true" tabindex="-1"></a><span class="co"># --- 3. Apply the Same Scaling to the 2023 data ---</span></span>
<span id="cb169-9"><a href="#cb169-9" aria-hidden="true" tabindex="-1"></a><span class="co"># --------------------------------------------------</span></span>
<span id="cb169-10"><a href="#cb169-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-11"><a href="#cb169-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert the test set continuous subset to a matrix</span></span>
<span id="cb169-12"><a href="#cb169-12" aria-hidden="true" tabindex="-1"></a>new_continuous <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(data_2023[continuous_vars])</span>
<span id="cb169-13"><a href="#cb169-13" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Dimensions of 2023 data matrix:"</span>, <span class="fu">dim</span>(new_continuous), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Dimensions of 2023 data matrix: 4180 13 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb171"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb171-1"><a href="#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply scaling to the test set using the parameters from the training set</span></span>
<span id="cb171-2"><a href="#cb171-2" aria-hidden="true" tabindex="-1"></a>new_scaled <span class="ot">&lt;-</span> <span class="fu">scale</span>(new_continuous, <span class="at">center =</span> center_vals, <span class="at">scale =</span> scale_vals)</span>
<span id="cb171-3"><a href="#cb171-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-4"><a href="#cb171-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the test set continuous columns with the scaled values</span></span>
<span id="cb171-5"><a href="#cb171-5" aria-hidden="true" tabindex="-1"></a>data_2023[continuous_vars] <span class="ot">&lt;-</span> new_scaled</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ubl-smote-execution" class="level3">
<h3 class="anchored" data-anchor-id="ubl-smote-execution">UBL SMOTE Execution</h3>
<p>To prepare the training data for modeling with SMOTE, the dataset was first converted into a fully numeric format using model.matrix(), which transforms categorical variables into dummy variables while preserving numerical features. The target variable restated_later was then added back to the transformed training, test, and 2023 datasets. Using the SmoteClassif() function from the UBL package, SMOTE was applied to the training data to synthetically balance the classes, with C.perc = “balance” specifying equal representation for both restated and non-restated companies. After SMOTE, post-processing steps were performed to clean and realign variables. The binary variable dte_flag was thresholded and recoded as a factor, while a new overvaluation flag was derived from the overvaluation1 dummy, which was subsequently removed. Similarly, restated_later was reassigned using the generated restated_later1 column and cleaned up for consistency. This process ensured that the balanced dataset was clean, interpretable, and ready for downstream modeling.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb172"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb172-1"><a href="#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure that all data is in dataframe format</span></span>
<span id="cb172-2"><a href="#cb172-2" aria-hidden="true" tabindex="-1"></a>train_data_numeric <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> train_data))</span>
<span id="cb172-3"><a href="#cb172-3" aria-hidden="true" tabindex="-1"></a>train_data_numeric<span class="sc">$</span>restated_later <span class="ot">&lt;-</span> train_data<span class="sc">$</span>restated_later</span>
<span id="cb172-4"><a href="#cb172-4" aria-hidden="true" tabindex="-1"></a>test_data_numeric <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> test_data))</span>
<span id="cb172-5"><a href="#cb172-5" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>restated_later <span class="ot">&lt;-</span> test_data<span class="sc">$</span>restated_later</span>
<span id="cb172-6"><a href="#cb172-6" aria-hidden="true" tabindex="-1"></a>data_2023_numeric <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">model.matrix</span>(<span class="sc">~</span> . <span class="sc">-</span> <span class="dv">1</span>, <span class="at">data =</span> data_2023))</span>
<span id="cb172-7"><a href="#cb172-7" aria-hidden="true" tabindex="-1"></a>data_2023_numeric<span class="sc">$</span>restated_later <span class="ot">&lt;-</span> data_2023<span class="sc">$</span>restated_later</span>
<span id="cb172-8"><a href="#cb172-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-9"><a href="#cb172-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-10"><a href="#cb172-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(UBL)</span>
<span id="cb172-11"><a href="#cb172-11" aria-hidden="true" tabindex="-1"></a><span class="co"># UBL's SmoteClassif() uses a formula interface and expects the target variable</span></span>
<span id="cb172-12"><a href="#cb172-12" aria-hidden="true" tabindex="-1"></a><span class="co"># to be included in the data frame. Here, C.perc = "balance" tells UBL to balance the classes.</span></span>
<span id="cb172-13"><a href="#cb172-13" aria-hidden="true" tabindex="-1"></a>smote_data_ubl <span class="ot">&lt;-</span> <span class="fu">SmoteClassif</span>(restated_later <span class="sc">~</span> .,</span>
<span id="cb172-14"><a href="#cb172-14" aria-hidden="true" tabindex="-1"></a>                               train_data_numeric, <span class="at">C.perc =</span> <span class="st">"balance"</span>)</span>
<span id="cb172-15"><a href="#cb172-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb172-16"><a href="#cb172-16" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Class distribution after SMOTE:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Class distribution after SMOTE:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb174"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb174-1"><a href="#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">table</span>(smote_data_ubl<span class="sc">$</span>restated_later))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   0    1 
6800 6800 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb176"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb176-1"><a href="#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For a binary variable like dte_flag:</span></span>
<span id="cb176-2"><a href="#cb176-2" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>dte_flag <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(smote_data_ubl<span class="sc">$</span>dte_flag <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb176-3"><a href="#cb176-3" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>dte_flag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(smote_data_ubl<span class="sc">$</span>dte_flag)</span>
<span id="cb176-4"><a href="#cb176-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-5"><a href="#cb176-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Recalibrate overvaluation and remove overvaluation1 for consistency</span></span>
<span id="cb176-6"><a href="#cb176-6" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>overvaluation <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(smote_data_ubl<span class="sc">$</span>overvaluation1 <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb176-7"><a href="#cb176-7" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>overvaluation <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(smote_data_ubl<span class="sc">$</span>overvaluation)</span>
<span id="cb176-8"><a href="#cb176-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-9"><a href="#cb176-9" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>overvaluation1 <span class="ot">&lt;-</span> <span class="cn">NULL</span> <span class="co"># Remove overvaluation1</span></span>
<span id="cb176-10"><a href="#cb176-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-11"><a href="#cb176-11" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>restated_later <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(smote_data_ubl<span class="sc">$</span>restated_later1)</span>
<span id="cb176-12"><a href="#cb176-12" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>restated_later1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dealing-with-industries-as-they-became-numeric" class="level3">
<h3 class="anchored" data-anchor-id="dealing-with-industries-as-they-became-numeric">Dealing with industries as they became numeric</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb177"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb177-1"><a href="#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the dummy columns for industry:</span></span>
<span id="cb177-2"><a href="#cb177-2" aria-hidden="true" tabindex="-1"></a>industry_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^industry"</span>, <span class="fu">colnames</span>(smote_data_ubl), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb177-3"><a href="#cb177-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-4"><a href="#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="co"># For each observation, find the industry with the maximum value.</span></span>
<span id="cb177-5"><a href="#cb177-5" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assumes that the synthetic values are close to 0 or 1.)</span></span>
<span id="cb177-6"><a href="#cb177-6" aria-hidden="true" tabindex="-1"></a>industry_numeric <span class="ot">&lt;-</span> <span class="fu">apply</span>(smote_data_ubl[, industry_cols, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="dv">1</span>, which.max)</span>
<span id="cb177-7"><a href="#cb177-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-8"><a href="#cb177-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a factor variable for industry by mapping the index to the original levels.</span></span>
<span id="cb177-9"><a href="#cb177-9" aria-hidden="true" tabindex="-1"></a><span class="co"># First, extract the original industry levels from the training set, for example:</span></span>
<span id="cb177-10"><a href="#cb177-10" aria-hidden="true" tabindex="-1"></a>original_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(train_data<span class="sc">$</span>industry)</span>
<span id="cb177-11"><a href="#cb177-11" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="fu">factor</span>(original_levels[industry_numeric])</span>
<span id="cb177-12"><a href="#cb177-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb177-13"><a href="#cb177-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, remove the dummy columns:</span></span>
<span id="cb177-14"><a href="#cb177-14" aria-hidden="true" tabindex="-1"></a>smote_data_ubl <span class="ot">&lt;-</span> smote_data_ubl[, <span class="sc">!</span>(<span class="fu">names</span>(smote_data_ubl) <span class="sc">%in%</span> industry_cols)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cleaning-test-data-and-2023-to-match-smote-dataset" class="level3">
<h3 class="anchored" data-anchor-id="cleaning-test-data-and-2023-to-match-smote-dataset">Cleaning test data and 2023 to match smote dataset</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb178"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb178-1"><a href="#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For a binary variable like dte_flag:</span></span>
<span id="cb178-2"><a href="#cb178-2" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>dte_flag <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_data_numeric<span class="sc">$</span>dte_flag <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb178-3"><a href="#cb178-3" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>dte_flag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test_data_numeric<span class="sc">$</span>dte_flag)</span>
<span id="cb178-4"><a href="#cb178-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-5"><a href="#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Similarly for overvaluation (if it was binary):</span></span>
<span id="cb178-6"><a href="#cb178-6" aria-hidden="true" tabindex="-1"></a><span class="co"># If overvaluation exists as a dummy variable named "overvaluation" or "overvaluation1",</span></span>
<span id="cb178-7"><a href="#cb178-7" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust the code accordingly. Here we assume it is "overvaluation1".</span></span>
<span id="cb178-8"><a href="#cb178-8" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>overvaluation <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(test_data_numeric<span class="sc">$</span>overvaluation1 <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb178-9"><a href="#cb178-9" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>overvaluation <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test_data_numeric<span class="sc">$</span>overvaluation)</span>
<span id="cb178-10"><a href="#cb178-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-11"><a href="#cb178-11" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>overvaluation1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb178-12"><a href="#cb178-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-13"><a href="#cb178-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the dummy columns for industry:</span></span>
<span id="cb178-14"><a href="#cb178-14" aria-hidden="true" tabindex="-1"></a>industry_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^industry"</span>, <span class="fu">colnames</span>(test_data_numeric), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb178-15"><a href="#cb178-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-16"><a href="#cb178-16" aria-hidden="true" tabindex="-1"></a><span class="co"># For each observation, find the industry with the maximum value.</span></span>
<span id="cb178-17"><a href="#cb178-17" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assumes that the synthetic values are close to 0 or 1.)</span></span>
<span id="cb178-18"><a href="#cb178-18" aria-hidden="true" tabindex="-1"></a>industry_numeric <span class="ot">&lt;-</span> <span class="fu">apply</span>(test_data_numeric[, industry_cols, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="dv">1</span>, which.max)</span>
<span id="cb178-19"><a href="#cb178-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-20"><a href="#cb178-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a factor variable for industry by mapping the index to the original levels.</span></span>
<span id="cb178-21"><a href="#cb178-21" aria-hidden="true" tabindex="-1"></a><span class="co"># First, extract the original industry levels from the training set, for example:</span></span>
<span id="cb178-22"><a href="#cb178-22" aria-hidden="true" tabindex="-1"></a>original_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(test_data<span class="sc">$</span>industry)</span>
<span id="cb178-23"><a href="#cb178-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Now assign the appropriate level. (Be careful: if dummy coding dropped a reference, you may need to adjust.)</span></span>
<span id="cb178-24"><a href="#cb178-24" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="fu">factor</span>(original_levels[industry_numeric])</span>
<span id="cb178-25"><a href="#cb178-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb178-26"><a href="#cb178-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, remove the dummy columns:</span></span>
<span id="cb178-27"><a href="#cb178-27" aria-hidden="true" tabindex="-1"></a>test_data_numeric <span class="ot">&lt;-</span> test_data_numeric[, <span class="sc">!</span>(<span class="fu">names</span>(test_data_numeric) <span class="sc">%in%</span> industry_cols)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="data" class="level3">
<h3 class="anchored" data-anchor-id="data">2023 Data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb179"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb179-1"><a href="#cb179-1" aria-hidden="true" tabindex="-1"></a><span class="co"># For a binary variable like dte_flag:</span></span>
<span id="cb179-2"><a href="#cb179-2" aria-hidden="true" tabindex="-1"></a>data_2023_numeric<span class="sc">$</span>dte_flag <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_2023_numeric<span class="sc">$</span>dte_flag <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb179-3"><a href="#cb179-3" aria-hidden="true" tabindex="-1"></a>data_2023_numeric<span class="sc">$</span>dte_flag <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data_2023_numeric<span class="sc">$</span>dte_flag)</span>
<span id="cb179-4"><a href="#cb179-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-5"><a href="#cb179-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Similarly for overvaluation (if it was binary):</span></span>
<span id="cb179-6"><a href="#cb179-6" aria-hidden="true" tabindex="-1"></a><span class="co"># If overvaluation exists as a dummy variable named "overvaluation" or "overvaluation1",</span></span>
<span id="cb179-7"><a href="#cb179-7" aria-hidden="true" tabindex="-1"></a><span class="co"># adjust the code accordingly. Here we assume it is "overvaluation1".</span></span>
<span id="cb179-8"><a href="#cb179-8" aria-hidden="true" tabindex="-1"></a>data_2023_numeric<span class="sc">$</span>overvaluation <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(data_2023_numeric<span class="sc">$</span>overvaluation1 <span class="sc">&lt;</span> <span class="fl">0.5</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb179-9"><a href="#cb179-9" aria-hidden="true" tabindex="-1"></a>data_2023_numeric<span class="sc">$</span>overvaluation <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(data_2023_numeric<span class="sc">$</span>overvaluation)</span>
<span id="cb179-10"><a href="#cb179-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-11"><a href="#cb179-11" aria-hidden="true" tabindex="-1"></a>data_2023_numeric<span class="sc">$</span>overvaluation1 <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb179-12"><a href="#cb179-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-13"><a href="#cb179-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify the dummy columns for industry:</span></span>
<span id="cb179-14"><a href="#cb179-14" aria-hidden="true" tabindex="-1"></a>industry_cols <span class="ot">&lt;-</span> <span class="fu">grep</span>(<span class="st">"^industry"</span>, <span class="fu">colnames</span>(data_2023_numeric), <span class="at">value =</span> <span class="cn">TRUE</span>)</span>
<span id="cb179-15"><a href="#cb179-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-16"><a href="#cb179-16" aria-hidden="true" tabindex="-1"></a><span class="co"># For each observation, find the industry with the maximum value.</span></span>
<span id="cb179-17"><a href="#cb179-17" aria-hidden="true" tabindex="-1"></a><span class="co"># (Assumes that the synthetic values are close to 0 or 1.)</span></span>
<span id="cb179-18"><a href="#cb179-18" aria-hidden="true" tabindex="-1"></a>industry_numeric <span class="ot">&lt;-</span> <span class="fu">apply</span>(data_2023_numeric[, industry_cols, <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="dv">1</span>, which.max)</span>
<span id="cb179-19"><a href="#cb179-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-20"><a href="#cb179-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a factor variable for industry by mapping the index to the original levels.</span></span>
<span id="cb179-21"><a href="#cb179-21" aria-hidden="true" tabindex="-1"></a><span class="co"># First, extract the original industry levels from the training set, for example:</span></span>
<span id="cb179-22"><a href="#cb179-22" aria-hidden="true" tabindex="-1"></a>original_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(data_2023<span class="sc">$</span>industry)</span>
<span id="cb179-23"><a href="#cb179-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Now assign the appropriate level. (Be careful: if dummy coding dropped a reference, you may need to adjust.)</span></span>
<span id="cb179-24"><a href="#cb179-24" aria-hidden="true" tabindex="-1"></a>data_2023_numeric<span class="sc">$</span>industry <span class="ot">&lt;-</span> <span class="fu">factor</span>(original_levels[industry_numeric])</span>
<span id="cb179-25"><a href="#cb179-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb179-26"><a href="#cb179-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, remove the dummy columns:</span></span>
<span id="cb179-27"><a href="#cb179-27" aria-hidden="true" tabindex="-1"></a>data_2023_numeric <span class="ot">&lt;-</span> data_2023_numeric[, <span class="sc">!</span>(<span class="fu">names</span>(data_2023_numeric) <span class="sc">%in%</span> industry_cols)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We now test the various models, starting with the base logistic regression model</p>
</section>
</section>
<section id="base-logistic-model" class="level2">
<h2 class="anchored" data-anchor-id="base-logistic-model">Base Logistic Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb180"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb180-1"><a href="#cb180-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">glm</span>(restated_later <span class="sc">~</span> ., <span class="at">data =</span> smote_data_ubl, <span class="at">family =</span> binomial)</span>
<span id="cb180-2"><a href="#cb180-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = restated_later ~ ., family = binomial, data = smote_data_ubl)

Coefficients:
                              Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                   -0.23872    0.22331  -1.069 0.285065    
return_on_equity               0.14368    0.03282   4.377  1.2e-05 ***
profit_margin                  0.07324    0.11057   0.662 0.507724    
inventory_turnover             0.04612    0.03070   1.502 0.132976    
z_score                       -0.02103    0.02582  -0.814 0.415537    
working_capital                0.02922    0.02388   1.223 0.221219    
current_ratio                 -0.46343    0.13635  -3.399 0.000677 ***
revenue_pctc                  -0.19749    0.17188  -1.149 0.250551    
net_income_pctc               -0.05298    0.03567  -1.485 0.137463    
cash_flow_pctc                 0.08802    0.06250   1.408 0.159029    
total_debt_pctc               -0.15539    0.21036  -0.739 0.460081    
rd_pctc                       -0.42035    0.23921  -1.757 0.078879 .  
accounts_receivable_days_pctc -0.03598    0.08105  -0.444 0.657123    
market_cap_pctc               -0.24803    0.31518  -0.787 0.431316    
dte_flag1                      0.47750    0.04530  10.540  &lt; 2e-16 ***
overvaluation1                -0.16307    0.04236  -3.850 0.000118 ***
industry3410                  -0.07527    0.22537  -0.334 0.738403    
industry3420                   0.09051    0.23190   0.390 0.696313    
industry3430                  -0.18874    0.22192  -0.850 0.395053    
industry3440                  -0.22293    0.22331  -0.998 0.318132    
industry7040                  -0.23287    0.27725  -0.840 0.400951    
industry8550                  -0.01206    0.22399  -0.054 0.957047    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 18854  on 13599  degrees of freedom
Residual deviance: 18532  on 13578  degrees of freedom
AIC: 18576

Number of Fisher Scoring iterations: 7</code></pre>
</div>
</div>
<section id="evaluate-normal-logistic-regression-on-test-set" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-normal-logistic-regression-on-test-set">Evaluate normal logistic regression on test set</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb182"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb182-1"><a href="#cb182-1" aria-hidden="true" tabindex="-1"></a>actual <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test_data_numeric<span class="sc">$</span>restated_later)</span>
<span id="cb182-2"><a href="#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(actual) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"0"</span>, <span class="st">"1"</span>)</span>
<span id="cb182-3"><a href="#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="#cb182-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Predicted Probabilities and classes</span></span>
<span id="cb182-5"><a href="#cb182-5" aria-hidden="true" tabindex="-1"></a>pred_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, <span class="at">newdata =</span> test_data_numeric, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb182-6"><a href="#cb182-6" aria-hidden="true" tabindex="-1"></a>pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_probs <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb182-7"><a href="#cb182-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-8"><a href="#cb182-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-9"><a href="#cb182-9" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> actual, <span class="at">Predicted =</span> pred_class)</span>
<span id="cb182-10"><a href="#cb182-10" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      Predicted
Actual    0    1
     0 1217 1771
     1  120  292</code></pre>
</div>
<div class="sourceCode cell-code" id="cb184"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb184-1"><a href="#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to compute metrics robustly</span></span>
<span id="cb184-2"><a href="#cb184-2" aria-hidden="true" tabindex="-1"></a>get_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(cm) {</span>
<span id="cb184-3"><a href="#cb184-3" aria-hidden="true" tabindex="-1"></a>  TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb184-4"><a href="#cb184-4" aria-hidden="true" tabindex="-1"></a>  TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb184-5"><a href="#cb184-5" aria-hidden="true" tabindex="-1"></a>  FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb184-6"><a href="#cb184-6" aria-hidden="true" tabindex="-1"></a>  FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb184-7"><a href="#cb184-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-8"><a href="#cb184-8" aria-hidden="true" tabindex="-1"></a>  sensitivity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TP <span class="sc">+</span> FN) <span class="sc">&gt;</span> <span class="dv">0</span>, TP <span class="sc">/</span> (TP <span class="sc">+</span> FN), <span class="cn">NA</span>)</span>
<span id="cb184-9"><a href="#cb184-9" aria-hidden="true" tabindex="-1"></a>  specificity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TN <span class="sc">+</span> FP) <span class="sc">&gt;</span> <span class="dv">0</span>, TN <span class="sc">/</span> (TN <span class="sc">+</span> FP), <span class="cn">NA</span>)</span>
<span id="cb184-10"><a href="#cb184-10" aria-hidden="true" tabindex="-1"></a>  precision   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TP <span class="sc">+</span> FP) <span class="sc">&gt;</span> <span class="dv">0</span>, TP <span class="sc">/</span> (TP <span class="sc">+</span> FP), <span class="cn">NA</span>)</span>
<span id="cb184-11"><a href="#cb184-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb184-12"><a href="#cb184-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb184-13"><a href="#cb184-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">sensitivity =</span> <span class="fu">round</span>(sensitivity, <span class="dv">4</span>),</span>
<span id="cb184-14"><a href="#cb184-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">specificity =</span> <span class="fu">round</span>(specificity, <span class="dv">4</span>),</span>
<span id="cb184-15"><a href="#cb184-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">precision   =</span> <span class="fu">round</span>(precision, <span class="dv">4</span>)</span>
<span id="cb184-16"><a href="#cb184-16" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb184-17"><a href="#cb184-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb184-18"><a href="#cb184-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb184-19"><a href="#cb184-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute and print performance metrics</span></span>
<span id="cb184-20"><a href="#cb184-20" aria-hidden="true" tabindex="-1"></a>log_metrics <span class="ot">&lt;-</span> <span class="fu">get_metrics</span>(conf_matrix)</span>
<span id="cb184-21"><a href="#cb184-21" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Base Logistic Regression Metrics:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Base Logistic Regression Metrics:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb186"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb186-1"><a href="#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(log_metrics)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
[1] 0.1415

$specificity
[1] 0.9102

$precision
[1] 0.7087</code></pre>
</div>
<div class="sourceCode cell-code" id="cb188"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb188-1"><a href="#cb188-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute ROC and AUC</span></span>
<span id="cb188-2"><a href="#cb188-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb188-3"><a href="#cb188-3" aria-hidden="true" tabindex="-1"></a>roc_log <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> actual, <span class="at">predictor =</span> pred_probs)</span>
<span id="cb188-4"><a href="#cb188-4" aria-hidden="true" tabindex="-1"></a>auc_log <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_log)</span>
<span id="cb188-5"><a href="#cb188-5" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC (Logistic Regression):"</span>, auc_log, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC (Logistic Regression): 0.5899098 </code></pre>
</div>
</div>
<p>Logistic regression performs poorly on the test set, with an AUC below 0.6. It also has poor sensitivity and specificity.</p>
</section>
</section>
<section id="random-forest-2" class="level2">
<h2 class="anchored" data-anchor-id="random-forest-2">Random Forest</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb190"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb190-1"><a href="#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(randomForest)</span>
<span id="cb190-2"><a href="#cb190-2" aria-hidden="true" tabindex="-1"></a>rf_model <span class="ot">&lt;-</span> <span class="fu">randomForest</span>(restated_later <span class="sc">~</span> ., <span class="at">data =</span> smote_data_ubl, </span>
<span id="cb190-3"><a href="#cb190-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ntree =</span> <span class="dv">500</span>, <span class="at">importance =</span> <span class="cn">TRUE</span>)</span>
<span id="cb190-4"><a href="#cb190-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-5"><a href="#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Print a summary of the model</span></span>
<span id="cb190-6"><a href="#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
 randomForest(formula = restated_later ~ ., data = smote_data_ubl,      ntree = 500, importance = TRUE) 
               Type of random forest: classification
                     Number of trees: 500
No. of variables tried at each split: 4

        OOB estimate of  error rate: 16.6%
Confusion matrix:
     0    1 class.error
0 5338 1462   0.2150000
1  795 6005   0.1169118</code></pre>
</div>
<div class="sourceCode cell-code" id="cb192"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb192-1"><a href="#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot variable importance</span></span>
<span id="cb192-2"><a href="#cb192-2" aria-hidden="true" tabindex="-1"></a><span class="fu">varImpPlot</span>(rf_model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-59-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<section id="evaluate-random-forest" class="level3">
<h3 class="anchored" data-anchor-id="evaluate-random-forest">Evaluate Random Forest</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb193"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb193-1"><a href="#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate predictions on the test set</span></span>
<span id="cb193-2"><a href="#cb193-2" aria-hidden="true" tabindex="-1"></a><span class="co"># For classification, type = "response" gives class labels,</span></span>
<span id="cb193-3"><a href="#cb193-3" aria-hidden="true" tabindex="-1"></a><span class="co"># while type = "prob" gives the predicted probabilities.</span></span>
<span id="cb193-4"><a href="#cb193-4" aria-hidden="true" tabindex="-1"></a>rf_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_data_numeric, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb193-5"><a href="#cb193-5" aria-hidden="true" tabindex="-1"></a>rf_pred_probs <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> test_data_numeric, <span class="at">type =</span> <span class="st">"prob"</span>)[, <span class="dv">2</span>]  <span class="co"># probability of class "1"</span></span>
<span id="cb193-6"><a href="#cb193-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb193-7"><a href="#cb193-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a confusion matrix</span></span>
<span id="cb193-8"><a href="#cb193-8" aria-hidden="true" tabindex="-1"></a>conf_matrix <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Predicted =</span> rf_preds, <span class="at">Actual =</span> test_data_numeric<span class="sc">$</span>restated_later)</span>
<span id="cb193-9"><a href="#cb193-9" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(conf_matrix)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         Actual
Predicted    0    1
        0 2386  266
        1  602  146</code></pre>
</div>
<div class="sourceCode cell-code" id="cb195"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb195-1"><a href="#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate Accuracy</span></span>
<span id="cb195-2"><a href="#cb195-2" aria-hidden="true" tabindex="-1"></a>accuracy <span class="ot">&lt;-</span> <span class="fu">sum</span>(<span class="fu">diag</span>(conf_matrix)) <span class="sc">/</span> <span class="fu">sum</span>(conf_matrix)</span>
<span id="cb195-3"><a href="#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Accuracy on test set:"</span>, accuracy, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Accuracy on test set: 0.7447059 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb197"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb197-1"><a href="#cb197-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate AUC using the pROC package</span></span>
<span id="cb197-2"><a href="#cb197-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("pROC")</span></span>
<span id="cb197-3"><a href="#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb197-4"><a href="#cb197-4" aria-hidden="true" tabindex="-1"></a>roc_rf <span class="ot">&lt;-</span> <span class="fu">roc</span>(test_data_numeric<span class="sc">$</span>restated_later, rf_pred_probs)</span>
<span id="cb197-5"><a href="#cb197-5" aria-hidden="true" tabindex="-1"></a>auc_value <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_rf)</span>
<span id="cb197-6"><a href="#cb197-6" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC:"</span>, auc_value, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC: 0.6426702 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb199"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb199-1"><a href="#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract values from the confusion matrix</span></span>
<span id="cb199-2"><a href="#cb199-2" aria-hidden="true" tabindex="-1"></a>TN <span class="ot">&lt;-</span> conf_matrix[<span class="st">"0"</span>, <span class="st">"0"</span>]</span>
<span id="cb199-3"><a href="#cb199-3" aria-hidden="true" tabindex="-1"></a>TP <span class="ot">&lt;-</span> conf_matrix[<span class="st">"1"</span>, <span class="st">"1"</span>]</span>
<span id="cb199-4"><a href="#cb199-4" aria-hidden="true" tabindex="-1"></a>FN <span class="ot">&lt;-</span> conf_matrix[<span class="st">"0"</span>, <span class="st">"1"</span>]</span>
<span id="cb199-5"><a href="#cb199-5" aria-hidden="true" tabindex="-1"></a>FP <span class="ot">&lt;-</span> conf_matrix[<span class="st">"1"</span>, <span class="st">"0"</span>]</span>
<span id="cb199-6"><a href="#cb199-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-7"><a href="#cb199-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute metrics</span></span>
<span id="cb199-8"><a href="#cb199-8" aria-hidden="true" tabindex="-1"></a>sensitivity <span class="ot">&lt;-</span> TP <span class="sc">/</span> (TP <span class="sc">+</span> FN)</span>
<span id="cb199-9"><a href="#cb199-9" aria-hidden="true" tabindex="-1"></a>specificity <span class="ot">&lt;-</span> TN <span class="sc">/</span> (TN <span class="sc">+</span> FP)</span>
<span id="cb199-10"><a href="#cb199-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-11"><a href="#cb199-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Print results</span></span>
<span id="cb199-12"><a href="#cb199-12" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Sensitivity:"</span>, <span class="fu">round</span>(sensitivity, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Sensitivity: 0.3544 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb201"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb201-1"><a href="#cb201-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"Specificity:"</span>, <span class="fu">round</span>(specificity, <span class="dv">4</span>), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Specificity: 0.7985 </code></pre>
</div>
</div>
<p>The random forest has a significantly better AUC and better sensitivity and specificity as well.</p>
</section>
</section>
<section id="lasso-regression" class="level2">
<h2 class="anchored" data-anchor-id="lasso-regression">LASSO Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb203"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb203-1"><a href="#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmnet)</span>
<span id="cb203-2"><a href="#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb203-3"><a href="#cb203-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-4"><a href="#cb203-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Define formula</span></span>
<span id="cb203-5"><a href="#cb203-5" aria-hidden="true" tabindex="-1"></a>formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="st">"restated_later ~ ."</span>)</span>
<span id="cb203-6"><a href="#cb203-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-7"><a href="#cb203-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert target to factor (if not already)</span></span>
<span id="cb203-8"><a href="#cb203-8" aria-hidden="true" tabindex="-1"></a>smote_data_ubl<span class="sc">$</span>restated_later <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(smote_data_ubl<span class="sc">$</span>restated_later)</span>
<span id="cb203-9"><a href="#cb203-9" aria-hidden="true" tabindex="-1"></a>test_data_numeric<span class="sc">$</span>restated_later <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(test_data_numeric<span class="sc">$</span>restated_later)</span>
<span id="cb203-10"><a href="#cb203-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-11"><a href="#cb203-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create model matrices</span></span>
<span id="cb203-12"><a href="#cb203-12" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula, <span class="at">data =</span> smote_data_ubl)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb203-13"><a href="#cb203-13" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> smote_data_ubl<span class="sc">$</span>restated_later</span>
<span id="cb203-14"><a href="#cb203-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-15"><a href="#cb203-15" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(formula, <span class="at">data =</span> test_data_numeric)[, <span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb203-16"><a href="#cb203-16" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> test_data_numeric<span class="sc">$</span>restated_later</span>
<span id="cb203-17"><a href="#cb203-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-18"><a href="#cb203-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Align columns</span></span>
<span id="cb203-19"><a href="#cb203-19" aria-hidden="true" tabindex="-1"></a>missing_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(x_train), <span class="fu">colnames</span>(x_test))</span>
<span id="cb203-20"><a href="#cb203-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> missing_cols) {</span>
<span id="cb203-21"><a href="#cb203-21" aria-hidden="true" tabindex="-1"></a>  x_test <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x_test, <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">nrow</span>(x_test)))</span>
<span id="cb203-22"><a href="#cb203-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_test)[<span class="fu">ncol</span>(x_test)] <span class="ot">&lt;-</span> col</span>
<span id="cb203-23"><a href="#cb203-23" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb203-24"><a href="#cb203-24" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> x_test[, <span class="fu">colnames</span>(x_train)]</span>
<span id="cb203-25"><a href="#cb203-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-26"><a href="#cb203-26" aria-hidden="true" tabindex="-1"></a><span class="co"># Train LASSO model</span></span>
<span id="cb203-27"><a href="#cb203-27" aria-hidden="true" tabindex="-1"></a>cv_lasso <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(x_train, y_train, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">type.measure =</span> <span class="st">"auc"</span>)</span>
<span id="cb203-28"><a href="#cb203-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-29"><a href="#cb203-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Predict probabilities</span></span>
<span id="cb203-30"><a href="#cb203-30" aria-hidden="true" tabindex="-1"></a>pred_min <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_lasso, <span class="at">newx =</span> x_test, <span class="at">s =</span> <span class="st">"lambda.min"</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb203-31"><a href="#cb203-31" aria-hidden="true" tabindex="-1"></a>pred_1se <span class="ot">&lt;-</span> <span class="fu">predict</span>(cv_lasso, <span class="at">newx =</span> x_test, <span class="at">s =</span> <span class="st">"lambda.1se"</span>, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb203-32"><a href="#cb203-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-33"><a href="#cb203-33" aria-hidden="true" tabindex="-1"></a><span class="co"># AUC + ROC curves</span></span>
<span id="cb203-34"><a href="#cb203-34" aria-hidden="true" tabindex="-1"></a>roc_lasso_min <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> y_test, <span class="at">predictor =</span> pred_min)</span>
<span id="cb203-35"><a href="#cb203-35" aria-hidden="true" tabindex="-1"></a>roc_lasso_1se <span class="ot">&lt;-</span> <span class="fu">roc</span>(<span class="at">response =</span> y_test, <span class="at">predictor =</span> pred_1se)</span>
<span id="cb203-36"><a href="#cb203-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-37"><a href="#cb203-37" aria-hidden="true" tabindex="-1"></a>auc_min <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_lasso_min)</span>
<span id="cb203-38"><a href="#cb203-38" aria-hidden="true" tabindex="-1"></a>auc_1se <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_lasso_1se)</span>
<span id="cb203-39"><a href="#cb203-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb203-40"><a href="#cb203-40" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for lambda.min: "</span>, auc_min, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC for lambda.min:  0.5902867 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb205"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb205-1"><a href="#cb205-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for lambda.1se:"</span>, auc_1se, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC for lambda.1se: 0.5861374 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb207"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb207-1"><a href="#cb207-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert probabilities to class predictions (threshold = 0.5)</span></span>
<span id="cb207-2"><a href="#cb207-2" aria-hidden="true" tabindex="-1"></a>lasso_pred_class_min <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_min <span class="sc">&gt;=</span> <span class="fl">0.5</span>, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb207-3"><a href="#cb207-3" aria-hidden="true" tabindex="-1"></a>lasso_pred_class_1se <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pred_1se <span class="sc">&gt;=</span> <span class="fl">0.5</span>, <span class="st">"1"</span>, <span class="st">"0"</span>)</span>
<span id="cb207-4"><a href="#cb207-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-5"><a href="#cb207-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Confusion matrices</span></span>
<span id="cb207-6"><a href="#cb207-6" aria-hidden="true" tabindex="-1"></a>conf_min <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> y_test, <span class="at">Predicted =</span> lasso_pred_class_min)</span>
<span id="cb207-7"><a href="#cb207-7" aria-hidden="true" tabindex="-1"></a>conf_1se <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> y_test, <span class="at">Predicted =</span> lasso_pred_class_1se)</span>
<span id="cb207-8"><a href="#cb207-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-9"><a href="#cb207-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Robust metric extractor</span></span>
<span id="cb207-10"><a href="#cb207-10" aria-hidden="true" tabindex="-1"></a>get_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(cm) {</span>
<span id="cb207-11"><a href="#cb207-11" aria-hidden="true" tabindex="-1"></a>  TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb207-12"><a href="#cb207-12" aria-hidden="true" tabindex="-1"></a>  TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb207-13"><a href="#cb207-13" aria-hidden="true" tabindex="-1"></a>  FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb207-14"><a href="#cb207-14" aria-hidden="true" tabindex="-1"></a>  FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb207-15"><a href="#cb207-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb207-16"><a href="#cb207-16" aria-hidden="true" tabindex="-1"></a>  sensitivity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TP <span class="sc">+</span> FN) <span class="sc">&gt;</span> <span class="dv">0</span>, TP <span class="sc">/</span> (TP <span class="sc">+</span> FN), <span class="cn">NA</span>)</span>
<span id="cb207-17"><a href="#cb207-17" aria-hidden="true" tabindex="-1"></a>  specificity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TN <span class="sc">+</span> FP) <span class="sc">&gt;</span> <span class="dv">0</span>, TN <span class="sc">/</span> (TN <span class="sc">+</span> FP), <span class="cn">NA</span>)</span>
<span id="cb207-18"><a href="#cb207-18" aria-hidden="true" tabindex="-1"></a>  precision   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TP <span class="sc">+</span> FP) <span class="sc">&gt;</span> <span class="dv">0</span>, TP <span class="sc">/</span> (TP <span class="sc">+</span> FP), <span class="cn">NA</span>)</span>
<span id="cb207-19"><a href="#cb207-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb207-20"><a href="#cb207-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb207-21"><a href="#cb207-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">sensitivity =</span> <span class="fu">round</span>(sensitivity, <span class="dv">4</span>),</span>
<span id="cb207-22"><a href="#cb207-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">specificity =</span> <span class="fu">round</span>(specificity, <span class="dv">4</span>),</span>
<span id="cb207-23"><a href="#cb207-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">precision =</span> <span class="fu">round</span>(precision, <span class="dv">4</span>)</span>
<span id="cb207-24"><a href="#cb207-24" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb207-25"><a href="#cb207-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb207-26"><a href="#cb207-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-27"><a href="#cb207-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute and print metrics</span></span>
<span id="cb207-28"><a href="#cb207-28" aria-hidden="true" tabindex="-1"></a>metrics_min <span class="ot">&lt;-</span> <span class="fu">get_metrics</span>(conf_min)</span>
<span id="cb207-29"><a href="#cb207-29" aria-hidden="true" tabindex="-1"></a>metrics_1se <span class="ot">&lt;-</span> <span class="fu">get_metrics</span>(conf_1se)</span>
<span id="cb207-30"><a href="#cb207-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb207-31"><a href="#cb207-31" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"LASSO (lambda.min):</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LASSO (lambda.min):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb209"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb209-1"><a href="#cb209-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_min)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
[1] 0.1425

$specificity
[1] 0.9126

$precision
[1] 0.7209</code></pre>
</div>
<div class="sourceCode cell-code" id="cb211"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb211-1"><a href="#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">LASSO (lambda.1se):</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
LASSO (lambda.1se):</code></pre>
</div>
<div class="sourceCode cell-code" id="cb213"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb213-1"><a href="#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_1se)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
[1] 0.1393

$specificity
[1] 0.9104

$precision
[1] 0.7306</code></pre>
</div>
</div>
<p>LASSO has a poor AUC and poor sensitivity.</p>
</section>
<section id="xgboost-2" class="level2">
<h2 class="anchored" data-anchor-id="xgboost-2">XGBoost</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb215"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb215-1"><a href="#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load libraries</span></span>
<span id="cb215-2"><a href="#cb215-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(xgboost)</span>
<span id="cb215-3"><a href="#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(pROC)</span>
<span id="cb215-4"><a href="#cb215-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Matrix)</span>
<span id="cb215-5"><a href="#cb215-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-6"><a href="#cb215-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Ensure target is a binary numeric vector (0 and 1)</span></span>
<span id="cb215-7"><a href="#cb215-7" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(smote_data_ubl<span class="sc">$</span>restated_later) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb215-8"><a href="#cb215-8" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(test_data_numeric<span class="sc">$</span>restated_later) <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb215-9"><a href="#cb215-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-10"><a href="#cb215-10" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Model matrices</span></span>
<span id="cb215-11"><a href="#cb215-11" aria-hidden="true" tabindex="-1"></a>x_train <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(restated_later <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> smote_data_ubl)</span>
<span id="cb215-12"><a href="#cb215-12" aria-hidden="true" tabindex="-1"></a>x_test_tmp <span class="ot">&lt;-</span> <span class="fu">sparse.model.matrix</span>(restated_later <span class="sc">~</span> . <span class="sc">-</span><span class="dv">1</span>, <span class="at">data =</span> test_data_numeric)</span>
<span id="cb215-13"><a href="#cb215-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-14"><a href="#cb215-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Align columns</span></span>
<span id="cb215-15"><a href="#cb215-15" aria-hidden="true" tabindex="-1"></a>missing_cols <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">colnames</span>(x_train), <span class="fu">colnames</span>(x_test_tmp))</span>
<span id="cb215-16"><a href="#cb215-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (col <span class="cf">in</span> missing_cols) {</span>
<span id="cb215-17"><a href="#cb215-17" aria-hidden="true" tabindex="-1"></a>  x_test_tmp <span class="ot">&lt;-</span> <span class="fu">cbind</span>(x_test_tmp, <span class="fu">Matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(x_test_tmp), <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">sparse =</span> <span class="cn">TRUE</span>))</span>
<span id="cb215-18"><a href="#cb215-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">colnames</span>(x_test_tmp)[<span class="fu">ncol</span>(x_test_tmp)] <span class="ot">&lt;-</span> col</span>
<span id="cb215-19"><a href="#cb215-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb215-20"><a href="#cb215-20" aria-hidden="true" tabindex="-1"></a>x_test <span class="ot">&lt;-</span> x_test_tmp[, <span class="fu">colnames</span>(x_train)]</span>
<span id="cb215-21"><a href="#cb215-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-22"><a href="#cb215-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Create DMatrix</span></span>
<span id="cb215-23"><a href="#cb215-23" aria-hidden="true" tabindex="-1"></a>dtrain <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> x_train, <span class="at">label =</span> y_train)</span>
<span id="cb215-24"><a href="#cb215-24" aria-hidden="true" tabindex="-1"></a>dtest <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(<span class="at">data =</span> x_test, <span class="at">label =</span> y_test)</span>
<span id="cb215-25"><a href="#cb215-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-26"><a href="#cb215-26" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Parameters and training</span></span>
<span id="cb215-27"><a href="#cb215-27" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb215-28"><a href="#cb215-28" aria-hidden="true" tabindex="-1"></a>  <span class="at">objective =</span> <span class="st">"binary:logistic"</span>,</span>
<span id="cb215-29"><a href="#cb215-29" aria-hidden="true" tabindex="-1"></a>  <span class="at">eval_metric =</span> <span class="st">"auc"</span>,</span>
<span id="cb215-30"><a href="#cb215-30" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_depth =</span> <span class="dv">6</span>,</span>
<span id="cb215-31"><a href="#cb215-31" aria-hidden="true" tabindex="-1"></a>  <span class="at">eta =</span> <span class="fl">0.1</span></span>
<span id="cb215-32"><a href="#cb215-32" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb215-33"><a href="#cb215-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-34"><a href="#cb215-34" aria-hidden="true" tabindex="-1"></a>xgb_model <span class="ot">&lt;-</span> <span class="fu">xgb.train</span>(</span>
<span id="cb215-35"><a href="#cb215-35" aria-hidden="true" tabindex="-1"></a>  <span class="at">params =</span> params,</span>
<span id="cb215-36"><a href="#cb215-36" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dtrain,</span>
<span id="cb215-37"><a href="#cb215-37" aria-hidden="true" tabindex="-1"></a>  <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb215-38"><a href="#cb215-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">watchlist =</span> <span class="fu">list</span>(<span class="at">train =</span> dtrain, <span class="at">test =</span> dtest),</span>
<span id="cb215-39"><a href="#cb215-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">early_stopping_rounds =</span> <span class="dv">10</span>,</span>
<span id="cb215-40"><a href="#cb215-40" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="dv">0</span></span>
<span id="cb215-41"><a href="#cb215-41" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb215-42"><a href="#cb215-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-43"><a href="#cb215-43" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Predictions</span></span>
<span id="cb215-44"><a href="#cb215-44" aria-hidden="true" tabindex="-1"></a>xgb_pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(xgb_model, dtest)</span>
<span id="cb215-45"><a href="#cb215-45" aria-hidden="true" tabindex="-1"></a>xgb_pred_class <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(xgb_pred <span class="sc">&gt;=</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb215-46"><a href="#cb215-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-47"><a href="#cb215-47" aria-hidden="true" tabindex="-1"></a><span class="co"># 6. AUC and ROC</span></span>
<span id="cb215-48"><a href="#cb215-48" aria-hidden="true" tabindex="-1"></a>roc_xgb <span class="ot">&lt;-</span> <span class="fu">roc</span>(y_test, xgb_pred)</span>
<span id="cb215-49"><a href="#cb215-49" aria-hidden="true" tabindex="-1"></a>auc_xgb <span class="ot">&lt;-</span> <span class="fu">auc</span>(roc_xgb)</span>
<span id="cb215-50"><a href="#cb215-50" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"AUC for XGBoost model:"</span>, auc_xgb, <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>AUC for XGBoost model: 0.6165313 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb217"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb217-1"><a href="#cb217-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 7. Confusion Matrix</span></span>
<span id="cb217-2"><a href="#cb217-2" aria-hidden="true" tabindex="-1"></a>conf_xgb <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">Actual =</span> y_test, <span class="at">Predicted =</span> xgb_pred_class)</span>
<span id="cb217-3"><a href="#cb217-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-4"><a href="#cb217-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 8. Metrics</span></span>
<span id="cb217-5"><a href="#cb217-5" aria-hidden="true" tabindex="-1"></a>get_metrics <span class="ot">&lt;-</span> <span class="cf">function</span>(cm) {</span>
<span id="cb217-6"><a href="#cb217-6" aria-hidden="true" tabindex="-1"></a>  TP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"1"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb217-7"><a href="#cb217-7" aria-hidden="true" tabindex="-1"></a>  TN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"0"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb217-8"><a href="#cb217-8" aria-hidden="true" tabindex="-1"></a>  FP <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"1"</span>, <span class="st">"0"</span>], <span class="dv">0</span>)</span>
<span id="cb217-9"><a href="#cb217-9" aria-hidden="true" tabindex="-1"></a>  FN <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="st">"0"</span> <span class="sc">%in%</span> <span class="fu">rownames</span>(cm) <span class="sc">&amp;&amp;</span> <span class="st">"1"</span> <span class="sc">%in%</span> <span class="fu">colnames</span>(cm), cm[<span class="st">"0"</span>, <span class="st">"1"</span>], <span class="dv">0</span>)</span>
<span id="cb217-10"><a href="#cb217-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-11"><a href="#cb217-11" aria-hidden="true" tabindex="-1"></a>  sensitivity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TP <span class="sc">+</span> FN) <span class="sc">&gt;</span> <span class="dv">0</span>, TP <span class="sc">/</span> (TP <span class="sc">+</span> FN), <span class="cn">NA</span>)</span>
<span id="cb217-12"><a href="#cb217-12" aria-hidden="true" tabindex="-1"></a>  specificity <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TN <span class="sc">+</span> FP) <span class="sc">&gt;</span> <span class="dv">0</span>, TN <span class="sc">/</span> (TN <span class="sc">+</span> FP), <span class="cn">NA</span>)</span>
<span id="cb217-13"><a href="#cb217-13" aria-hidden="true" tabindex="-1"></a>  precision   <span class="ot">&lt;-</span> <span class="fu">ifelse</span>((TP <span class="sc">+</span> FP) <span class="sc">&gt;</span> <span class="dv">0</span>, TP <span class="sc">/</span> (TP <span class="sc">+</span> FP), <span class="cn">NA</span>)</span>
<span id="cb217-14"><a href="#cb217-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-15"><a href="#cb217-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb217-16"><a href="#cb217-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">sensitivity =</span> <span class="fu">round</span>(sensitivity, <span class="dv">4</span>),</span>
<span id="cb217-17"><a href="#cb217-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">specificity =</span> <span class="fu">round</span>(specificity, <span class="dv">4</span>),</span>
<span id="cb217-18"><a href="#cb217-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">precision =</span> <span class="fu">round</span>(precision, <span class="dv">4</span>)</span>
<span id="cb217-19"><a href="#cb217-19" aria-hidden="true" tabindex="-1"></a>  ))</span>
<span id="cb217-20"><a href="#cb217-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb217-21"><a href="#cb217-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb217-22"><a href="#cb217-22" aria-hidden="true" tabindex="-1"></a>metrics_xgb <span class="ot">&lt;-</span> <span class="fu">get_metrics</span>(conf_xgb)</span>
<span id="cb217-23"><a href="#cb217-23" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">XGBoost Model Metrics:</span><span class="sc">\n</span><span class="st">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
XGBoost Model Metrics:</code></pre>
</div>
<div class="sourceCode cell-code" id="cb219"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb219-1"><a href="#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(metrics_xgb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>$sensitivity
[1] 0.1627

$specificity
[1] 0.9121

$precision
[1] 0.5971</code></pre>
</div>
</div>
<p>XG Boost has poor sensitivity and lower AUC than the random forest</p>
</section>
<section id="model-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="model-comparisons">Model Comparisons</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb221"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb221-1"><a href="#cb221-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot the first ROC curve</span></span>
<span id="cb221-2"><a href="#cb221-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(roc_log, <span class="at">col =</span> <span class="st">"blue"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">main =</span> <span class="st">"ROC Curve - All Models"</span>, <span class="at">legacy.axes =</span> <span class="cn">TRUE</span>)</span>
<span id="cb221-3"><a href="#cb221-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-4"><a href="#cb221-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add other ROC curves</span></span>
<span id="cb221-5"><a href="#cb221-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_lasso_min, <span class="at">col =</span> <span class="st">"darkgreen"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb221-6"><a href="#cb221-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_lasso_1se, <span class="at">col =</span> <span class="st">"green"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">3</span>)</span>
<span id="cb221-7"><a href="#cb221-7" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_rf, <span class="at">col =</span> <span class="st">"purple"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">4</span>)</span>
<span id="cb221-8"><a href="#cb221-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(roc_xgb, <span class="at">col =</span> <span class="st">"red"</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">lty =</span> <span class="dv">5</span>)</span>
<span id="cb221-9"><a href="#cb221-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb221-10"><a href="#cb221-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Add legend</span></span>
<span id="cb221-11"><a href="#cb221-11" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"bottomright"</span>, </span>
<span id="cb221-12"><a href="#cb221-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">legend =</span> <span class="fu">c</span>(</span>
<span id="cb221-13"><a href="#cb221-13" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"Logistic (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_log), <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb221-14"><a href="#cb221-14" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"LASSO Min (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_lasso_min), <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb221-15"><a href="#cb221-15" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"LASSO 1SE (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_lasso_1se), <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb221-16"><a href="#cb221-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"Random Forest (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_rf), <span class="dv">3</span>), <span class="st">")"</span>),</span>
<span id="cb221-17"><a href="#cb221-17" aria-hidden="true" tabindex="-1"></a>         <span class="fu">paste0</span>(<span class="st">"XGBoost (AUC="</span>, <span class="fu">round</span>(<span class="fu">auc</span>(roc_xgb), <span class="dv">3</span>), <span class="st">")"</span>)</span>
<span id="cb221-18"><a href="#cb221-18" aria-hidden="true" tabindex="-1"></a>       ),</span>
<span id="cb221-19"><a href="#cb221-19" aria-hidden="true" tabindex="-1"></a>       <span class="at">col =</span> <span class="fu">c</span>(<span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"green"</span>, <span class="st">"purple"</span>, <span class="st">"red"</span>),</span>
<span id="cb221-20"><a href="#cb221-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">lty =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">cex =</span> <span class="fl">0.8</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Random Forest is the best model, based off both AUC and sensitivity metrics. We will thus use the model for prediction on the 2023 dataset</p>
</section>
<section id="evaluate-on-unseen-data-2023" class="level2">
<h2 class="anchored" data-anchor-id="evaluate-on-unseen-data-2023">Evaluate on Unseen Data (2023)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb222"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb222-1"><a href="#cb222-1" aria-hidden="true" tabindex="-1"></a>rf_preds <span class="ot">&lt;-</span> <span class="fu">predict</span>(rf_model, <span class="at">newdata =</span> data_2023_numeric, <span class="at">type =</span> <span class="st">"response"</span>)</span>
<span id="cb222-2"><a href="#cb222-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-3"><a href="#cb222-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Bind predictions to the original data (which includes company code)</span></span>
<span id="cb222-4"><a href="#cb222-4" aria-hidden="true" tabindex="-1"></a>results_2023 <span class="ot">&lt;-</span> data_2023_numeric</span>
<span id="cb222-5"><a href="#cb222-5" aria-hidden="true" tabindex="-1"></a>results_2023<span class="sc">$</span>predicted_class <span class="ot">&lt;-</span> rf_preds</span>
<span id="cb222-6"><a href="#cb222-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-7"><a href="#cb222-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Filter for predicted class = 1</span></span>
<span id="cb222-8"><a href="#cb222-8" aria-hidden="true" tabindex="-1"></a>predicted_positive_restatement <span class="ot">&lt;-</span> results_2023 <span class="sc">%&gt;%</span> </span>
<span id="cb222-9"><a href="#cb222-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"pred_restated"</span> <span class="ot">=</span> <span class="st">"predicted_class"</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code,pred_restated)</span>
<span id="cb222-10"><a href="#cb222-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-11"><a href="#cb222-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb222-12"><a href="#cb222-12" aria-hidden="true" tabindex="-1"></a><span class="co"># View the result</span></span>
<span id="cb222-13"><a href="#cb222-13" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(predicted_positive_restatement)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       code pred_restated
1       677             0
2       801             0
3       823             1
4       824             0
5       985             1
6      1045             0
7      1069             1
8      1105             0
9      1148             0
10     1174             0
11     1176             1
12     1213             0
13     1226             1
14     1262             0
15     1322             0
16     1340             0
17     1450             0
18     1459             0
19     1460             0
20     1491             0
21     1580             0
22     1603             0
23     1620             0
24     1631             0
25     1644             0
26     1665             1
27     1704             1
28     1731             1
29     1735             0
30     2995             1
31     3211             0
32     3901             0
33     4177             1
34     4196             0
35     4463             0
36     4480             0
37     4490             0
38     4679             0
39     5050             1
40     5229             0
41     5287             0
42     5297             0
43     5457             1
44     5639             1
45     5706             0
46     5713             1
47     5816             1
48     5878             0
49     6028             0
50     6084             1
51     6138             0
52     6178             0
53     6240             0
54     6412             0
55     6482             0
56     6531             0
57     6547             1
58     6657             0
59     7062             0
60     7254             1
61     7279             0
62     7329             1
63     7419             0
64     7528             0
65     7568             1
66     7598             1
67     7630             0
68     7907             0
69     8005             1
70     8503             0
71     8572             0
72     8575             0
73     8670             1
74     8773             1
75     8917             0
76     8925             0
77     8960             1
78     8991             1
79     9095             0
80     9135             0
81     9148             1
82     9532             1
83     9577             0
84     9618             0
85     9942             0
86     9989             1
87    10060             1
88    10178             1
89    10543             1
90    10554             1
91    10602             1
92    10604             0
93    10695             0
94    10770             0
95    10789             0
96    10827             0
97    10845             0
98    10856             0
99    10890             0
100   10948             1
101   10984             0
102   11041             0
103   11078             0
104   11091             0
105   11157             0
106   11210             0
107   11223             1
108   11262             0
109   11274             0
110   11299             0
111   11351             1
112   11369             1
113   11371             1
114   11373             1
115   11396             0
116   11399             1
117   11417             0
118   11476             0
119   11477             1
120   11481             0
121   11488             1
122   11541             1
123   11553             1
124   11567             1
125   11569             1
126   11638             0
127   11641             1
128   11642             0
129   11676             1
130   11687             1
131   11730             1
132   11733             1
133   11755             1
134   11758             1
135   11945             0
136   12031             1
137   12047             1
138   12078             0
139   12164             0
140   12210             1
141   12247             0
142   12352             1
143   12392             1
144   12399             0
145   12774             0
146   13008             0
147   13114             1
148   13214             0
149   13263             0
150   13402             0
151   13435             1
152   13450             0
153   13472             0
154   13498             0
155   13520             1
156   13689             1
157   13865             0
158   13884             1
159   13886             0
160   13947             0
161   14073             0
162   14142             0
163   14179             0
164   14237             0
165   14244             1
166   14353             0
167   14426             0
168   14445             0
169   14473             1
170   14492             0
171   14674             0
172   14716             0
173   14737             0
174   14757             0
175   14822             0
176   14967             0
177   14978             0
178   14982             0
179   15010             1
180   15067             0
181   15117             0
182   15118             1
183   15199             0
184   15213             0
185   15345             0
186   15450             0
187   15551             0
188   15877             1
189   15905             0
190   15951             0
191   16048             0
192   16208             0
193   16219             0
194   16222             0
195   16277             0
196   16283             0
197   16295             0
198   16306             0
199   16346             0
200   16389             1
201   16604             1
202   16622             0
203   16661             0
204   16714             1
205   16719             1
206   16769             1
207   16779             0
208   16786             0
209   16837             0
210   16885             1
211   16897             0
212   16902             0
213   16907             0
214   16920             0
215   16943             1
216   17008             0
217   17020             0
218   17040             1
219   17099             1
220   17114             0
221   17117             0
222   17147             1
223   17183             1
224   17200             0
225   17219             0
226   17221             1
227   17223             1
228   17225             0
229   17259             1
230   17274             0
231   17336             0
232   17337             1
233   17339             0
234   17417             0
235   17481             1
236   17482             1
237   17483             1
238   17486             0
239   17600             0
240   17659             0
241   17730             1
242   18051             1
243   18336             1
244   18543             0
245   18733             0
246   19036             0
247   19286             0
248   19520             0
249   19521             0
250   19569             0
251   19585             1
252   19917             0
253   20438             0
254   20521             0
255   20586             1
256   20592             0
257   20729             0
258   20804             0
259   20897             0
260   21062             1
261   21837             0
262   21927             1
263   21986             0
264   22069             0
265   22279             0
266   22543             0
267   22817             0
268   22891             1
269   23142             1
270   23171             0
271   23202             0
272   23468             0
273   23802             0
274   23824             1
275   23967             0
276   24230             0
277   24379             1
278   24390             0
279   24426             1
280   24705             0
281   25033             1
282   25155             0
283   25208             1
284   25631             0
285   25652             1
286   25704             0
287   25779             0
288   25832             0
289   25941             1
290   25972             0
291   26030             0
292   26793             0
293   26805             0
294   26832             0
295   27218             1
296   27391             1
297   27792             0
298   28277             1
299   28498             0
300   28657             0
301   28958             0
302   29287             0
303   29473             0
304   29438             0
305   29614             0
306   29694             0
307   29789             0
308   30055             1
309   30109             0
310   30210             0
311   30485             1
312   30531             1
313   30667             0
314   30672             0
315   30682             0
316   30683             0
317   30834             0
318   30910             0
319   31049             0
320   31193             0
321   31647             0
322   31679             1
323   32017             0
324   32159             0
325   32282             0
326   32582             0
327   32583             0
328   32789             0
329   33038             1
330   33191             0
331   33352             0
332   33374             0
333   33435             0
334   33514             0
335   33600             0
336   33625             0
337   33675             0
338   33743             0
339   34437             0
340   34759             0
341   34784             1
342   35140             0
343   35242             0
344   35477             0
345   35673             1
346   35778             0
347   35799             1
348   35803             0
349   35845             0
350   36011             0
351   36069             0
352   36151             0
353   36240             0
354   36278             0
355   36423             1
356   36836             0
357   36981             0
358   37571             0
359   37649             0
360   38064             1
361   38199             0
362   38254             1
363   38261             0
364   38289             0
365   38377             0
366   38517             0
367   38612             1
368   38634             0
369   38796             1
370   38882             0
371   39418             0
372   39774             0
373   39941             1
374   40163             0
375   40215             0
376   40216             0
377   40250             1
378   40267             1
379   40373             1
380   40650             0
381   40964             0
382   41123             0
383   41400             0
384   41580             0
385   41662             0
386   42101             1
387   42609             0
388   42642             0
389   42798             0
390   42867             0
391   42909             0
392   42955             0
393   43106             0
394   43527             0
395   43828             0
396   43876             0
397   43903             0
398   43966             0
399   44234             0
400   44445             0
401   44499             0
402   44513             0
403   44595             0
404   44709             1
405   44999             0
406   44994             1
407   45055             0
408   45183             0
409   45262             1
410   45263             0
411   45290             0
412   45540             0
413   45631             0
414   45793             0
415   45899             0
416   45915             1
417   45967             0
418   46002             0
419   46060             0
420   46068             0
421   46099             1
422   46102             0
423   46129             0
424   46134             1
425   46225             1
426   46201             0
427   46267             0
428   46338             0
429   46451             1
430   46458             0
431   46610             0
432   46718             0
433   46747             0
434   46775             1
435   46890             0
436   46894             1
437   47114             1
438   47347             1
439   47379             0
440   47386             0
441   47388             0
442   47440             1
443   47463             1
444   52570             1
445   47715             0
446   47739             0
447   47813             0
448   47816             1
449   47882             1
450   47885             1
451   47956             1
452   47968             0
453   47971             0
454   48019             0
455   48080             1
456   48065             0
457   48313             0
458   48315             1
459   48861             0
460   48941             0
461   48944             0
462   49027             1
463   49108             0
464   49169             1
465   49300             0
466   49447             0
467   49459             0
468   49543             0
469   50076             1
470   50106             1
471   50139             1
472   50146             1
473   50507             0
474   50621             1
475   50886             0
476   51023             0
477   52894             0
478   51322             1
479   51351             0
480   51398             0
481   51430             0
482   51454             1
483   51548             1
484   51601             0
485   51626             0
486   51627             0
487   51752             1
488   51847             0
489   52158             1
490   51950             1
491   51951             0
492   51973             1
493   52000             1
494   52022             1
495   52076             1
496   52118             0
497   52120             0
498   52164             1
499   52168             1
500   52257             1
501   52290             1
502   52319             0
503   52331             1
504   52365             1
505   52389             0
506   52392             1
507   52431             0
508   52553             1
509   52563             0
510   52564             1
511   52686             0
512   52723             0
513   52737             1
514   52738             0
515   52768             1
516   52790             0
517   52802             0
518   52817             0
519   52820             1
520   52850             0
521   52859             1
522   52860             1
523   52876             0
524   52923             0
525   52952             1
526   52973             0
527   52983             0
528   52980             1
529   52988             0
530   53001             0
531   53088             1
532   53089             1
533   53107             0
534   53109             0
535   53191             0
536   53202             1
537   53251             1
538   53253             1
539   53258             1
540   53265             1
541   53305             1
542   53320             1
543   53372             0
544   53383             1
545   53400             0
546   53405             1
547   53425             1
548   53453             1
549   53465             0
550   53475             0
551   53528             1
552   53531             1
553   53563             1
554   53605             1
555   53622             0
556   53626             1
557   53634             0
558   53639             1
559   53645             1
560   53658             1
561   53678             0
562   53688             0
563   53691             1
564   53730             1
565   53751             0
566   53755             0
567   53761             1
568   53783             1
569   53926             1
570   53823             1
571   53832             1
572   53839             1
573   53842             1
574   53873             0
575   53902             1
576   53941             1
577   53953             1
578   53972             1
579   53995             1
580   54123             0
581   54190             0
582   54271             0
583   54378             1
584   54572             0
585   54612             0
586   54657             0
587   54665             0
588   54679             0
589   54720             0
590   54823             0
591   55082             0
592   55234             1
593   55294             0
594   55316             0
595   55347             1
596   59731             0
597   55444             0
598   55649             0
599   55789             0
600   55779             0
601   55803             0
602   55881             0
603   55904             1
604   55972             1
605   55975             0
606   55980             1
607   56011             0
608   56030             1
609   56134             0
610   56173             0
611   56178             1
612   56229             0
613   56237             0
614   56317             0
615   56318             0
616   56376             0
617   56387             0
618   56459             0
619   56612             1
620   56665             1
621   56720             0
622   56759             1
623   56765             1
624   56777             0
625   56838             1
626   56840             1
627   56850             0
628   56940             0
629   56985             1
630   58237             0
631   57002             1
632   57110             0
633   57131             1
634   57135             1
635   57140             0
636   57145             1
637   57146             1
638   57149             1
639   57200             0
640   57440             1
641   57465             1
642   57549             0
643   57553             1
644   57580             1
645   57595             0
646   57602             0
647   57628             1
648   57698             0
649   57756             0
650   57784             1
651   57951             0
652   57964             1
653   58025             1
654   58048             1
655   58133             1
656   58162             1
657   58170             0
658   58182             0
659   58232             0
660   58276             1
661   58292             0
662   58353             1
663   58389             0
664   58367             0
665   58385             0
666   58452             1
667   58487             0
668   58493             1
669   58561             0
670   58587             0
671   58595             0
672   58609             1
673   58635             0
674   58648             0
675   58685             0
676   58686             1
677   58696             0
678   58707             0
679   58718             1
680   58771             1
681   58789             0
682   58800             0
683   58830             0
684   58853             0
685   58868             0
686   58917             1
687   58920             0
688   58929             1
689   58968             0
690   59070             0
691   59115             0
692   59143             1
693   59153             0
694   59205             0
695   59219             1
696   59239             0
697   59264             1
698   59359             0
699   59369             0
700   59371             0
701   59546             0
702   59618             0
703   59756             1
704   59906             1
705   59951             1
706   60361             1
707   60367             0
708   60523             0
709   60545             1
710   60646             0
711   60744             0
712   60874             1
713   61000             0
714   61151             0
715   61162             0
716   61269             0
717   61522             0
718   61552             0
719   61637             0
720   61779             0
721   61781             0
722   61790             0
723   61792             0
724   61808             1
725   61841             1
726   61880             1
727   62060             0
728   62103             0
729   62168             0
730   62361             0
731   62442             0
732   62524             1
733   62598             0
734   62600             0
735   62606             0
736   62722             1
737   62826             0
738   62964             0
739   62973             1
740   63067             0
741   63088             0
742   63140             0
743   63159             0
744   63281             1
745   63308             0
746   63345             1
747   63520             0
748   63532             0
749   63588             0
750   63622             0
751   63641             0
752   63642             0
753   63654             0
754   63668             1
755   63677             1
756   64004             0
757   63804             1
758   63883             0
759   63981             0
760   64165             0
761   64269             1
762   64283             1
763   64468             0
764   64545             0
765   64581             0
766   64689             1
767   64704             0
768   64709             0
769   64725             0
770   64760             0
771   64814             0
772   64839             1
773   64873             0
774   64898             0
775   64916             1
776   64966             0
777   64967             0
778   64988             0
779   65018             1
780   65452             0
781   65283             0
782   65286             0
783   65307             0
784   65312             1
785   65436             1
786   65489             0
787   65492             1
788   65617             0
789   65677             0
790   65755             0
791   65779             1
792   65796             0
793   65797             0
794   65806             0
795   66035             0
796   66085             0
797   66146             0
798   66171             0
799   66283             1
800   66358             0
801   66359             0
802   66505             0
803   66614             0
804   66618             0
805   66628             0
806   66668             1
807   66697             0
808   66711             0
809   66732             0
810   66739             0
811   66786             0
812   66791             0
813   66873             1
814   66871             1
815   66914             0
816   66954             0
817   67050             0
818   67079             1
819   67186             1
820   67219             1
821   67233             0
822   67236             1
823   67253             1
824   67266             1
825   67284             0
826   67325             0
827   67346             0
828   67362             1
829   67364             1
830   67371             1
831   67374             1
832   67390             0
833   67424             0
834   67439             0
835   67441             1
836   67449             1
837   67460             0
838   67475             1
839   67541             1
840   67577             0
841   67625             1
842   67629             0
843   67750             0
844   67754             0
845   67772             1
846   67785             0
847   67817             1
848   67822             0
849   67840             0
850   67854             0
851   67861             1
852   67880             0
853   67943             1
854   67982             1
855   68026             1
856   68039             0
857   68052             1
858   68054             1
859   68061             0
860   68072             0
861   68089             1
862   68090             0
863   68095             1
864   68103             1
865   68197             1
866   68235             0
867   68341             1
868   68381             0
869   68426             0
870   68536             1
871   68570             0
872   68660             0
873   68683             1
874   68705             0
875   68786             0
876   68856             0
877   68861             0
878   68904             0
879   68940             0
880   68968             1
881   69052             0
882   69067             0
883   69074             0
884   69075             0
885   69114             0
886   69164             0
887   69223             0
888   69235             0
889   69237             1
890   69371             0
891   69395             0
892   69411             1
893   69587             1
894   69725             0
895   69784             1
896   69797             1
897   69845             0
898   69898             0
899   69952             1
900   69989             0
901   69993             1
902   70120             1
903   70142             1
904   70148             0
905   70198             0
906   70229             1
907   70278             0
908   70796             0
909   70320             0
910  103696             0
911   70587             0
912   70664             0
913   70697             0
914   70774             1
915   70792             0
916   70803             1
917   70947             0
918   71084             1
919   71247             0
920   71409             1
921   71420             0
922   71819             1
923   71975             0
924   71988             0
925   71995             0
926   72005             1
927   72012             0
928   72236             0
929   72370             0
930   72400             0
931   72410             0
932   72488             0
933   72640             1
934   72801             1
935   72833             1
936   72837             0
937   73209             0
938   73312             1
939   73363             0
940   73493             1
941   73502             0
942   73621             0
943   73676             0
944   73688             0
945   73774             0
946   73832             1
947   73905             1
948   73946             0
949   73980             0
950   74005             0
951   74051             0
952   74057             1
953   74112             1
954   74231             1
955   74232             1
956   74256             0
957   74374             0
958   99934             0
959   99935             0
960   99972             0
961   99999             1
962  100067             1
963  111569             1
964  106529             0
965  100283             0
966  100318             1
967  100383             0
968  100429             1
969  100442             0
970  100447             0
971  100515             0
972  100572             1
973  100635             0
974  100672             0
975  100707             0
976  100762             0
977  100802             1
978  100886             0
979  100908             0
980  100973             0
981  101017             0
982  101040             0
983  101059             1
984  101065             1
985  101123             1
986  101127             0
987  101270             0
988  101274             1
989  101477             0
990  101586             1
991  101652             1
992  101694             0
993  101752             0
994  101764             0
995  101774             1
996  101803             1
997  101854             0
998  101875             0
999  101908             0
1000 101929             0
1001 101935             1
1002 101939             0
1003 101946             1
1004 103373             0
1005 102060             0
1006 102208             1
1007 102347             1
1008 102383             0
1009 102457             0
1010 102476             0
1011 102505             0
1012 102535             0
1013 102536             0
1014 102559             0
1015 102561             0
1016 102605             1
1017 102608             1
1018 102641             0
1019 103033             0
1020 102665             0
1021 102827             0
1022 102847             0
1023 102881             0
1024 102936             0
1025 102957             1
1026 103206             0
1027 103232             0
1028 103281             0
1029 103303             1
1030 103325             0
1031 103358             0
1032 103476             0
1033 103519             0
1034 103534             0
1035 103585             0
1036 103621             1
1037 103638             0
1038 103687             0
1039 103728             1
1040 103781             0
1041 103845             0
1042 103846             0
1043 103863             1
1044 103866             0
1045 103894             1
1046 103923             0
1047 103982             0
1048 103998             0
1049 104022             1
1050 104025             1
1051 104029             0
1052 104047             0
1053 104072             0
1054 104080             0
1055 104147             1
1056 104171             0
1057 104231             0
1058 104443             0
1059 104266             1
1060 104302             1
1061 104386             0
1062 104328             0
1063 104329             1
1064 104370             0
1065 104413             0
1066 104417             0
1067 104575             1
1068 104577             1
1069 104595             1
1070 104623             1
1071 104640             0
1072 104652             1
1073 104726             0
1074 104727             0
1075 104785             0
1076 104813             0
1077 104823             0
1078 104846             1
1079 104880             0
1080 104894             1
1081 104903             0
1082 104924             1
1083 104925             1
1084 104934             1
1085 104961             0
1086 104983             0
1087 105001             1
1088 105017             0
1089 105036             0
1090 105046             1
1091 105048             0
1092 105079             1
1093 105080             0
1094 105099             1
1095 105111             0
1096 105154             1
1097 105271             1
1098 105314             1
1099 105521             0
1100 105561             1
1101 105564             0
1102 105618             1
1103 105619             0
1104 105677             0
1105 105766             0
1106 105806             1
1107 105779             0
1108 106358             0
1109 105800             0
1110 105829             0
1111 105918             0
1112 105967             1
1113 105994             1
1114 105995             0
1115 106061             0
1116 106172             1
1117 106187             0
1118 106261             0
1119 106278             1
1120 106337             1
1121 106343             0
1122 106344             0
1123 106348             0
1124 106350             0
1125 106360             0
1126 106361             0
1127 106392             0
1128 106492             0
1129 106499             0
1130 106519             1
1131 106561             0
1132 106600             0
1133 106624             0
1134 106654             0
1135 106743             0
1136 106777             0
1137 106781             0
1138 106797             1
1139 106874             0
1140 106963             1
1141 107074             1
1142 107151             0
1143 107161             0
1144 107211             0
1145 107234             1
1146 107357             1
1147 107358             0
1148 107375             1
1149 107380             0
1150 107381             1
1151 107390             0
1152 107399             1
1153 107428             0
1154 107429             0
1155 107505             0
1156 107524             0
1157 107627             1
1158 107686             1
1159 107690             0
1160 107713             1
1161 107757             1
1162 107877             1
1163 107888             1
1164 107914             0
1165 107938             0
1166 107944             0
1167 107953             0
1168 107967             0
1169 107992             1
1170 108091             0
1171 108110             0
1172 108219             0
1173 108260             1
1174 108268             0
1175 108294             0
1176 108337             1
1177 108404             1
1178 108461             0
1179 108466             0
1180 108516             0
1181 108527             1
1182 108528             1
1183 108531             0
1184 108571             0
1185 108581             1
1186 108615             0
1187 108640             0
1188 108664             1
1189 108739             0
1190 108759             0
1191 108761             0
1192 108807             0
1193 108823             0
1194 108834             0
1195 108890             0
1196 108902             1
1197 108905             0
1198 108925             0
1199 108976             0
1200 108991             0
1201 109005             0
1202 109034             0
1203 109048             1
1204 109054             0
1205 109058             0
1206 109059             0
1207 109069             1
1208 109138             1
1209 109141             1
1210 109170             0
1211 109171             0
1212 109174             0
1213 109187             1
1214 109188             0
1215 109206             1
1216 109214             1
1217 109216             0
1218 109220             0
1219 109239             0
1220 109253             1
1221 109276             0
1222 109292             1
1223 109300             0
1224 109338             0
1225 109349             1
1226 109376             1
1227 109377             0
1228 109389             1
1229 109390             1
1230 109392             1
1231 109393             0
1232 109429             0
1233 109434             0
1234 109443             1
1235 109457             0
1236 109572             1
1237 109579             1
1238 109703             0
1239 109725             0
1240 109731             0
1241 109744             1
1242 109798             0
1243 109873             0
1244 109876             1
1245 110000             0
1246 110021             0
1247 110158             0
1248 110483             1
1249 110232             0
1250 110272             0
1251 110445             0
1252 110337             1
1253 110400             0
1254 110407             0
1255 110446             1
1256 110457             0
1257 110458             0
1258 110467             0
1259 110478             0
1260 110520             0
1261 110556             0
1262 110619             1
1263 110630             1
1264 110639             1
1265 110648             1
1266 110690             0
1267 110710             1
1268 110719             0
1269 110722             1
1270 110749             1
1271 110781             1
1272 110801             1
1273 110855             0
1274 110914             1
1275 110963             0
1276 111015             0
1277 111193             0
1278 111211             1
1279 111224             1
1280 111225             1
1281 111260             0
1282 111339             0
1283 111363             0
1284 111369             0
1285 111410             1
1286 111464             0
1287 111710             0
1288 111711             1
1289 111715             0
1290 111721             1
1291 111750             0
1292 111757             0
1293 111785             1
1294 111828             0
1295 111886             0
1296 111905             0
1297 111911             0
1298 111972             0
1299 111975             0
1300 112046             0
1301 112050             0
1302 112083             1
1303 112437             1
1304 112455             0
1305 112461             1
1306 112464             0
1307 112469             0
1308 112520             0
1309 112522             0
1310 112580             1
1311 112650             0
1312 112687             1
1313 112828             0
1314 112867             0
1315 112905             1
1316 112981             0
1317 113014             0
1318 113198             1
1319 113618             1
1320 113693             0
1321 113695             0
1322 113757             0
1323 113932             0
1324 113981             0
1325 113999             0
1326 114021             0
1327 114025             0
1328 114185             1
1329 114299             1
1330 114396             0
1331 114409             1
1332 114412             1
1333 114444             1
1334 114468             0
1335 114548             1
1336 114621             0
1337 114675             0
1338 114691             1
1339 114766             0
1340 114770             0
1341 114777             1
1342 114784             0
1343 114849             0
1344 114874             0
1345 114900             0
1346 114968             0
1347 114981             1
1348 114990             0
1349 115101             1
1350 115107             0
1351 115202             0
1352 115217             1
1353 115248             0
1354 115250             1
1355 115253             0
1356 115256             1
1357 115696             0
1358 115296             1
1359 115297             0
1360 115303             0
1361 115350             0
1362 115366             0
1363 115399             1
1364 115554             1
1365 115577             0
1366 115719             0
1367 115720             0
1368 115756             1
1369 115817             0
1370 115930             0
1371 115954             0
1372 115979             0
1373 115981             0
1374 116052             1
1375 116060             0
1376 116104             1
1377 116231             1
1378 116244             0
1379 116279             1
1380 116331             1
1381 116362             0
1382 116373             1
1383 116403             0
1384 116417             0
1385 116427             0
1386 116489             0
1387 116456             0
1388 116475             0
1389 116526             0
1390 116518             0
1391 116573             0
1392 116574             0
1393 116575             0
1394 116599             0
1395 116600             0
1396 116611             1
1397 116627             1
1398 116684             1
1399 116696             0
1400 116702             0
1401 116741             1
1402 116852             1
1403 118105             0
1404 116881             0
1405 116963             0
1406 117002             0
1407 117042             0
1408 117088             0
1409 117119             0
1410 117161             0
1411 143811             0
1412 117197             1
1413 117247             0
1414 117265             0
1415 117276             0
1416 117289             1
1417 117323             1
1418 134942             0
1419 117433             0
1420 118228             1
1421 117519             1
1422 117522             0
1423 117529             0
1424 117539             0
1425 117591             1
1426 117600             0
1427 117666             1
1428 117682             0
1429 117867             1
1430 117886             0
1431 117903             0
1432 124746             1
1433 118014             1
1434 118041             0
1435 118084             1
1436 118090             0
1437 118091             0
1438 118112             0
1439 118133             0
1440 118141             0
1441 118149             0
1442 119273             0
1443 118352             0
1444 118233             0
1445 137909             0
1446 118298             0
1447 118354             1
1448 118385             1
1449 118446             0
1450 118481             1
1451 118671             0
1452 118737             1
1453 118739             0
1454 118751             0
1455 118774             0
1456 118800             0
1457 118819             0
1458 118896             0
1459 119007             1
1460 119031             0
1461 119300             0
1462 119312             1
1463 119327             1
1464 119333             0
1465 119349             0
1466 119362             0
1467 119369             0
1468 119393             0
1469 119395             0
1470 119425             1
1471 119427             0
1472 119543             0
1473 119589             1
1474 119615             1
1475 119648             1
1476 119667             0
1477 119714             1
1478 119778             0
1479 119810             0
1480 119866             0
1481 119877             0
1482 119879             1
1483 119905             1
1484 119930             0
1485 119993             0
1486 120132             0
1487 120317             0
1488 120322             0
1489 120330             0
1490 120346             0
1491 120355             0
1492 120384             0
1493 120425             0
1494 120448             1
1495 120553             0
1496 120599             0
1497 120704             1
1498 120711             1
1499 120758             0
1500 120772             0
1501 120797             0
1502 120799             0
1503 120808             1
1504 120810             0
1505 120864             1
1506 120866             0
1507 123102             0
1508 122897             0
1509 120903             0
1510 120957             0
1511 121014             0
1512 121029             0
1513 145476             0
1514 121138             0
1515 121225             0
1516 121256             0
1517 121260             0
1518 121415             0
1519 121294             1
1520 121339             0
1521 121412             0
1522 121475             1
1523 121487             0
1524 121531             0
1525 121532             0
1526 121614             0
1527 121664             0
1528 121787             1
1529 121818             0
1530 121827             0
1531 121833             0
1532 121947             1
1533 121868             0
1534 121870             1
1535 121873             0
1536 121890             0
1537 121897             0
1538 121898             0
1539 121985             0
1540 122056             1
1541 122065             0
1542 122074             0
1543 129961             0
1544 122100             1
1545 122106             0
1546 122110             1
1547 122119             0
1548 122148             0
1549 122143             1
1550 122171             1
1551 122183             0
1552 122192             0
1553 122207             1
1554 122209             0
1555 122212             0
1556 122273             1
1557 122275             0
1558 122307             0
1559 122319             0
1560 122348             1
1561 122355             0
1562 122383             1
1563 122427             0
1564 122432             0
1565 122445             0
1566 122473             0
1567 122501             0
1568 122528             0
1569 122562             1
1570 122635             0
1571 122643             0
1572 122744             0
1573 122748             0
1574 122806             1
1575 122882             1
1576 122891             1
1577 122947             1
1578 122954             0
1579 123222             1
1580 122981             0
1581 122987             0
1582 123104             1
1583 123223             1
1584 123179             1
1585 123180             0
1586 123236             0
1587 123268             0
1588 123276             0
1589 123319             0
1590 123322             0
1591 123329             0
1592 123351             1
1593 123358             0
1594 123362             1
1595 123372             1
1596 123408             1
1597 123415             0
1598 123444             1
1599 123450             0
1600 123498             1
1601 123533             0
1602 123574             0
1603 123575             0
1604 123608             1
1605 123621             1
1606 123643             0
1607 123673             0
1608 123743             0
1609 123768             0
1610 123826             0
1611 123832             0
1612 123860             1
1613 123920             1
1614 123942             0
1615 123946             0
1616 123953             0
1617 123977             1
1618 123978             0
1619 123983             0
1620 123986             1
1621 124003             0
1622 124006             0
1623 124008             0
1624 124075             0
1625 124083             0
1626 124085             0
1627 124093             0
1628 124116             0
1629 124122             1
1630 124135             0
1631 124155             0
1632 124156             0
1633 124160             1
1634 124174             1
1635 124189             0
1636 124192             0
1637 124227             0
1638 124229             0
1639 124257             1
1640 124295             0
1641 124323             0
1642 124326             0
1643 124332             0
1644 124341             0
1645 124366             0
1646 124372             0
1647 124373             0
1648 124374             0
1649 130706             0
1650 124391             0
1651 124392             0
1652 124439             0
1653 124484             0
1654 124500             0
1655 124513             0
1656 124516             1
1657 124519             0
1658 124520             0
1659 124523             0
1660 124525             1
1661 124552             0
1662 124555             0
1663 124566             0
1664 124568             0
1665 124574             1
1666 124594             1
1667 124611             0
1668 124652             0
1669 124656             1
1670 124657             1
1671 124661             0
1672 124668             0
1673 124703             0
1674 124742             0
1675 124743             1
1676 124744             1
1677 124756             0
1678 124784             1
1679 124846             0
1680 124910             0
1681 124943             0
1682 124970             0
1683 124977             0
1684 125068             0
1685 125066             0
1686 125076             1
1687 125101             0
1688 125109             1
1689 125184             0
1690 125187             1
1691 125273             0
1692 125296             0
1693 125308             0
1694 125331             0
1695 125354             0
1696 125409             0
1697 125435             0
1698 125437             0
1699 125438             0
1700 125457             0
1701 125486             0
1702 125505             0
1703 125520             0
1704 125525             0
1705 125527             0
1706 125570             0
1707 125586             0
1708 125595             0
1709 125596             0
1710 125597             0
1711 125618             1
1712 125629             1
1713 125644             0
1714 125648             1
1715 125661             0
1716 125673             0
1717 125729             0
1718 125732             1
1719 125736             1
1720 125741             1
1721 125743             1
1722 125762             1
1723 125847             0
1724 125849             1
1725 125845             1
1726 125859             1
1727 125888             0
1728 125891             1
1729 125906             0
1730 125957             0
1731 125971             0
1732 125988             0
1733 125998             0
1734 126062             0
1735 126080             0
1736 126085             0
1737 126109             0
1738 126110             1
1739 126184             1
1740 126179             0
1741 126187             1
1742 126247             0
1743 126260             0
1744 126263             0
1745 126282             0
1746 126288             0
1747 126342             1
1748 126348             0
1749 126359             0
1750 126386             0
1751 126397             1
1752 126437             0
1753 126450             0
1754 126461             1
1755 126462             0
1756 126475             1
1757 126490             1
1758 126498             0
1759 126523             0
1760 126527             0
1761 126529             0
1762 126570             0
1763 126604             0
1764 126618             1
1765 126642             0
1766 126653             0
1767 126656             1
1768 126711             0
1769 126730             0
1770 126744             1
1771 126765             0
1772 126777             0
1773 126818             0
1774 126819             0
1775 126828             0
1776 126829             0
1777 126839             0
1778 126865             0
1779 126874             1
1780 126878             0
1781 126887             0
1782 126898             0
1783 126906             0
1784 138418             0
1785 126947             0
1786 126955             0
1787 126957             0
1788 126969             0
1789 126972             0
1790 127004             0
1791 127076             0
1792 127119             0
1793 127094             0
1794 127128             1
1795 127139             0
1796 127142             0
1797 127147             0
1798 127152             1
1799 127153             0
1800 127173             0
1801 127198             0
1802 127207             0
1803 127244             0
1804 127249             0
1805 127256             1
1806 127280             1
1807 127316             1
1808 127320             0
1809 127327             0
1810 127347             0
1811 127332             0
1812 127338             1
1813 127344             0
1814 127359             0
1815 127391             0
1816 127366             0
1817 127389             1
1818 127400             1
1819 127406             0
1820 127410             0
1821 127449             0
1822 127455             0
1823 127463             0
1824 127478             0
1825 132343             1
1826 127596             0
1827 127599             0
1828 127619             1
1829 127764             0
1830 127629             1
1831 127641             0
1832 127638             0
1833 127649             0
1834 127652             0
1835 127725             0
1836 127726             0
1837 127755             1
1838 127774             0
1839 127796             0
1840 127808             0
1841 127869             0
1842 127875             0
1843 127914             0
1844 127944             1
1845 127952             0
1846 127954             0
1847 127958             0
1848 127960             0
1849 127974             0
1850 127976             1
1851 128010             0
1852 128028             1
1853 128058             0
1854 128064             0
1855 128082             0
1856 128104             0
1857 128105             0
1858 128152             0
1859 128190             0
1860 128205             0
1861 128228             0
1862 128237             1
1863 128327             0
1864 128346             0
1865 128372             1
1866 128393             0
1867 128376             0
1868 128382             0
1869 128407             0
1870 128409             0
1871 128429             0
1872 128435             1
1873 128439             0
1874 128464             0
1875 128473             1
1876 128474             1
1877 128519             1
1878 128536             1
1879 128548             1
1880 128572             1
1881 128576             0
1882 128642             1
1883 128664             1
1884 128673             0
1885 128684             0
1886 128696             0
1887 128711             0
1888 128724             0
1889 128858             0
1890 128880             0
1891 128891             0
1892 128901             1
1893 128913             1
1894 128945             0
1895 128971             1
1896 128979             0
1897 128998             0
1898 129017             0
1899 129022             0
1900 129029             0
1901 129036             0
1902 129086             1
1903 129149             0
1904 129168             0
1905 129249             0
1906 129256             0
1907 129269             0
1908 129275             1
1909 129277             0
1910 129283             0
1911 129299             0
1912 129301             0
1913 129355             0
1914 129312             0
1915 129372             0
1916 129445             0
1917 129462             0
1918 129463             0
1919 129470             1
1920 129478             0
1921 129505             0
1922 129518             0
1923 129519             1
1924 129528             1
1925 129529             0
1926 129545             1
1927 129551             0
1928 129559             0
1929 129573             0
1930 129587             0
1931 137476             0
1932 129602             0
1933 129623             0
1934 129664             0
1935 129672             0
1936 129699             1
1937 129700             1
1938 129715             0
1939 129726             0
1940 129752             0
1941 129753             1
1942 129771             1
1943 129783             0
1944 129786             1
1945 129787             1
1946 129823             0
1947 129850             0
1948 129853             0
1949 130011             0
1950 129876             0
1951 129881             0
1952 129883             0
1953 129896             0
1954 129922             0
1955 129927             0
1956 129987             0
1957 130003             0
1958 130072             0
1959 130100             0
1960 130103             0
1961 130130             0
1962 130136             0
1963 130137             1
1964 130184             0
1965 130221             1
1966 130216             0
1967 130217             1
1968 130223             0
1969 130225             1
1970 130239             0
1971 132453             0
1972 130269             1
1973 130311             0
1974 130315             1
1975 130322             1
1976 130339             0
1977 130346             0
1978 130351             0
1979 130369             0
1980 130370             0
1981 130372             0
1982 130375             0
1983 130377             1
1984 130382             1
1985 130392             1
1986 130394             0
1987 130423             1
1988 130428             0
1989 130429             0
1990 130470             1
1991 130502             0
1992 130521             0
1993 130544             0
1994 130548             1
1995 130553             1
1996 130556             0
1997 130589             0
1998 130642             0
1999 130643             0
2000 130650             0
2001 130669             1
2002 130695             1
2003 130749             0
2004 130778             0
2005 130803             0
2006 130807             0
2007 130828             0
2008 130871             0
2009 130920             0
2010 130925             1
2011 130953             1
2012 130973             1
2013 130985             0
2014 130996             0
2015 131005             0
2016 131026             0
2017 140049             1
2018 131092             0
2019 131174             0
2020 131219             0
2021 131243             0
2022 131250             0
2023 131268             1
2024 131273             1
2025 131307             0
2026 131309             0
2027 131313             0
2028 131317             0
2029 131409             0
2030 131424             0
2031 131426             0
2032 131439             0
2033 131464             0
2034 131475             0
2035 131497             1
2036 131511             0
2037 131514             0
2038 131548             1
2039 131572             0
2040 131578             0
2041 131580             0
2042 131584             0
2043 131687             0
2044 131674             1
2045 131676             0
2046 131686             0
2047 131689             0
2048 131701             0
2049 131717             0
2050 131774             1
2051 131766             0
2052 131780             0
2053 131790             0
2054 131794             1
2055 131795             1
2056 131801             0
2057 131828             0
2058 131837             0
2059 131851             0
2060 131860             1
2061 131895             1
2062 131902             0
2063 131914             1
2064 131928             1
2065 131963             0
2066 131982             0
2067 131984             0
2068 131992             0
2069 132013             0
2070 132008             0
2071 132009             0
2072 132018             1
2073 132025             0
2074 132051             0
2075 132067             1
2076 132070             0
2077 132093             1
2078 132113             0
2079 132149             1
2080 132156             0
2081 132164             1
2082 132217             1
2083 132230             0
2084 132232             0
2085 132269             1
2086 132270             1
2087 132289             0
2088 132304             0
2089 132313             1
2090 132345             0
2091 140284             0
2092 132364             0
2093 132366             0
2094 132464             0
2095 132371             0
2096 132379             0
2097 132424             0
2098 132432             1
2099 132452             0
2100 132469             1
2101 132483             0
2102 132484             0
2103 132511             0
2104 132521             0
2105 132528             0
2106 132544             1
2107 132603             0
2108 132619             0
2109 132664             0
2110 132673             0
2111 132697             0
2112 132699             1
2113 132708             0
2114 132713             0
2115 132744             0
2116 132761             1
2117 132774             0
2118 132813             1
2119 132822             0
2120 132872             0
2121 132881             0
2122 132912             0
2123 132896             0
2124 132937             1
2125 132938             0
2126 132943             0
2127 132945             1
2128 132962             0
2129 132964             0
2130 132975             0
2131 132976             1
2132 133008             0
2133 133040             0
2134 133046             0
2135 133054             1
2136 133085             0
2137 133090             1
2138 133097             1
2139 133113             0
2140 133114             1
2141 133121             0
2142 133127             1
2143 133139             0
2144 133185             0
2145 133190             0
2146 133199             0
2147 133205             1
2148 133221             1
2149 133240             1
2150 133266             0
2151 133269             0
2152 133297             0
2153 133312             0
2154 133325             0
2155 133328             0
2156 133338             1
2157 133348             0
2158 133353             1
2159 133358             0
2160 133400             0
2161 133415             0
2162 133419             0
2163 133420             0
2164 133450             0
2165 133458             0
2166 133479             0
2167 133486             0
2168 133505             1
2169 133512             0
2170 133519             0
2171 133537             0
2172 133554             1
2173 133565             0
2174 133576             1
2175 133613             0
2176 133634             0
2177 133636             0
2178 133645             0
2179 133655             1
2180 133684             0
2181 133709             0
2182 133735             0
2183 133776             1
2184 133779             0
2185 133793             1
2186 133794             0
2187 133821             0
2188 133848             0
2189 133853             0
2190 133876             1
2191 133895             0
2192 133929             0
2193 133931             1
2194 133952             0
2195 133967             0
2196 133968             1
2197 133969             0
2198 133972             0
2199 133976             1
2200 133998             0
2201 133999             0
2202 134004             1
2203 134007             0
2204 134012             0
2205 134034             0
2206 134035             0
2207 134070             0
2208 134089             0
2209 134976             0
2210 134108             1
2211 134118             0
2212 134122             0
2213 134161             0
2214 134171             1
2215 134173             1
2216 134187             1
2217 134194             0
2218 134201             0
2219 134215             0
2220 134222             1
2221 134299             1
2222 134349             0
2223 134354             0
2224 134363             1
2225 134382             0
2226 134403             1
2227 134394             1
2228 134410             0
2229 134443             0
2230 134457             0
2231 134458             1
2232 134474             0
2233 134477             0
2234 134493             1
2235 134506             0
2236 134511             0
2237 134514             0
2238 134516             0
2239 134550             1
2240 134562             1
2241 134583             0
2242 134607             0
2243 134668             0
2244 134680             1
2245 134687             1
2246 134702             0
2247 134706             0
2248 134720             0
2249 134722             1
2250 134726             0
2251 134739             0
2252 134755             0
2253 134758             0
2254 134776             0
2255 134809             0
2256 134818             0
2257 134820             0
2258 134833             0
2259 134842             0
2260 134866             1
2261 134868             1
2262 134878             0
2263 134881             0
2264 134892             0
2265 134893             0
2266 134899             1
2267 134903             1
2268 134931             0
2269 134981             0
2270 135019             0
2271 135021             0
2272 135029             0
2273 135030             1
2274 135051             0
2275 135077             0
2276 135094             0
2277 135108             0
2278 135118             0
2279 135201             0
2280 135202             1
2281 135210             0
2282 135657             0
2283 135262             0
2284 135270             1
2285 135303             0
2286 135340             1
2287 135437             0
2288 135461             1
2289 135462             0
2290 135475             0
2291 135529             0
2292 144210             1
2293 135540             0
2294 135546             0
2295 135589             1
2296 135614             0
2297 135622             0
2298 144345             0
2299 135689             0
2300 135705             0
2301 135725             0
2302 135766             1
2303 135753             0
2304 135773             1
2305 135786             0
2306 135820             0
2307 135835             0
2308 135885             0
2309 135903             0
2310 135983             0
2311 136019             0
2312 136050             0
2313 136052             0
2314 136064             0
2315 136081             0
2316 136113             1
2317 136138             0
2318 136148             1
2319 136154             0
2320 136156             0
2321 136176             0
2322 136183             0
2323 136184             1
2324 136190             0
2325 136298             0
2326 136263             1
2327 136266             1
2328 136275             0
2329 136282             1
2330 136295             0
2331 136337             1
2332 136368             0
2333 136370             0
2334 136372             0
2335 136381             0
2336 136413             0
2337 136425             0
2338 136432             1
2339 136446             1
2340 136448             0
2341 136476             1
2342 136477             0
2343 136523             0
2344 136532             0
2345 136541             0
2346 136564             1
2347 136572             0
2348 136586             1
2349 136614             0
2350 136622             1
2351 136625             0
2352 136657             0
2353 136687             0
2354 136699             1
2355 136720             0
2356 136741             0
2357 136763             0
2358 136780             0
2359 136789             1
2360 136895             0
2361 136809             0
2362 136869             0
2363 136889             0
2364 136908             0
2365 136921             0
2366 136955             0
2367 136978             0
2368 136984             1
2369 137037             0
2370 137059             0
2371 137046             0
2372 137061             0
2373 137065             0
2374 137088             0
2375 137091             0
2376 137096             0
2377 137097             0
2378 137099             1
2379 137103             1
2380 137105             0
2381 137137             0
2382 137146             0
2383 137242             1
2384 137183             0
2385 141765             0
2386 137201             0
2387 137204             0
2388 137219             0
2389 137222             0
2390 137230             0
2391 137238             0
2392 137240             0
2393 137241             1
2394 137246             0
2395 137294             1
2396 137258             0
2397 137261             0
2398 137284             0
2399 137290             0
2400 137293             0
2401 137300             0
2402 137318             1
2403 137329             0
2404 137330             1
2405 137335             1
2406 137347             0
2407 137359             1
2408 137376             0
2409 137394             0
2410 137408             0
2411 137435             1
2412 137436             1
2413 137471             1
2414 137478             1
2415 137485             0
2416 137490             0
2417 137529             0
2418 137530             1
2419 137539             0
2420 137557             0
2421 137561             0
2422 137579             0
2423 137581             0
2424 137582             1
2425 137605             0
2426 137637             0
2427 137630             1
2428 137633             0
2429 137634             0
2430 137636             0
2431 137640             0
2432 137645             1
2433 137646             1
2434 137654             0
2435 137702             1
2436 137662             1
2437 137672             0
2438 137688             0
2439 137712             0
2440 137729             0
2441 137732             0
2442 137738             1
2443 137742             1
2444 137756             0
2445 137761             0
2446 137762             0
2447 137766             0
2448 137768             1
2449 137775             0
2450 137776             0
2451 137778             1
2452 137782             1
2453 137809             1
2454 137814             1
2455 137835             0
2456 137855             1
2457 137917             1
2458 137919             0
2459 137924             0
2460 137944             0
2461 137955             1
2462 137960             0
2463 137967             0
2464 137977             0
2465 137994             0
2466 137996             0
2467 137997             0
2468 138052             0
2469 138075             0
2470 138097             1
2471 138109             0
2472 138111             0
2473 138127             0
2474 138133             1
2475 138152             0
2476 138137             0
2477 138153             0
2478 138161             1
2479 138226             1
2480 138227             1
2481 138231             0
2482 138250             1
2483 138271             0
2484 138282             0
2485 138302             0
2486 138305             0
2487 138324             0
2488 138336             1
2489 138378             0
2490 138395             0
2491 138407             0
2492 138446             0
2493 138508             0
2494 138559             1
2495 138572             0
2496 138573             1
2497 138574             0
2498 138584             0
2499 138587             1
2500 138597             0
2501 138630             0
2502 138633             0
2503 138659             0
2504 138667             0
2505 138672             1
2506 138673             0
2507 138696             0
2508 138699             1
2509 138707             0
2510 138712             0
2511 138714             0
2512 138735             0
2513 138740             0
2514 138756             0
2515 138760             0
2516 138784             0
2517 138790             0
2518 138843             0
2519 138797             0
2520 138830             0
2521 138850             0
2522 138856             0
2523 138860             0
2524 138861             0
2525 138868             0
2526 138883             0
2527 138894             1
2528 138895             1
2529 138908             0
2530 138915             0
2531 138916             0
2532 138918             0
2533 138927             0
2534 138959             0
2535 138968             0
2536 138969             0
2537 138970             0
2538 138974             1
2539 139000             1
2540 139025             0
2541 139026             0
2542 139029             0
2543 139065             1
2544 139162             0
2545 139176             0
2546 139180             0
2547 139188             0
2548 139190             1
2549 139191             1
2550 139229             0
2551 139239             0
2552 139257             0
2553 139270             0
2554 139282             0
2555 139308             0
2556 139316             1
2557 139371             0
2558 139376             0
2559 139378             0
2560 139389             0
2561 139406             0
2562 139432             0
2563 139470             1
2564 139473             1
2565 139475             0
2566 139476             0
2567 139481             0
2568 139488             0
2569 139499             1
2570 139507             0
2571 139508             0
2572 139518             0
2573 139553             0
2574 139557             0
2575 139559             0
2576 143584             1
2577 139609             1
2578 139626             0
2579 139642             0
2580 139650             0
2581 139657             1
2582 139691             0
2583 139702             0
2584 139703             0
2585 139707             0
2586 139708             0
2587 139718             0
2588 139729             1
2589 139735             0
2590 139769             0
2591 139771             0
2592 139773             1
2593 139801             0
2594 139838             0
2595 139844             0
2596 139851             1
2597 139873             0
2598 139897             0
2599 139899             0
2600 139932             0
2601 140025             0
2602 140039             0
2603 140096             0
2604 140106             1
2605 140114             0
2606 140117             0
2607 140120             0
2608 141066             0
2609 140127             1
2610 140145             0
2611 140178             0
2612 140165             0
2613 140199             0
2614 140228             0
2615 140230             1
2616 140267             0
2617 140268             0
2618 140270             0
2619 140272             0
2620 140300             0
2621 140315             0
2622 140328             0
2623 140332             0
2624 140342             1
2625 140344             1
2626 140387             0
2627 140421             1
2628 140425             1
2629 140433             1
2630 140456             1
2631 140461             0
2632 140464             0
2633 140467             0
2634 140472             0
2635 140490             0
2636 140512             0
2637 140522             0
2638 140551             0
2639 140557             0
2640 140559             1
2641 140560             0
2642 140563             1
2643 140566             0
2644 140570             0
2645 140576             0
2646 140586             0
2647 140600             0
2648 140601             0
2649 140603             0
2650 140624             0
2651 140627             0
2652 140637             1
2653 140662             0
2654 140697             0
2655 140699             1
2656 140700             0
2657 140701             0
2658 140711             0
2659 140720             0
2660 140730             0
2661 140741             1
2662 140758             0
2663 140779             1
2664 140799             0
2665 140821             0
2666 140822             0
2667 140835             0
2668 140846             0
2669 140902             1
2670 140905             1
2671 140958             0
2672 140982             0
2673 141041             0
2674 141054             1
2675 141059             0
2676 141072             0
2677 141073             0
2678 141074             1
2679 141089             1
2680 141116             0
2681 141140             0
2682 141146             0
2683 141177             0
2684 141184             0
2685 141189             0
2686 141266             1
2687 141257             1
2688 141263             0
2689 141305             0
2690 141292             0
2691 141315             0
2692 141316             0
2693 141322             0
2694 141334             0
2695 141342             0
2696 141407             0
2697 141384             0
2698 141388             0
2699 141399             0
2700 141402             1
2701 141403             0
2702 141406             0
2703 141432             0
2704 141437             0
2705 141448             0
2706 141450             0
2707 141457             0
2708 141460             0
2709 141484             0
2710 141508             0
2711 141510             0
2712 141527             1
2713 141575             0
2714 141623             0
2715 141598             0
2716 141605             0
2717 141611             0
2718 141618             0
2719 141628             0
2720 141630             0
2721 141634             0
2722 141640             0
2723 141649             0
2724 141691             0
2725 141692             0
2726 141698             0
2727 141742             0
2728 141753             0
2729 141757             1
2730 141780             1
2731 141808             0
2732 141814             1
2733 141826             1
2734 141841             1
2735 141864             0
2736 141865             0
2737 141880             0
2738 141882             1
2739 141885             0
2740 141890             0
2741 141913             0
2742 141945             0
2743 141970             0
2744 141984             0
2745 141996             1
2746 142026             0
2747 142029             0
2748 142048             0
2749 142091             0
2750 142100             1
2751 142102             0
2752 142135             0
2753 142141             0
2754 142142             0
2755 142161             0
2756 142164             0
2757 142167             0
2758 142182             0
2759 142186             1
2760 142195             1
2761 142200             0
2762 142206             0
2763 142225             0
2764 142235             0
2765 142240             0
2766 142255             0
2767 142258             0
2768 142272             0
2769 142273             0
2770 142274             0
2771 142290             1
2772 142305             0
2773 142333             0
2774 142346             0
2775 142358             0
2776 142360             0
2777 142368             0
2778 142369             0
2779 142373             0
2780 142410             0
2781 142411             0
2782 142429             1
2783 142456             0
2784 142460             0
2785 142470             0
2786 142471             0
2787 142500             0
2788 142513             0
2789 142517             0
2790 142525             0
2791 142538             1
2792 142539             0
2793 142579             0
2794 142586             0
2795 142622             0
2796 142643             0
2797 142647             0
2798 142650             1
2799 142661             0
2800 142675             0
2801 142678             0
2802 142743             0
2803 142776             0
2804 142782             0
2805 142822             1
2806 142862             0
2807 142895             1
2808 142911             0
2809 142917             0
2810 142919             0
2811 142928             0
2812 142933             0
2813 142946             1
2814 142948             0
2815 142967             0
2816 142971             1
2817 142975             0
2818 142990             0
2819 142991             0
2820 143001             0
2821 143005             0
2822 143040             0
2823 143041             0
2824 143052             0
2825 143056             1
2826 143057             0
2827 143059             1
2828 143070             1
2829 143139             0
2830 143148             0
2831 143155             0
2832 143156             0
2833 143157             0
2834 143162             0
2835 143167             0
2836 143169             0
2837 143170             0
2838 143171             0
2839 143180             0
2840 143191             0
2841 143197             0
2842 143210             0
2843 143219             0
2844 143222             0
2845 143245             0
2846 143264             0
2847 143284             0
2848 143295             0
2849 143303             0
2850 143304             0
2851 143321             0
2852 143332             0
2853 143333             0
2854 143357             0
2855 143406             0
2856 143419             0
2857 143430             1
2858 143447             0
2859 143451             1
2860 143453             0
2861 143456             0
2862 143460             0
2863 143466             0
2864 143492             0
2865 143531             0
2866 143542             1
2867 143548             0
2868 143576             0
2869 143604             0
2870 143624             0
2871 143666             0
2872 143694             0
2873 143718             0
2874 143752             0
2875 143792             0
2876 143795             0
2877 143798             0
2878 143799             0
2879 143805             0
2880 143816             0
2881 143836             0
2882 143851             0
2883 143867             1
2884 143886             1
2885 143888             1
2886 143907             0
2887 143915             0
2888 143925             0
2889 143949             0
2890 143959             0
2891 143969             0
2892 143972             0
2893 143982             0
2894 143990             0
2895 143995             0
2896 144029             0
2897 144020             0
2898 144052             0
2899 144069             0
2900 144074             0
2901 144082             0
2902 144101             0
2903 144105             0
2904 144115             0
2905 144133             0
2906 144134             0
2907 144135             0
2908 144201             0
2909 144202             0
2910 144207             0
2911 144227             1
2912 144240             0
2913 144249             0
2914 144259             0
2915 144271             1
2916 144273             0
2917 144321             0
2918 144332             0
2919 144348             1
2920 144381             0
2921 144397             1
2922 144403             0
2923 144411             0
2924 144415             1
2925 144417             0
2926 144447             1
2927 144479             0
2928 144488             0
2929 144491             0
2930 144497             0
2931 144511             0
2932 144519             0
2933 144552             0
2934 144573             0
2935 144555             0
2936 144584             0
2937 144596             0
2938 144624             0
2939 144637             0
2940 144658             0
2941 144660             0
2942 144663             0
2943 144688             0
2944 144692             0
2945 144727             0
2946 144729             0
2947 144733             0
2948 144787             0
2949 144839             0
2950 144854             0
2951 144858             0
2952 144862             0
2953 144896             1
2954 144917             0
2955 144926             0
2956 144927             0
2957 144992             0
2958 144995             0
2959 145001             0
2960 145002             1
2961 145049             0
2962 145007             0
2963 145020             0
2964 145032             0
2965 145057             0
2966 145061             1
2967 145066             1
2968 145087             0
2969 145118             0
2970 145194             0
2971 145236             0
2972 145239             1
2973 145281             0
2974 145417             1
2975 145299             0
2976 145309             1
2977 145312             0
2978 145322             0
2979 145344             1
2980 145351             0
2981 145354             0
2982 145365             0
2983 145366             0
2984 145372             0
2985 145394             1
2986 145472             0
2987 145488             0
2988 145557             0
2989 145560             0
2990 145566             0
2991 145617             0
2992 145628             0
2993 145662             0
2994 145675             0
2995 145706             0
2996 145724             1
2997 145745             0
2998 145754             0
2999 145838             0
3000 145840             1
3001 145871             1
3002 145911             0
3003 145957             0
3004 145964             0
3005 145978             0
3006 145979             0
3007 145993             0
3008 146001             0
3009 146041             0
3010 146080             0
3011 146081             0
3012 146085             0
3013 146114             1
3014 146131             0
3015 146136             0
3016 146139             0
3017 146144             0
3018 146149             0
3019 146167             0
3020 146169             0
3021 146250             0
3022 146251             0
3023 146315             0
3024 146324             0
3025 146326             0
3026 146359             0
3027 146371             0
3028 146406             0
3029 146436             0
3030 146449             0
3031 146459             1
3032 146499             0
3033 146503             0
3034 146510             0
3035 146522             0
3036 146555             0
3037 146569             0
3038 146582             0
3039 146623             0
3040 146674             1
3041 146707             0
3042 146718             0
3043 146723             1
3044 146729             0
3045 146803             0
3046 146810             0
3047 146836             0
3048 146854             0
3049 146878             0
3050 146886             0
3051 146890             1
3052 146909             0
3053 146930             0
3054 146943             0
3055 146939             1
3056 146960             0
3057 146982             0
3058 146991             0
3059 146992             0
3060 147005             0
3061 147007             0
3062 147095             0
3063 147077             0
3064 147078             0
3065 147084             0
3066 147128             0
3067 147169             0
3068 147196             1
3069 147276             0
3070 147274             0
3071 147277             0
3072 147286             0
3073 147337             1
3074 147374             1
3075 147387             0
3076 147445             0
3077 147454             1
3078 147487             0
3079 147510             0
3080 147513             0
3081 147519             0
3082 147536             0
3083 147540             0
3084 147573             0
3085 147593             0
3086 147616             0
3087 147629             0
3088 147633             0
3089 147642             0
3090 147700             1
3091 147714             1
3092 147717             0
3093 147719             1
3094 147740             1
3095 147749             0
3096 147755             0
3097 147756             0
3098 147758             0
3099 147764             0
3100 147770             0
3101 147783             0
3102 147796             0
3103 147805             0
3104 147816             0
3105 147817             0
3106 147830             0
3107 147850             0
3108 147856             0
3109 147861             0
3110 147879             0
3111 147886             0
3112 147920             1
3113 147923             1
3114 147930             0
3115 147939             0
3116 147961             0
3117 147965             0
3118 147976             0
3119 148001             1
3120 148004             1
3121 148041             0
3122 148082             0
3123 148115             1
3124 148120             0
3125 148131             0
3126 148140             1
3127 148164             1
3128 148171             0
3129 148186             0
3130 148191             0
3131 148193             0
3132 148234             0
3133 148198             0
3134 148209             0
3135 148237             0
3136 148292             0
3137 148313             0
3138 148314             1
3139 148361             0
3140 148369             0
3141 148429             0
3142 148430             1
3143 148469             0
3144 148472             0
3145 148479             0
3146 148491             0
3147 148497             0
3148 148505             0
3149 148538             0
3150 148560             1
3151 148570             1
3152 148619             0
3153 148672             0
3154 148687             1
3155 148717             0
3156 148837             0
3157 148787             0
3158 148792             0
3159 149251             1
3160 148811             0
3161 148821             0
3162 148840             0
3163 148884             0
3164 148886             1
3165 148893             0
3166 148903             0
3167 148916             0
3168 148917             0
3169 148936             0
3170 148962             0
3171 148969             1
3172 148985             1
3173 148993             0
3174 149035             0
3175 149036             0
3176 149049             1
3177 149057             1
3178 149116             0
3179 149136             0
3180 149139             0
3181 149144             0
3182 149145             0
3183 149188             0
3184 149208             0
3185 149209             1
3186 149273             0
3187 149277             0
3188 149287             0
3189 149288             0
3190 149289             0
3191 149328             0
3192 149336             0
3193 149345             0
3194 149348             0
3195 149383             0
3196 149400             0
3197 149408             0
3198 149409             0
3199 149462             0
3200 149494             0
3201 149495             0
3202 149502             1
3203 149505             1
3204 149519             0
3205 149543             0
3206 149552             0
3207 149565             1
3208 149576             0
3209 149578             0
3210 149581             0
3211 149643             0
3212 149710             0
3213 149718             0
3214 149719             0
3215 149731             0
3216 149764             0
3217 149765             0
3218 149768             0
3219 149805             0
3220 149813             1
3221 149820             0
3222 149822             0
3223 149828             0
3224 149829             0
3225 149885             0
3226 149892             1
3227 149906             0
3228 149926             1
3229 149939             0
3230 149943             0
3231 149972             0
3232 149973             1
3233 149977             1
3234 149980             0
3235 149983             0
3236 149986             0
3237 149987             0
3238 149988             0
3239 149993             0
3240 150031             0
3241 150054             0
3242 150067             0
3243 150073             0
3244 150074             0
3245 150080             0
3246 150083             0
3247 150086             0
3248 150092             0
3249 150095             0
3250 150111             0
3251 150114             0
3252 150138             0
3253 150154             0
3254 150156             0
3255 150163             0
3256 150184             1
3257 150191             1
3258 150243             1
3259 150253             1
3260 150266             0
3261 150297             0
3262 150394             0
3263 150397             1
3264 150410             0
3265 150423             0
3266 150437             1
3267 150439             1
3268 150468             0
3269 150469             0
3270 150472             1
3271 150475             0
3272 150487             0
3273 150507             0
3274 150526             0
3275 150529             0
3276 150578             0
3277 150614             0
3278 150608             0
3279 150612             0
3280 150640             0
3281 150645             1
3282 150670             1
3283 150691             0
3284 150694             0
3285 150706             1
3286 150713             1
3287 150742             0
3288 150758             0
3289 150787             0
3290 150814             0
3291 150818             1
3292 150827             0
3293 150837             1
3294 150850             0
3295 150857             0
3296 150859             0
3297 150903             0
3298 150939             1
3299 157120             0
3300 151027             0
3301 151040             0
3302 151104             1
3303 151123             1
3304 151124             0
3305 151129             0
3306 151130             1
3307 151211             0
3308 151191             0
3309 151199             1
3310 151227             1
3311 151236             0
3312 151241             0
3313 151250             0
3314 151279             0
3315 151314             0
3316 151315             1
3317 151317             0
3318 151356             0
3319 151391             0
3320 151393             0
3321 151399             0
3322 151403             1
3323 151407             0
3324 151409             0
3325 151433             0
3326 151434             0
3327 151436             0
3328 151557             0
3329 151585             0
3330 151594             0
3331 151654             0
3332 151662             0
3333 151673             0
3334 151678             0
3335 151682             0
3336 151689             0
3337 151699             1
3338 151700             0
3339 151705             0
3340 151725             0
3341 151733             0
3342 151752             0
3343 151756             0
3344 151758             0
3345 151797             0
3346 151803             0
3347 151807             0
3348 151818             0
3349 151842             0
3350 151847             0
3351 151895             0
3352 151902             0
3353 151937             0
3354 151957             0
3355 152024             0
3356 152034             0
3357 152050             0
3358 152084             0
3359 152099             0
3360 152151             0
3361 152173             0
3362 152179             1
3363 152202             0
3364 159959             0
3365 152230             1
3366 152248             0
3367 152252             0
3368 152264             1
3369 152319             0
3370 152360             0
3371 152372             1
3372 152377             1
3373 152385             1
3374 152390             1
3375 152410             1
3376 152430             0
3377 152468             0
3378 152472             0
3379 152479             1
3380 152493             0
3381 152503             0
3382 152513             1
3383 152535             0
3384 152578             0
3385 152588             0
3386 152612             0
3387 152651             0
3388 152676             1
3389 152677             0
3390 152694             1
3391 152711             0
3392 152718             0
3393 152752             1
3394 152804             0
3395 152809             0
3396 152844             1
3397 152908             0
3398 152921             0
3399 152930             0
3400 152940             1
3401 152963             0
3402 152970             0
3403 152992             0
3404 152996             0
3405 153010             1
3406 153017             0
3407 153022             0
3408 153054             0
3409 153073             0
3410 153111             0
3411 153119             0
3412 153130             0
3413 153133             0
3414 153162             1
3415 153200             0
3416 153237             0
3417 153239             0
3418 153241             1
3419 153274             0
3420 153282             0
3421 153304             0
3422 153298             0
3423 153312             1
3424 153313             0
3425 153328             0
3426 153329             0
3427 153331             0
3428 153337             1
3429 153349             0
3430 153357             0
3431 155217             1
3432 153365             1
3433 155261             0
3434 153400             0
3435 153403             0
3436 153405             0
3437 153437             1
3438 153438             0
3439 153444             1
3440 153470             0
3441 153497             0
3442 153547             0
3443 153592             0
3444 153597             0
3445 153649             0
3446 153678             0
3447 153679             0
3448 153680             1
3449 153681             0
3450 153716             0
3451 153724             0
3452 153725             0
3453 153735             0
3454 153752             1
3455 153760             1
3456 153761             0
3457 153762             0
3458 153787             1
3459 153802             1
3460 153826             1
3461 153913             0
3462 153939             0
3463 153961             0
3464 153963             0
3465 153965             0
3466 153996             0
3467 154052             0
3468 154055             0
3469 154061             0
3470 154106             0
3471 154120             0
3472 154132             1
3473 154133             0
3474 154135             1
3475 154136             0
3476 154138             0
3477 154311             0
3478 154162             0
3479 154164             0
3480 154200             0
3481 154201             0
3482 154222             1
3483 154280             0
3484 154283             0
3485 154294             0
3486 154329             0
3487 154344             0
3488 154349             0
3489 154375             0
3490 154387             1
3491 154394             1
3492 154398             0
3493 154400             0
3494 154401             0
3495 154404             0
3496 154466             0
3497 154504             0
3498 154571             0
3499 154590             0
3500 154594             0
3501 154599             0
3502 154638             0
3503 154651             1
3504 154662             0
3505 154666             0
3506 154676             0
3507 154681             1
3508 154686             0
3509 154688             0
3510 154713             0
3511 154723             0
3512 154729             1
3513 154736             0
3514 154745             0
3515 154749             0
3516 154772             1
3517 154755             1
3518 154782             1
3519 154765             0
3520 154766             0
3521 154800             0
3522 154801             0
3523 154803             0
3524 154829             0
3525 154852             0
3526 154864             1
3527 154868             0
3528 154891             1
3529 154881             0
3530 154885             1
3531 154921             0
3532 154937             0
3533 154968             0
3534 154974             0
3535 154987             0
3536 154994             1
3537 154997             0
3538 155001             0
3539 155006             0
3540 155040             0
3541 155067             1
3542 155073             0
3543 155077             0
3544 155089             0
3545 155127             0
3546 155139             0
3547 155192             0
3548 155200             0
3549 155233             0
3550 155246             0
3551 155247             0
3552 155263             0
3553 155291             0
3554 155292             0
3555 155302             0
3556 155346             0
3557 155357             0
3558 155386             1
3559 155401             0
3560 155415             0
3561 155420             0
3562 155434             0
3563 155455             0
3564 155458             0
3565 155461             0
3566 155469             0
3567 155488             1
3568 155492             0
3569 155497             1
3570 155500             0
3571 155510             0
3572 155519             1
3573 155543             0
3574 155544             1
3575 155567             0
3576 155574             0
3577 155584             0
3578 155727             0
3579 155598             0
3580 155607             0
3581 155611             0
3582 155612             0
3583 155613             1
3584 155623             0
3585 155633             0
3586 155701             0
3587 155703             0
3588 155711             0
3589 155714             0
3590 155720             1
3591 155723             0
3592 155741             0
3593 155756             0
3594 155771             1
3595 155773             0
3596 155797             1
3597 155844             1
3598 155868             0
3599 155870             0
3600 155884             0
3601 155891             1
3602 155910             0
3603 155942             0
3604 155960             0
3605 155962             0
3606 155969             0
3607 155970             1
3608 156029             0
3609 156030             0
3610 156098             1
3611 156112             1
3612 156125             1
3613 156133             1
3614 156156             0
3615 156170             0
3616 156173             0
3617 156189             0
3618 156197             1
3619 156224             0
3620 156241             0
3621 156245             0
3622 156257             1
3623 156259             0
3624 156260             0
3625 156261             0
3626 156285             0
3627 156297             0
3628 156301             0
3629 156327             0
3630 156346             0
3631 156374             0
3632 156387             0
3633 156404             1
3634 156436             0
3635 156447             0
3636 156456             0
3637 156470             0
3638 156471             0
3639 156493             0
3640 156487             0
3641 156506             1
3642 156510             0
3643 156532             0
3644 156544             0
3645 156551             0
3646 156562             1
3647 156573             0
3648 156580             0
3649 156589             0
3650 156596             0
3651 156600             0
3652 156607             0
3653 156608             0
3654 156613             0
3655 156666             0
3656 156691             0
3657 156694             1
3658 156721             0
3659 156773             1
3660 156822             0
3661 156919             0
3662 156925             0
3663 156926             0
3664 156937             0
3665 156964             0
3666 156978             0
3667 156982             1
3668 156986             0
3669 157000             0
3670 157010             1
3671 157032             0
3672 157052             0
3673 157061             0
3674 157068             0
3675 157093             0
3676 157113             0
3677 157152             1
3678 157160             0
3679 157172             0
3680 157173             0
3681 157184             0
3682 157194             0
3683 157278             0
3684 157199             0
3685 157206             0
3686 157225             0
3687 157234             0
3688 157237             0
3689 157239             1
3690 157240             0
3691 157241             0
3692 157245             0
3693 157256             0
3694 157272             0
3695 157285             0
3696 157287             0
3697 157332             0
3698 157363             0
3699 157365             0
3700 157373             0
3701 157379             0
3702 157402             1
3703 157404             0
3704 157424             0
3705 157427             0
3706 157437             0
3707 157443             0
3708 157446             0
3709 157453             0
3710 157464             0
3711 157468             0
3712 157474             0
3713 157478             0
3714 157491             0
3715 157494             1
3716 157498             0
3717 157501             0
3718 157505             0
3719 157540             0
3720 157547             0
3721 157556             0
3722 157561             0
3723 157570             0
3724 157574             0
3725 157592             0
3726 157612             0
3727 157615             1
3728 157616             0
3729 157624             0
3730 157626             0
3731 157627             0
3732 157630             0
3733 157639             0
3734 157653             1
3735 157659             0
3736 157667             0
3737 157684             0
3738 157702             0
3739 157703             0
3740 157733             0
3741 157736             0
3742 157739             0
3743 157771             0
3744 157785             0
3745 157787             0
3746 160131             0
3747 157791             0
3748 157803             0
3749 157818             0
3750 160209             0
3751 157825             0
3752 157844             1
3753 157877             0
3754 157878             1
3755 157879             0
3756 157884             0
3757 157905             0
3758 157908             0
3759 157912             0
3760 157933             0
3761 157940             1
3762 157943             0
3763 157948             0
3764 157978             1
3765 157979             0
3766 157994             0
3767 158001             0
3768 158010             0
3769 158045             0
3770 158050             0
3771 158065             0
3772 158068             0
3773 158075             1
3774 158079             1
3775 158109             0
3776 158125             0
3777 158137             0
3778 158146             0
3779 158182             0
3780 158203             0
3781 158214             0
3782 158245             0
3783 158264             0
3784 158270             0
3785 158274             0
3786 158281             0
3787 158283             0
3788 158288             1
3789 158289             0
3790 158309             0
3791 158311             0
3792 158374             0
3793 158333             1
3794 158335             0
3795 158367             0
3796 158372             0
3797 158392             1
3798 158406             0
3799 158435             0
3800 158437             1
3801 158438             0
3802 158446             0
3803 158476             0
3804 158484             0
3805 158493             0
3806 158517             1
3807 158522             0
3808 158525             0
3809 158531             0
3810 158534             0
3811 158538             1
3812 158561             0
3813 158563             0
3814 158657             1
3815 158606             0
3816 158622             0
3817 158623             0
3818 158632             1
3819 158645             0
3820 158669             0
3821 158700             0
3822 158705             0
3823 158713             1
3824 158723             0
3825 158762             0
3826 158765             0
3827 158774             0
3828 158778             0
3829 158791             0
3830 158800             0
3831 158840             0
3832 158843             0
3833 158849             0
3834 158858             0
3835 158866             0
3836 158867             0
3837 158883             0
3838 158909             0
3839 158946             0
3840 158988             0
3841 158993             0
3842 159012             0
3843 159018             0
3844 159027             0
3845 159034             0
3846 159039             0
3847 159069             0
3848 159081             0
3849 159087             0
3850 159089             0
3851 159090             0
3852 159138             1
3853 159157             0
3854 159162             0
3855 159176             0
3856 159185             0
3857 159208             0
3858 159210             0
3859 159212             0
3860 159216             1
3861 159221             0
3862 159223             0
3863 159225             0
3864 159226             1
3865 159227             1
3866 159251             0
3867 159252             0
3868 159263             0
3869 159270             0
3870 159280             0
3871 159292             0
3872 159296             0
3873 159299             0
3874 159350             0
3875 159355             0
3876 159358             1
3877 159368             0
3878 159393             1
3879 159398             0
3880 159401             0
3881 159404             0
3882 159405             0
3883 159426             0
3884 159433             0
3885 159435             0
3886 159437             0
3887 159439             0
3888 159453             0
3889 159471             0
3890 159480             0
3891 159481             0
3892 159501             0
3893 159505             0
3894 159512             0
3895 159548             0
3896 159574             0
3897 159584             0
3898 159585             0
3899 159596             0
3900 159597             0
3901 159632             0
3902 159644             0
3903 159671             0
3904 159672             0
3905 159715             0
3906 159720             0
3907 159738             0
3908 159750             0
3909 159766             0
3910 159844             0
3911 159848             0
3912 159868             0
3913 159895             0
3914 159916             0
3915 159920             0
3916 159954             0
3917 159986             0
3918 160023             0
3919 160016             0
3920 160020             1
3921 160042             0
3922 160082             0
3923 160090             0
3924 160130             0
3925 160111             0
3926 160112             0
3927 160118             0
3928 160134             1
3929 160154             0
3930 160159             0
3931 160160             0
3932 160217             0
3933 160225             0
3934 160186             0
3935 160213             1
3936 160215             0
3937 160231             0
3938 160232             1
3939 160241             0
3940 160244             0
3941 160245             0
3942 160261             0
3943 160268             0
3944 160286             0
3945 160287             0
3946 160289             0
3947 160311             0
3948 160324             0
3949 160361             0
3950 160362             0
3951 160369             0
3952 160392             0
3953 160393             0
3954 160397             0
3955 160423             0
3956 160441             0
3957 160442             0
3958 160443             0
3959 160459             0
3960 160461             0
3961 160464             0
3962 160488             0
3963 160502             0
3964 160503             0
3965 160533             0
3966 160569             1
3967 160573             0
3968 160577             0
3969 160579             0
3970 160597             0
3971 160620             0
3972 160637             0
3973 160638             0
3974 160657             0
3975 160666             0
3976 160669             0
3977 160670             0
3978 160684             0
3979 160704             0
3980 160712             0
3981 160722             0
3982 160734             0
3983 160735             0
3984 160736             1
3985 160738             0
3986 160755             0
3987 160759             0
3988 160779             0
3989 160780             1
3990 160793             0
3991 160802             0
3992 160825             0
3993 160906             0
3994 160834             0
3995 160839             0
3996 160848             1
3997 160852             0
3998 160863             0
3999 160864             0
4000 160865             0
4001 160869             0
4002 160876             0
4003 160881             0
4004 160904             0
4005 160914             0
4006 160918             0
4007 160933             0
4008 160934             0
4009 160935             0
4010 160940             0
4011 160951             0
4012 160956             0
4013 160970             0
4014 160990             0
4015 160991             0
4016 160999             1
4017 161010             0
4018 161023             0
4019 161025             0
4020 161040             0
4021 161052             0
4022 161059             0
4023 161066             0
4024 161067             0
4025 161083             0
4026 161089             0
4027 161103             0
4028 161106             0
4029 161117             0
4030 161122             0
4031 161153             0
4032 161167             0
4033 161202             0
4034 161212             0
4035 161217             0
4036 161220             0
4037 161248             1
4038 161256             0
4039 161258             0
4040 161266             0
4041 161305             0
4042 161338             0
4043 161348             0
4044 161349             0
4045 161354             0
4046 161358             0
4047 161364             0
4048 161392             0
4049 161395             0
4050 161415             0
4051 161416             0
4052 161418             0
4053 161420             1
4054 161421             0
4055 161425             0
4056 161438             0
4057 161439             0
4058 161461             0
4059 161467             0
4060 161479             0
4061 161489             0
4062 161496             0
4063 161498             0
4064 161499             0
4065 161502             0
4066 161526             0
4067 161529             0
4068 161537             0
4069 161542             0
4070 161549             0
4071 161552             0
4072 161554             1
4073 161583             0
4074 161607             0
4075 161609             0
4076 161626             0
4077 161628             0
4078 161640             0
4079 161641             0
4080 161642             0
4081 161643             0
4082 161645             0
4083 161659             0
4084 161662             0
4085 162871             0
4086 161669             0
4087 161673             0
4088 161682             1
4089 161700             1
4090 161724             0
4091 161727             0
4092 161777             0
4093 161783             0
4094 161829             0
4095 161831             0
4096 161833             0
4097 161859             1
4098 161862             0
4099 161884             0
4100 161898             0
4101 161909             0
4102 161914             0
4103 161925             0
4104 161934             0
4105 161942             0
4106 161954             1
4107 161962             0
4108 161973             1
4109 161982             0
4110 161996             0
4111 162000             0
4112 162014             0
4113 162127             0
4114 162016             0
4115 162022             0
4116 162057             0
4117 162061             0
4118 162066             0
4119 162075             0
4120 162078             0
4121 162080             0
4122 162103             0
4123 162105             0
4124 162113             0
4125 162159             0
4126 162181             0
4127 162195             0
4128 162197             0
4129 162206             0
4130 162219             0
4131 162231             0
4132 162246             0
4133 162250             0
4134 162260             0
4135 162267             0
4136 162754             0
4137 162281             0
4138 162283             0
4139 162287             0
4140 162295             0
4141 162300             0
4142 162308             0
4143 162331             0
4144 162338             0
4145 162354             0
4146 162356             0
4147 162358             0
4148 162395             0
4149 162409             0
4150 162420             0
4151 162450             0
4152 162472             0
4153 162480             0
4154 162501             0
4155 162504             0
4156 162514             0
4157 162518             0
4158 162562             0
4159 162569             0
4160 162587             1
4161 162588             0
4162 162593             0
4163 162594             0
4164 162655             0
4165 162663             0
4166 162686             0
4167 162700             0
4168 162710             0
4169 162737             0
4170 162743             1
4171 162757             0
4172 162766             0
4173 162783             0
4174 162784             0
4175 162794             0
4176 162854             0
4177 162862             0
4178 162864             0
4179 162877             0
4180 162882             0</code></pre>
</div>
</div>
</section>
<section id="overvaluation-2" class="level2">
<h2 class="anchored" data-anchor-id="overvaluation-2">Overvaluation</h2>
<p>Overvaluation occurs when the market capitalisation is greater than the equity value of a firm less retained earnings. This means that the optimism of the outlook is not wholly justified by its fundamentals, which is often a common goal of accounting manipulation. A study conducted on 526 overvalued companies that had to restate their earnings to be lower showed a 39% drop in equity value and consistent underperformance after restatement due to adjustments for both overvaluation and loss of confidence (Marciukaityte &amp; Varma, 2008).</p>
<p>In this model, we used overvaluation as dependent variable and debt_to_equity, return_on_equity, profit_margin, current_ratio, inventory_turnover, z_score, restated_later, working_capital, net_income_pctc, cash_flow_pctc, total_debt_pctc, accounts_receivable_days_pctc, market_cap_pctc as independent variables.</p>
<section id="splitting-into-2019-2022-and-2023-data-1" class="level3">
<h3 class="anchored" data-anchor-id="splitting-into-2019-2022-and-2023-data-1">Splitting into 2019-2022 and 2023 data</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb224"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb224-1"><a href="#cb224-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Dataframes</span></span>
<span id="cb224-2"><a href="#cb224-2" aria-hidden="true" tabindex="-1"></a>normal <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"normalCleaned.csv"</span>)</span>
<span id="cb224-3"><a href="#cb224-3" aria-hidden="true" tabindex="-1"></a>percentageChange <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"percentageChangeCleaned.csv"</span>)</span>
<span id="cb224-4"><a href="#cb224-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-5"><a href="#cb224-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Select variables for normal and percentageChange</span></span>
<span id="cb224-6"><a href="#cb224-6" aria-hidden="true" tabindex="-1"></a>normal_selected <span class="ot">&lt;-</span> normal <span class="sc">%&gt;%</span> </span>
<span id="cb224-7"><a href="#cb224-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, debt_to_equity, return_on_equity, profit_margin, </span>
<span id="cb224-8"><a href="#cb224-8" aria-hidden="true" tabindex="-1"></a>         current_ratio, inventory_turnover, z_score, overvaluation, restated_later, working_capital, industry)</span>
<span id="cb224-9"><a href="#cb224-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-10"><a href="#cb224-10" aria-hidden="true" tabindex="-1"></a>percentageChange_selected <span class="ot">&lt;-</span> percentageChange <span class="sc">%&gt;%</span> </span>
<span id="cb224-11"><a href="#cb224-11" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, year_, net_income, cash_flow, total_debt, </span>
<span id="cb224-12"><a href="#cb224-12" aria-hidden="true" tabindex="-1"></a>         accounts_receivable_days, market_cap) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">net_income_pctc =</span> net_income, <span class="at">cash_flow_pctc =</span> cash_flow, <span class="at">total_debt_pctc =</span> total_debt, <span class="at">accounts_receivable_days_pctc =</span> accounts_receivable_days, <span class="at">market_cap_pctc =</span> market_cap)</span>
<span id="cb224-13"><a href="#cb224-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-14"><a href="#cb224-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Merge datasets on code and year_</span></span>
<span id="cb224-15"><a href="#cb224-15" aria-hidden="true" tabindex="-1"></a>healthcare_df <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(normal_selected, percentageChange_selected, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"code"</span>, <span class="st">"year_"</span>))</span>
<span id="cb224-16"><a href="#cb224-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-17"><a href="#cb224-17" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> healthcare_df <span class="sc">%&gt;%</span></span>
<span id="cb224-18"><a href="#cb224-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x) <span class="sc">|</span> <span class="fu">is.infinite</span>(.x), <span class="dv">0</span>, .x)))</span>
<span id="cb224-19"><a href="#cb224-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-20"><a href="#cb224-20" aria-hidden="true" tabindex="-1"></a>weight_to_use <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(df) <span class="sc">-</span> <span class="fu">sum</span>(df<span class="sc">$</span>overvaluation)) <span class="sc">/</span> <span class="fu">sum</span>(df<span class="sc">$</span>overvaluation)</span>
<span id="cb224-21"><a href="#cb224-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-22"><a href="#cb224-22" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>wgt <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>overvaluation <span class="sc">==</span> <span class="dv">1</span>, weight_to_use, <span class="dv">1</span>)</span>
<span id="cb224-23"><a href="#cb224-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-24"><a href="#cb224-24" aria-hidden="true" tabindex="-1"></a>df_to_test <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year_ <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb224-25"><a href="#cb224-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-26"><a href="#cb224-26" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(df, df_to_test)</span>
<span id="cb224-27"><a href="#cb224-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-28"><a href="#cb224-28" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">factor</span>(overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb224-29"><a href="#cb224-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-30"><a href="#cb224-30" aria-hidden="true" tabindex="-1"></a>df_to_test <span class="ot">&lt;-</span> df_to_test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">factor</span>(overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb224-31"><a href="#cb224-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-32"><a href="#cb224-32" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> healthcare_df <span class="sc">%&gt;%</span></span>
<span id="cb224-33"><a href="#cb224-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">everything</span>(), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.x) <span class="sc">|</span> <span class="fu">is.infinite</span>(.x), <span class="dv">0</span>, .x)))</span>
<span id="cb224-34"><a href="#cb224-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-35"><a href="#cb224-35" aria-hidden="true" tabindex="-1"></a>weight_to_use <span class="ot">&lt;-</span> (<span class="fu">nrow</span>(df) <span class="sc">-</span> <span class="fu">sum</span>(df<span class="sc">$</span>overvaluation)) <span class="sc">/</span> <span class="fu">sum</span>(df<span class="sc">$</span>overvaluation)</span>
<span id="cb224-36"><a href="#cb224-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-37"><a href="#cb224-37" aria-hidden="true" tabindex="-1"></a>df<span class="sc">$</span>wgt <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(df<span class="sc">$</span>overvaluation <span class="sc">==</span> <span class="dv">1</span>, weight_to_use, <span class="dv">1</span>)</span>
<span id="cb224-38"><a href="#cb224-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-39"><a href="#cb224-39" aria-hidden="true" tabindex="-1"></a>df_to_test <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">filter</span>(year_ <span class="sc">==</span> <span class="dv">2023</span>)</span>
<span id="cb224-40"><a href="#cb224-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-41"><a href="#cb224-41" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(df, df_to_test)</span>
<span id="cb224-42"><a href="#cb224-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-43"><a href="#cb224-43" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">factor</span>(overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb224-44"><a href="#cb224-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb224-45"><a href="#cb224-45" aria-hidden="true" tabindex="-1"></a>df_to_test <span class="ot">&lt;-</span> df_to_test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">factor</span>(overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="splitting-into-train-and-test-set" class="level3">
<h3 class="anchored" data-anchor-id="splitting-into-train-and-test-set">Splitting into train and test set</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb225"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb225-1"><a href="#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb225-2"><a href="#cb225-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-3"><a href="#cb225-3" aria-hidden="true" tabindex="-1"></a>df_overvaluation <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(df, <span class="sc">-</span>code, <span class="sc">-</span>year_)</span>
<span id="cb225-4"><a href="#cb225-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-5"><a href="#cb225-5" aria-hidden="true" tabindex="-1"></a>train_overvaluation <span class="ot">&lt;-</span> <span class="fu">sample_frac</span>(df_overvaluation, <span class="fl">0.8</span>)</span>
<span id="cb225-6"><a href="#cb225-6" aria-hidden="true" tabindex="-1"></a>test_overvaluation <span class="ot">&lt;-</span> <span class="fu">anti_join</span>(df_overvaluation, train_overvaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="simple-logistic-regression-2" class="level2">
<h2 class="anchored" data-anchor-id="simple-logistic-regression-2">Simple Logistic Regression</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb226"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb226-1"><a href="#cb226-1" aria-hidden="true" tabindex="-1"></a>overvaluation_formula <span class="ot">&lt;-</span> <span class="fu">as.formula</span>(<span class="fu">paste</span>(<span class="st">"overvaluation ~ debt_to_equity + return_on_equity + profit_margin + current_ratio + inventory_turnover + z_score + restated_later + working_capital + net_income_pctc + cash_flow_pctc + total_debt_pctc + accounts_receivable_days_pctc + market_cap_pctc"</span>))</span>
<span id="cb226-2"><a href="#cb226-2" aria-hidden="true" tabindex="-1"></a>log_overvaluation <span class="ot">&lt;-</span> <span class="fu">glm</span>(overvaluation_formula, <span class="at">data =</span> train_overvaluation, <span class="at">family =</span> binomial, <span class="at">weights =</span> train_overvaluation<span class="sc">$</span>wgt)</span>
<span id="cb226-3"><a href="#cb226-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(log_overvaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = overvaluation_formula, family = binomial, data = train_overvaluation, 
    weights = train_overvaluation$wgt)

Coefficients:
                                Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                    1.414e-01  1.528e-02   9.255  &lt; 2e-16 ***
debt_to_equity                -1.506e-05  8.194e-06  -1.838 0.066031 .  
return_on_equity               2.313e-04  3.800e-05   6.087 1.15e-09 ***
profit_margin                  1.183e-08  1.447e-07   0.082 0.934849    
current_ratio                  8.372e-05  2.966e-04   0.282 0.777737    
inventory_turnover             7.295e-06  8.093e-06   0.901 0.367409    
z_score                        2.676e-05  6.428e-06   4.163 3.14e-05 ***
restated_later                -1.619e-01  4.253e-02  -3.806 0.000141 ***
working_capital               -6.908e-12  6.234e-13 -11.080  &lt; 2e-16 ***
net_income_pctc               -4.159e-05  1.752e-04  -0.237 0.812379    
cash_flow_pctc                -1.537e-04  1.807e-04  -0.850 0.395087    
total_debt_pctc                5.930e-06  6.000e-06   0.988 0.323008    
accounts_receivable_days_pctc  2.779e-04  2.129e-04   1.305 0.191781    
market_cap_pctc                2.868e-02  4.901e-03   5.851 4.87e-09 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 30300  on 13598  degrees of freedom
Residual deviance: 29775  on 13585  degrees of freedom
AIC: 31187

Number of Fisher Scoring iterations: 9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb228"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb228-1"><a href="#cb228-1" aria-hidden="true" tabindex="-1"></a>train_overvaluation_simple <span class="ot">&lt;-</span> train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">factor</span>(overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb228-2"><a href="#cb228-2" aria-hidden="true" tabindex="-1"></a>test_overvaluation_simple <span class="ot">&lt;-</span> test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">factor</span>(overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb228-3"><a href="#cb228-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-4"><a href="#cb228-4" aria-hidden="true" tabindex="-1"></a>train_overvaluation_simple<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(log_overvaluation, train_overvaluation_simple,</span>
<span id="cb228-5"><a href="#cb228-5" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">type =</span> <span class="st">'response'</span>))</span>
<span id="cb228-6"><a href="#cb228-6" aria-hidden="true" tabindex="-1"></a>test_overvaluation_simple<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(log_overvaluation, test_overvaluation_simple,</span>
<span id="cb228-7"><a href="#cb228-7" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">type =</span> <span class="st">'response'</span>))</span>
<span id="cb228-8"><a href="#cb228-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-9"><a href="#cb228-9" aria-hidden="true" tabindex="-1"></a>auc_in_simple_overvaluation <span class="ot">&lt;-</span> train_overvaluation_simple <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred, <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb228-10"><a href="#cb228-10" aria-hidden="true" tabindex="-1"></a>auc_out_simple_overvaluation <span class="ot">&lt;-</span> test_overvaluation_simple <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred, <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb228-11"><a href="#cb228-11" aria-hidden="true" tabindex="-1"></a>curve_in_simple_overvaluation <span class="ot">&lt;-</span> train_overvaluation_simple <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred, <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb228-12"><a href="#cb228-12" aria-hidden="true" tabindex="-1"></a>curve_out_simple_overvaluation <span class="ot">&lt;-</span> test_overvaluation_simple <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred, <span class="at">event_level =</span> <span class="st">'second'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="lasso-2" class="level3">
<h3 class="anchored" data-anchor-id="lasso-2">LASSO</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb229"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb229-1"><a href="#cb229-1" aria-hidden="true" tabindex="-1"></a>x_overvaluation <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(overvaluation_formula, <span class="at">data =</span> train_overvaluation)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb229-2"><a href="#cb229-2" aria-hidden="true" tabindex="-1"></a>y_overvaluation <span class="ot">&lt;-</span> <span class="fu">model.frame</span>(overvaluation_formula, <span class="at">data =</span> train_overvaluation)[, <span class="st">'overvaluation'</span>]</span>
<span id="cb229-3"><a href="#cb229-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-4"><a href="#cb229-4" aria-hidden="true" tabindex="-1"></a>fit_LASSO_overvaluation <span class="ot">&lt;-</span> <span class="fu">glmnet</span>(<span class="at">x =</span> x_overvaluation, <span class="at">y =</span> y_overvaluation,</span>
<span id="cb229-5"><a href="#cb229-5" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb229-6"><a href="#cb229-6" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb229-7"><a href="#cb229-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">weights =</span> train_overvaluation<span class="sc">$</span>wgt)</span>
<span id="cb229-8"><a href="#cb229-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-9"><a href="#cb229-9" aria-hidden="true" tabindex="-1"></a>cvfit_overvaluation <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(<span class="at">x =</span> x_overvaluation, <span class="at">y =</span> y_overvaluation, <span class="at">family =</span> <span class="st">"binomial"</span>, <span class="at">alpha =</span> <span class="dv">1</span>, <span class="at">type.measure =</span> <span class="st">"auc"</span>,</span>
<span id="cb229-10"><a href="#cb229-10" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">weights =</span> train_overvaluation<span class="sc">$</span>wgt)</span>
<span id="cb229-11"><a href="#cb229-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cvfit_overvaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-68-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb230"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb230-1"><a href="#cb230-1" aria-hidden="true" tabindex="-1"></a>xp_train_overvaluation <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(overvaluation_formula, <span class="at">data =</span> train_overvaluation,</span>
<span id="cb230-2"><a href="#cb230-2" aria-hidden="true" tabindex="-1"></a>                                       <span class="at">na.action =</span> <span class="st">'na.pass'</span>)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb230-3"><a href="#cb230-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-4"><a href="#cb230-4" aria-hidden="true" tabindex="-1"></a>xp_test_overvaluation <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(overvaluation_formula, <span class="at">data =</span> test_overvaluation,</span>
<span id="cb230-5"><a href="#cb230-5" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">na.action =</span> <span class="st">'na.pass'</span>)[,<span class="sc">-</span><span class="dv">1</span>]</span>
<span id="cb230-6"><a href="#cb230-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-7"><a href="#cb230-7" aria-hidden="true" tabindex="-1"></a>train_overvaluation<span class="sc">$</span>pred_L1.min <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation, xp_train_overvaluation,</span>
<span id="cb230-8"><a href="#cb230-8" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">s =</span> <span class="st">'lambda.min'</span>))</span>
<span id="cb230-9"><a href="#cb230-9" aria-hidden="true" tabindex="-1"></a>train_overvaluation<span class="sc">$</span>pred_L1<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation, xp_train_overvaluation,</span>
<span id="cb230-10"><a href="#cb230-10" aria-hidden="true" tabindex="-1"></a>                                             <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">s =</span> <span class="st">'lambda.1se'</span>))</span>
<span id="cb230-11"><a href="#cb230-11" aria-hidden="true" tabindex="-1"></a>test_overvaluation<span class="sc">$</span>pred_L1.min <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation, xp_test_overvaluation,</span>
<span id="cb230-12"><a href="#cb230-12" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">s =</span> <span class="st">'lambda.min'</span>))</span>
<span id="cb230-13"><a href="#cb230-13" aria-hidden="true" tabindex="-1"></a>test_overvaluation<span class="sc">$</span>pred_L1<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation, xp_test_overvaluation,</span>
<span id="cb230-14"><a href="#cb230-14" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">type =</span> <span class="st">'response'</span>, <span class="at">s =</span> <span class="st">'lambda.1se'</span>))</span>
<span id="cb230-15"><a href="#cb230-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-16"><a href="#cb230-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-17"><a href="#cb230-17" aria-hidden="true" tabindex="-1"></a>overvaluation_auc_in_lmin <span class="ot">&lt;-</span> train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred_L1.min,</span>
<span id="cb230-18"><a href="#cb230-18" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-19"><a href="#cb230-19" aria-hidden="true" tabindex="-1"></a>overvaluation_auc_in_l1se <span class="ot">&lt;-</span> train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred_L1<span class="fl">.1</span>se,</span>
<span id="cb230-20"><a href="#cb230-20" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-21"><a href="#cb230-21" aria-hidden="true" tabindex="-1"></a>overvaluation_curve_in_CV.min <span class="ot">&lt;-</span> train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred_L1.min,</span>
<span id="cb230-22"><a href="#cb230-22" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-23"><a href="#cb230-23" aria-hidden="true" tabindex="-1"></a>overvaluation_curve_in_CV<span class="fl">.1</span>se <span class="ot">&lt;-</span> train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred_L1<span class="fl">.1</span>se,</span>
<span id="cb230-24"><a href="#cb230-24" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-25"><a href="#cb230-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-26"><a href="#cb230-26" aria-hidden="true" tabindex="-1"></a>overvaluation_auc_out_lmin <span class="ot">&lt;-</span> test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred_L1.min,</span>
<span id="cb230-27"><a href="#cb230-27" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-28"><a href="#cb230-28" aria-hidden="true" tabindex="-1"></a>overvaluation_auc_out_l1se <span class="ot">&lt;-</span> test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred_L1<span class="fl">.1</span>se,</span>
<span id="cb230-29"><a href="#cb230-29" aria-hidden="true" tabindex="-1"></a>                                                             <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-30"><a href="#cb230-30" aria-hidden="true" tabindex="-1"></a>overvaluation_curve_out_CV.min <span class="ot">&lt;-</span> test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred_L1.min,</span>
<span id="cb230-31"><a href="#cb230-31" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-32"><a href="#cb230-32" aria-hidden="true" tabindex="-1"></a>overvaluation_curve_out_CV<span class="fl">.1</span>se <span class="ot">&lt;-</span> test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred_L1<span class="fl">.1</span>se,</span>
<span id="cb230-33"><a href="#cb230-33" aria-hidden="true" tabindex="-1"></a>                                                                   <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb230-34"><a href="#cb230-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-35"><a href="#cb230-35" aria-hidden="true" tabindex="-1"></a>overvaluation_aucs_CV.min <span class="ot">&lt;-</span> <span class="fu">c</span>(overvaluation_auc_in_lmin<span class="sc">$</span>.estimate, overvaluation_auc_out_lmin<span class="sc">$</span>.estimate)</span>
<span id="cb230-36"><a href="#cb230-36" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(overvaluation_aucs_CV.min) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, lambda.min"</span>, <span class="st">"Out of sample, lambda.min"</span>)</span>
<span id="cb230-37"><a href="#cb230-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb230-38"><a href="#cb230-38" aria-hidden="true" tabindex="-1"></a>overvaluation_aucs_CV<span class="fl">.1</span>se <span class="ot">&lt;-</span> <span class="fu">c</span>(overvaluation_auc_in_l1se<span class="sc">$</span>.estimate, overvaluation_auc_out_l1se<span class="sc">$</span>.estimate)</span>
<span id="cb230-39"><a href="#cb230-39" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(overvaluation_aucs_CV<span class="fl">.1</span>se) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"In sample, lambda.1se"</span>, <span class="st">"Out of sample, lambda.1se"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="tidyverse-lasso" class="level3">
<h3 class="anchored" data-anchor-id="tidyverse-lasso">Tidyverse LASSO</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb231"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb231-1"><a href="#cb231-1" aria-hidden="true" tabindex="-1"></a>train_overvaluation_rec <span class="ot">&lt;-</span> train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(overvaluation))) <span class="sc">%&gt;%</span></span>
<span id="cb231-2"><a href="#cb231-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pred_L1.min, <span class="sc">-</span>pred_L1<span class="fl">.1</span>se)</span>
<span id="cb231-3"><a href="#cb231-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-4"><a href="#cb231-4" aria-hidden="true" tabindex="-1"></a>test_overvaluation_rec <span class="ot">&lt;-</span> test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">as.numeric</span>(<span class="fu">as.character</span>(overvaluation))) <span class="sc">%&gt;%</span></span>
<span id="cb231-5"><a href="#cb231-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pred_L1.min, <span class="sc">-</span>pred_L1<span class="fl">.1</span>se)</span>
<span id="cb231-6"><a href="#cb231-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-7"><a href="#cb231-7" aria-hidden="true" tabindex="-1"></a>rec_overvaluation <span class="ot">&lt;-</span> <span class="fu">recipe</span>(overvaluation_formula, <span class="at">data =</span> train_overvaluation_rec) <span class="sc">%&gt;%</span></span>
<span id="cb231-8"><a href="#cb231-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Drop any variables with zero variance</span></span>
<span id="cb231-9"><a href="#cb231-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Center all prediction variables (i.e. avg value = 0)</span></span>
<span id="cb231-10"><a href="#cb231-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Scale all prediction variables (scaled to Z-score)</span></span>
<span id="cb231-11"><a href="#cb231-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_intercept</span>() <span class="sc">%&gt;%</span>  <span class="co"># Add an intercept to the model</span></span>
<span id="cb231-12"><a href="#cb231-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_num2factor</span>(<span class="fu">all_outcomes</span>(), <span class="at">ordered =</span> T, <span class="at">levels=</span><span class="fu">c</span>(<span class="st">"0"</span>,<span class="st">"1"</span>),</span>
<span id="cb231-13"><a href="#cb231-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">transform =</span> <span class="cf">function</span>(x) x <span class="sc">+</span> <span class="dv">1</span>)  <span class="co"># Convert DV to factor for parsnip later</span></span>
<span id="cb231-14"><a href="#cb231-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-15"><a href="#cb231-15" aria-hidden="true" tabindex="-1"></a>prep_overvaluation <span class="ot">&lt;-</span> rec_overvaluation <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training =</span> train_overvaluation_rec)</span>
<span id="cb231-16"><a href="#cb231-16" aria-hidden="true" tabindex="-1"></a>test_prep_overvaluation <span class="ot">&lt;-</span> rec_overvaluation <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training =</span> test_overvaluation_rec)</span>
<span id="cb231-17"><a href="#cb231-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-18"><a href="#cb231-18" aria-hidden="true" tabindex="-1"></a>train_baked_overvaluation <span class="ot">&lt;-</span> <span class="fu">bake</span>(prep_overvaluation, <span class="at">new_data =</span> train_overvaluation_rec)</span>
<span id="cb231-19"><a href="#cb231-19" aria-hidden="true" tabindex="-1"></a>test_baked_overvaluation <span class="ot">&lt;-</span> <span class="fu">bake</span>(prep_overvaluation, <span class="at">new_data =</span> test_overvaluation_rec)</span>
<span id="cb231-20"><a href="#cb231-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-21"><a href="#cb231-21" aria-hidden="true" tabindex="-1"></a>train_model_overvaluation <span class="ot">&lt;-</span> <span class="fu">logistic_reg</span>(<span class="at">mixture =</span> <span class="dv">1</span>, <span class="at">penalty =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb231-22"><a href="#cb231-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_engine</span>(<span class="st">'glmnet'</span>) <span class="sc">%&gt;%</span></span>
<span id="cb231-23"><a href="#cb231-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fit</span>(overvaluation_formula, <span class="at">data =</span> train_baked_overvaluation,</span>
<span id="cb231-24"><a href="#cb231-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">weights =</span> train_overvaluation_rec<span class="sc">$</span>wgt)</span>
<span id="cb231-25"><a href="#cb231-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-26"><a href="#cb231-26" aria-hidden="true" tabindex="-1"></a>train_x_overvaluation <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_overvaluation, <span class="fu">all_predictors</span>(), </span>
<span id="cb231-27"><a href="#cb231-27" aria-hidden="true" tabindex="-1"></a>                               <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb231-28"><a href="#cb231-28" aria-hidden="true" tabindex="-1"></a>train_y_overvaluation <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_overvaluation, <span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb231-29"><a href="#cb231-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">as.numeric</span>(overvaluation) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb231-30"><a href="#cb231-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb231-31"><a href="#cb231-31" aria-hidden="true" tabindex="-1"></a>test_x_overvaluation <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prep_overvaluation, <span class="fu">all_predictors</span>(),</span>
<span id="cb231-32"><a href="#cb231-32" aria-hidden="true" tabindex="-1"></a>                              <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb231-33"><a href="#cb231-33" aria-hidden="true" tabindex="-1"></a>test_y_overvaluation <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prep_overvaluation, <span class="fu">all_outcomes</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb231-34"><a href="#cb231-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">overvaluation =</span> <span class="fu">as.numeric</span>(overvaluation) <span class="sc">-</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb231-35"><a href="#cb231-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb231-36"><a href="#cb231-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb231-37"><a href="#cb231-37" aria-hidden="true" tabindex="-1"></a>cvfit_overvaluation_tidy <span class="ot">&lt;-</span> <span class="fu">cv.glmnet</span>(<span class="at">x =</span> train_x_overvaluation,</span>
<span id="cb231-38"><a href="#cb231-38" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">y =</span> train_y_overvaluation,</span>
<span id="cb231-39"><a href="#cb231-39" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">family =</span> <span class="st">"binomial"</span>,</span>
<span id="cb231-40"><a href="#cb231-40" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">alpha =</span> <span class="dv">1</span>,</span>
<span id="cb231-41"><a href="#cb231-41" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">type.measure =</span> <span class="st">"auc"</span>,</span>
<span id="cb231-42"><a href="#cb231-42" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">weights =</span> train_overvaluation_rec<span class="sc">$</span>wgt)</span>
<span id="cb231-43"><a href="#cb231-43" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(cvfit_overvaluation_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb232"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb232-1"><a href="#cb232-1" aria-hidden="true" tabindex="-1"></a>train.pred_1min2_overvaluation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation_tidy, train_x_overvaluation, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>))</span>
<span id="cb232-2"><a href="#cb232-2" aria-hidden="true" tabindex="-1"></a>test.pred_1min2_overvaluation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation_tidy, test_x_overvaluation, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.min"</span>))</span>
<span id="cb232-3"><a href="#cb232-3" aria-hidden="true" tabindex="-1"></a>train.pred_l1se2_overvaluation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation_tidy, train_x_overvaluation, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.1se"</span>))</span>
<span id="cb232-4"><a href="#cb232-4" aria-hidden="true" tabindex="-1"></a>test.pred_l1se2_overvaluation <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(cvfit_overvaluation_tidy, test_x_overvaluation, <span class="at">type=</span><span class="st">"response"</span>, <span class="at">s =</span> <span class="st">"lambda.1se"</span>))</span>
<span id="cb232-5"><a href="#cb232-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-6"><a href="#cb232-6" aria-hidden="true" tabindex="-1"></a>df_train_overvaluation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">train.pred_1min2 =</span> train.pred_1min2_overvaluation, <span class="at">train.pred_l1se2 =</span> train.pred_l1se2_overvaluation, </span>
<span id="cb232-7"><a href="#cb232-7" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">overvaluation =</span> <span class="fu">factor</span>(train_y_overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb232-8"><a href="#cb232-8" aria-hidden="true" tabindex="-1"></a>df_test_overvaluation <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">test.pred_1min2 =</span> test.pred_1min2_overvaluation, <span class="at">test.pred_l1se2 =</span> test.pred_l1se2_overvaluation, </span>
<span id="cb232-9"><a href="#cb232-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">overvaluation =</span> <span class="fu">factor</span>(test_y_overvaluation, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>)))</span>
<span id="cb232-10"><a href="#cb232-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-11"><a href="#cb232-11" aria-hidden="true" tabindex="-1"></a>auc_in_cv_min2_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, train.pred_1min2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb232-12"><a href="#cb232-12" aria-hidden="true" tabindex="-1"></a>auc_out_cv_min2_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, test.pred_1min2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb232-13"><a href="#cb232-13" aria-hidden="true" tabindex="-1"></a>curve_in_CV.min2_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, train.pred_1min2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb232-14"><a href="#cb232-14" aria-hidden="true" tabindex="-1"></a>curve_out_CV.min2_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, test.pred_1min2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb232-15"><a href="#cb232-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb232-16"><a href="#cb232-16" aria-hidden="true" tabindex="-1"></a>auc_in_cv<span class="fl">.1</span>se2_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, train.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb232-17"><a href="#cb232-17" aria-hidden="true" tabindex="-1"></a>auc_out_cv<span class="fl">.1</span>se2_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, test.pred_l1se2, <span class="at">event_level =</span> <span class="st">'second'</span>)</span>
<span id="cb232-18"><a href="#cb232-18" aria-hidden="true" tabindex="-1"></a>curve_in_CV<span class="fl">.1</span>se2_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, train.pred_l1se2, <span class="at">event_level=</span><span class="st">'second'</span>)</span>
<span id="cb232-19"><a href="#cb232-19" aria-hidden="true" tabindex="-1"></a>curve_out_CV<span class="fl">.1</span>se2_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, test.pred_l1se2, <span class="at">event_level =</span> <span class="st">'second'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="xgboost-3" class="level3">
<h3 class="anchored" data-anchor-id="xgboost-3">XGBoost</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb233"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb233-1"><a href="#cb233-1" aria-hidden="true" tabindex="-1"></a>rec_overvaluation_2 <span class="ot">&lt;-</span> <span class="fu">recipe</span>(overvaluation_formula, <span class="at">data =</span> train_overvaluation_rec) <span class="sc">%&gt;%</span></span>
<span id="cb233-2"><a href="#cb233-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_zv</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Drop any variables with zero variance</span></span>
<span id="cb233-3"><a href="#cb233-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_center</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Center all prediction variables (i.e. avg value = 0)</span></span>
<span id="cb233-4"><a href="#cb233-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_scale</span>(<span class="fu">all_predictors</span>()) <span class="sc">%&gt;%</span>  <span class="co"># Scale all prediction variables (scaled to Z-score)</span></span>
<span id="cb233-5"><a href="#cb233-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">step_intercept</span>()  <span class="co"># Add an intercept to the model</span></span>
<span id="cb233-6"><a href="#cb233-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-7"><a href="#cb233-7" aria-hidden="true" tabindex="-1"></a>prep_overvaluation_2 <span class="ot">&lt;-</span> rec_overvaluation_2 <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training =</span> train_overvaluation_rec)</span>
<span id="cb233-8"><a href="#cb233-8" aria-hidden="true" tabindex="-1"></a>test_prep_overvaluation_2 <span class="ot">&lt;-</span> rec_overvaluation_2 <span class="sc">%&gt;%</span> <span class="fu">prep</span>(<span class="at">training =</span> test_overvaluation_rec)</span>
<span id="cb233-9"><a href="#cb233-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-10"><a href="#cb233-10" aria-hidden="true" tabindex="-1"></a>train_x_overvaluation_2 <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_overvaluation_2, <span class="fu">all_predictors</span>(),</span>
<span id="cb233-11"><a href="#cb233-11" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb233-12"><a href="#cb233-12" aria-hidden="true" tabindex="-1"></a>train_y_overvaluation_2 <span class="ot">&lt;-</span> <span class="fu">juice</span>(prep_overvaluation_2, <span class="fu">all_outcomes</span>(),</span>
<span id="cb233-13"><a href="#cb233-13" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb233-14"><a href="#cb233-14" aria-hidden="true" tabindex="-1"></a>test_x_overvaluation_2 <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prep_overvaluation_2, <span class="fu">all_predictors</span>(),</span>
<span id="cb233-15"><a href="#cb233-15" aria-hidden="true" tabindex="-1"></a>                                <span class="at">composition =</span> <span class="st">"dgCMatrix"</span>)</span>
<span id="cb233-16"><a href="#cb233-16" aria-hidden="true" tabindex="-1"></a>test_y_overvaluation_2 <span class="ot">&lt;-</span> <span class="fu">juice</span>(test_prep_overvaluation_2, <span class="fu">all_outcomes</span>(),</span>
<span id="cb233-17"><a href="#cb233-17" aria-hidden="true" tabindex="-1"></a>                                <span class="at">composition =</span> <span class="st">"matrix"</span>)</span>
<span id="cb233-18"><a href="#cb233-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-19"><a href="#cb233-19" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">max_depth=</span><span class="dv">10</span>,</span>
<span id="cb233-20"><a href="#cb233-20" aria-hidden="true" tabindex="-1"></a>               <span class="at">eta=</span><span class="fl">0.2</span>,</span>
<span id="cb233-21"><a href="#cb233-21" aria-hidden="true" tabindex="-1"></a>               <span class="at">gamma=</span><span class="dv">10</span>,</span>
<span id="cb233-22"><a href="#cb233-22" aria-hidden="true" tabindex="-1"></a>               <span class="at">min_child_weight =</span> <span class="dv">5</span>,</span>
<span id="cb233-23"><a href="#cb233-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">objective =</span></span>
<span id="cb233-24"><a href="#cb233-24" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"binary:logistic"</span>)</span>
<span id="cb233-25"><a href="#cb233-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb233-26"><a href="#cb233-26" aria-hidden="true" tabindex="-1"></a>xgbCV_overvaluation <span class="ot">&lt;-</span> <span class="fu">xgb.cv</span>(<span class="at">params =</span> params,</span>
<span id="cb233-27"><a href="#cb233-27" aria-hidden="true" tabindex="-1"></a>                              <span class="at">data =</span> train_x_overvaluation_2,</span>
<span id="cb233-28"><a href="#cb233-28" aria-hidden="true" tabindex="-1"></a>                              <span class="at">label =</span> train_y_overvaluation_2,</span>
<span id="cb233-29"><a href="#cb233-29" aria-hidden="true" tabindex="-1"></a>                              <span class="at">nrounds =</span> <span class="dv">100</span>,</span>
<span id="cb233-30"><a href="#cb233-30" aria-hidden="true" tabindex="-1"></a>                              <span class="at">eval_metric =</span> <span class="st">"auc"</span>,</span>
<span id="cb233-31"><a href="#cb233-31" aria-hidden="true" tabindex="-1"></a>                              <span class="at">nfold =</span> <span class="dv">10</span>,</span>
<span id="cb233-32"><a href="#cb233-32" aria-hidden="true" tabindex="-1"></a>                              <span class="at">stratified =</span> <span class="cn">TRUE</span>,</span>
<span id="cb233-33"><a href="#cb233-33" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weights =</span> train_overvaluation_rec<span class="sc">$</span>wgt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.893925+0.002810 test-auc:0.864396+0.009620 
[2] train-auc:0.909684+0.003001 test-auc:0.882189+0.008998 
[3] train-auc:0.916175+0.004165 test-auc:0.888102+0.008294 
[4] train-auc:0.921061+0.004202 test-auc:0.892343+0.010022 
[5] train-auc:0.926336+0.003003 test-auc:0.896155+0.010060 
[6] train-auc:0.929042+0.003743 test-auc:0.899138+0.008902 
[7] train-auc:0.932366+0.003429 test-auc:0.902636+0.007949 
[8] train-auc:0.934402+0.002401 test-auc:0.903800+0.009035 
[9] train-auc:0.937188+0.001901 test-auc:0.906021+0.009076 
[10]    train-auc:0.939224+0.001912 test-auc:0.906500+0.009433 
[11]    train-auc:0.941392+0.001606 test-auc:0.908870+0.009065 
[12]    train-auc:0.943211+0.001504 test-auc:0.910077+0.008962 
[13]    train-auc:0.944691+0.001500 test-auc:0.910923+0.008780 
[14]    train-auc:0.945970+0.001504 test-auc:0.911757+0.008106 
[15]    train-auc:0.947100+0.001596 test-auc:0.913142+0.007939 
[16]    train-auc:0.947808+0.001614 test-auc:0.913583+0.007893 
[17]    train-auc:0.948639+0.001256 test-auc:0.914245+0.007984 
[18]    train-auc:0.949468+0.001176 test-auc:0.914688+0.007914 
[19]    train-auc:0.950142+0.000965 test-auc:0.914919+0.007982 
[20]    train-auc:0.951170+0.001099 test-auc:0.915470+0.007780 
[21]    train-auc:0.952004+0.001150 test-auc:0.916221+0.007615 
[22]    train-auc:0.952657+0.001077 test-auc:0.916488+0.007763 
[23]    train-auc:0.953373+0.001142 test-auc:0.916678+0.007791 
[24]    train-auc:0.953947+0.001389 test-auc:0.916956+0.007798 
[25]    train-auc:0.954571+0.001411 test-auc:0.917072+0.007664 
[26]    train-auc:0.955033+0.001436 test-auc:0.917381+0.007867 
[27]    train-auc:0.955441+0.001520 test-auc:0.917580+0.007831 
[28]    train-auc:0.955647+0.001493 test-auc:0.917602+0.007814 
[29]    train-auc:0.955960+0.001587 test-auc:0.917555+0.007683 
[30]    train-auc:0.956156+0.001668 test-auc:0.917898+0.007849 
[31]    train-auc:0.956219+0.001698 test-auc:0.917914+0.007875 
[32]    train-auc:0.956265+0.001697 test-auc:0.917915+0.007866 
[33]    train-auc:0.956308+0.001690 test-auc:0.917932+0.007877 
[34]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[35]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[36]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[37]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[38]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[39]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[40]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[41]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[42]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[43]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[44]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[45]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[46]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[47]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[48]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[49]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[50]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[51]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[52]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[53]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[54]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[55]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[56]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[57]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[58]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[59]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[60]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[61]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[62]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[63]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[64]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[65]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[66]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[67]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[68]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[69]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[70]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[71]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[72]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[73]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[74]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[75]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[76]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[77]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[78]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[79]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[80]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[81]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[82]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[83]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[84]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[85]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[86]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[87]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[88]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[89]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[90]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[91]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[92]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[93]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[94]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[95]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[96]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[97]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[98]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[99]    train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 
[100]   train-auc:0.956367+0.001697 test-auc:0.918017+0.007940 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb235"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb235-1"><a href="#cb235-1" aria-hidden="true" tabindex="-1"></a>numTrees_overvaluation <span class="ot">&lt;-</span> <span class="fu">min</span>(</span>
<span id="cb235-2"><a href="#cb235-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">which</span>(</span>
<span id="cb235-3"><a href="#cb235-3" aria-hidden="true" tabindex="-1"></a>    xgbCV_overvaluation<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean <span class="sc">==</span> </span>
<span id="cb235-4"><a href="#cb235-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">max</span>(xgbCV_overvaluation<span class="sc">$</span>evaluation_log<span class="sc">$</span>test_auc_mean)</span>
<span id="cb235-5"><a href="#cb235-5" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb235-6"><a href="#cb235-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb235-7"><a href="#cb235-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb235-8"><a href="#cb235-8" aria-hidden="true" tabindex="-1"></a>fit_optxgb_overvaluation <span class="ot">&lt;-</span> <span class="fu">xgboost</span>(<span class="at">params=</span>params,</span>
<span id="cb235-9"><a href="#cb235-9" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">data =</span> train_x_overvaluation_2,</span>
<span id="cb235-10"><a href="#cb235-10" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">label =</span> train_y_overvaluation_2,</span>
<span id="cb235-11"><a href="#cb235-11" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">nrounds =</span> numTrees_overvaluation, <span class="co"># re-run model at this optimal level</span></span>
<span id="cb235-12"><a href="#cb235-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">eval_metric=</span><span class="st">"auc"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] train-auc:0.897780 
[2] train-auc:0.908918 
[3] train-auc:0.918879 
[4] train-auc:0.924422 
[5] train-auc:0.928513 
[6] train-auc:0.934205 
[7] train-auc:0.934424 
[8] train-auc:0.938086 
[9] train-auc:0.939276 
[10]    train-auc:0.941082 
[11]    train-auc:0.942857 
[12]    train-auc:0.944763 
[13]    train-auc:0.945979 
[14]    train-auc:0.947292 
[15]    train-auc:0.948976 
[16]    train-auc:0.949765 
[17]    train-auc:0.950818 
[18]    train-auc:0.951242 
[19]    train-auc:0.951443 
[20]    train-auc:0.952050 
[21]    train-auc:0.952184 
[22]    train-auc:0.952904 
[23]    train-auc:0.954105 
[24]    train-auc:0.955123 
[25]    train-auc:0.955943 
[26]    train-auc:0.956043 
[27]    train-auc:0.956849 
[28]    train-auc:0.956849 
[29]    train-auc:0.956849 
[30]    train-auc:0.956849 
[31]    train-auc:0.956849 
[32]    train-auc:0.956849 
[33]    train-auc:0.956849 
[34]    train-auc:0.956849 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb237"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb237-1"><a href="#cb237-1" aria-hidden="true" tabindex="-1"></a>xgb.train.data_overvaluation <span class="ot">&lt;-</span> <span class="fu">xgb.DMatrix</span>(train_x_overvaluation_2, </span>
<span id="cb237-2"><a href="#cb237-2" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">label =</span> train_y_overvaluation_2, </span>
<span id="cb237-3"><a href="#cb237-3" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">missing =</span> <span class="cn">NA</span>)</span>
<span id="cb237-4"><a href="#cb237-4" aria-hidden="true" tabindex="-1"></a>col_names_overvaluation <span class="ot">=</span> <span class="fu">attr</span>(xgb.train.data_overvaluation, <span class="st">".Dimnames"</span>)[[<span class="dv">2</span>]]</span>
<span id="cb237-5"><a href="#cb237-5" aria-hidden="true" tabindex="-1"></a>imp_overvaluation <span class="ot">=</span> <span class="fu">xgb.importance</span>(col_names_overvaluation, fit_optxgb_overvaluation)</span>
<span id="cb237-6"><a href="#cb237-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-7"><a href="#cb237-7" aria-hidden="true" tabindex="-1"></a><span class="fu">xgb.plot.importance</span>(imp_overvaluation)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-70-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb238"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb238-1"><a href="#cb238-1" aria-hidden="true" tabindex="-1"></a>pred.xgb_overvaluation_test <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb_overvaluation, test_x_overvaluation_2, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb238-2"><a href="#cb238-2" aria-hidden="true" tabindex="-1"></a>df_test_overvaluation_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb =</span> pred.xgb_overvaluation_test, <span class="at">overvaluation =</span> <span class="fu">factor</span>(test_y_overvaluation_2, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb238-3"><a href="#cb238-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-4"><a href="#cb238-4" aria-hidden="true" tabindex="-1"></a>pred.xgb_overvaluation_train <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">predict</span>(fit_optxgb_overvaluation, train_x_overvaluation_2, <span class="at">type =</span> <span class="st">"response"</span>))</span>
<span id="cb238-5"><a href="#cb238-5" aria-hidden="true" tabindex="-1"></a>df_train_overvaluation_2 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">pred.xgb =</span> pred.xgb_overvaluation_train, <span class="at">overvaluation =</span> <span class="fu">factor</span>(train_y_overvaluation_2, <span class="at">levels =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb238-6"><a href="#cb238-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb238-7"><a href="#cb238-7" aria-hidden="true" tabindex="-1"></a>auc_in_xgb_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation_2 <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred.xgb, <span class="at">event_level =</span> <span class="st">"second"</span>)</span>
<span id="cb238-8"><a href="#cb238-8" aria-hidden="true" tabindex="-1"></a>auc_out_xgb_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation_2 <span class="sc">%&gt;%</span> <span class="fu">roc_auc</span>(overvaluation, pred.xgb, <span class="at">event_level =</span> <span class="st">"second"</span>)</span>
<span id="cb238-9"><a href="#cb238-9" aria-hidden="true" tabindex="-1"></a>curve_in_xgb_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation_2 <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred.xgb, <span class="at">event_level =</span> <span class="st">"second"</span>)</span>
<span id="cb238-10"><a href="#cb238-10" aria-hidden="true" tabindex="-1"></a>curve_out_xgb_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation_2 <span class="sc">%&gt;%</span> <span class="fu">roc_curve</span>(overvaluation, pred.xgb, <span class="at">event_level =</span> <span class="st">"second"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparison-of-the-models" class="level3">
<h3 class="anchored" data-anchor-id="comparison-of-the-models">Comparison of the Models</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb239"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb239-1"><a href="#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb239-2"><a href="#cb239-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> overvaluation_curve_out_CV.min, <span class="fu">aes</span>(<span class="at">y =</span> sensitivity, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span>specificity, <span class="at">color =</span> <span class="st">"LASSO, lambda.min"</span>)) <span class="sc">+</span></span>
<span id="cb239-3"><a href="#cb239-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> overvaluation_curve_out_CV<span class="fl">.1</span>se, <span class="fu">aes</span>(<span class="at">y =</span> sensitivity, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span>specificity, <span class="at">color =</span> <span class="st">"LASSO, lambda.1se"</span>)) <span class="sc">+</span></span>
<span id="cb239-4"><a href="#cb239-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> curve_out_CV.min2_overvaluation, <span class="fu">aes</span>(<span class="at">y =</span> sensitivity, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span>specificity, <span class="at">color =</span> <span class="st">"Tidy LASSO, lambda.min"</span>)) <span class="sc">+</span> </span>
<span id="cb239-5"><a href="#cb239-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> curve_out_CV<span class="fl">.1</span>se2_overvaluation, <span class="fu">aes</span>(<span class="at">y =</span> sensitivity, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span>specificity, <span class="at">color =</span> <span class="st">"Tidy LASSO, lambda.1se"</span>)) <span class="sc">+</span></span>
<span id="cb239-6"><a href="#cb239-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> curve_out_xgb_overvaluation, <span class="fu">aes</span>(<span class="at">y =</span> sensitivity, <span class="at">x =</span> <span class="dv">1</span> <span class="sc">-</span>specificity, <span class="at">color =</span> <span class="st">"XGBoost"</span>)) <span class="sc">+</span></span>
<span id="cb239-7"><a href="#cb239-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">data =</span> curve_out_simple_overvaluation, <span class="fu">aes</span>(<span class="at">y =</span> sensitivity, <span class="at">x =</span> <span class="dv">1</span><span class="sc">-</span>specificity, <span class="at">color =</span> <span class="st">"Simple Logistic"</span>)) <span class="sc">+</span></span>
<span id="cb239-8"><a href="#cb239-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="ACCT420---Group-2_files/figure-html/unnamed-chunk-71-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb240"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb240-1"><a href="#cb240-1" aria-hidden="true" tabindex="-1"></a>aucs_overvaluation <span class="ot">&lt;-</span> <span class="fu">c</span>(auc_out_xgb_overvaluation<span class="sc">$</span>.estimate, auc_out_cv<span class="fl">.1</span>se2_overvaluation<span class="sc">$</span>.estimate, auc_out_cv_min2_overvaluation<span class="sc">$</span>.estimate,</span>
<span id="cb240-2"><a href="#cb240-2" aria-hidden="true" tabindex="-1"></a>                        overvaluation_auc_out_l1se<span class="sc">$</span>.estimate, overvaluation_auc_out_lmin<span class="sc">$</span>.estimate, auc_out_simple_overvaluation<span class="sc">$</span>.estimate)</span>
<span id="cb240-3"><a href="#cb240-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(aucs_overvaluation) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"Out of Sample, XGBoost"</span>, <span class="st">"Out of Sample, Tidy LASSO 1se"</span>, <span class="st">"Out of Sample, Tidy LASSO min"</span>,</span>
<span id="cb240-4"><a href="#cb240-4" aria-hidden="true" tabindex="-1"></a>                               <span class="st">"Out of Sample, LASSO 1se"</span>, <span class="st">"Out of Sample, LASSO min"</span>, <span class="st">"Out of Sample, Simple"</span>)</span>
<span id="cb240-5"><a href="#cb240-5" aria-hidden="true" tabindex="-1"></a>aucs_overvaluation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       Out of Sample, XGBoost Out of Sample, Tidy LASSO 1se 
                    0.6408052                     0.6695274 
Out of Sample, Tidy LASSO min      Out of Sample, LASSO 1se 
                    0.6723941                     0.6453059 
     Out of Sample, LASSO min         Out of Sample, Simple 
                    0.6550704                     0.6555515 </code></pre>
</div>
</div>
<p>The two models with the best area-under-curve are Tidy LASSO min and Tidy LASSO</p>
</section>
<section id="confusion-matrix-6" class="level3">
<h3 class="anchored" data-anchor-id="confusion-matrix-6">Confusion Matrix</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb242"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb242-1"><a href="#cb242-1" aria-hidden="true" tabindex="-1"></a>df_train_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation <span class="sc">%&gt;%</span> </span>
<span id="cb242-2"><a href="#cb242-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_min =</span> <span class="fu">ifelse</span>(train.pred_1min2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb242-3"><a href="#cb242-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_min =</span> <span class="fu">factor</span>(predictions_min, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb242-4"><a href="#cb242-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-5"><a href="#cb242-5" aria-hidden="true" tabindex="-1"></a>df_train_overvaluation <span class="ot">&lt;-</span> df_train_overvaluation <span class="sc">%&gt;%</span> </span>
<span id="cb242-6"><a href="#cb242-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_l1se =</span> <span class="fu">ifelse</span>(train.pred_l1se2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb242-7"><a href="#cb242-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_l1se =</span> <span class="fu">factor</span>(predictions_l1se, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb242-8"><a href="#cb242-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-9"><a href="#cb242-9" aria-hidden="true" tabindex="-1"></a>df_test_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation <span class="sc">%&gt;%</span></span>
<span id="cb242-10"><a href="#cb242-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_min =</span> <span class="fu">ifelse</span>(test.pred_1min2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb242-11"><a href="#cb242-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_min =</span> <span class="fu">factor</span>(predictions_min, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb242-12"><a href="#cb242-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-13"><a href="#cb242-13" aria-hidden="true" tabindex="-1"></a>df_test_overvaluation <span class="ot">&lt;-</span> df_test_overvaluation <span class="sc">%&gt;%</span> </span>
<span id="cb242-14"><a href="#cb242-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_l1se =</span> <span class="fu">ifelse</span>(test.pred_l1se2 <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb242-15"><a href="#cb242-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">predictions_l1se =</span> <span class="fu">factor</span>(predictions_l1se, <span class="at">level =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>)))</span>
<span id="cb242-16"><a href="#cb242-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-17"><a href="#cb242-17" aria-hidden="true" tabindex="-1"></a>confmat_test_min <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(df_test_overvaluation<span class="sc">$</span>predictions_min,</span>
<span id="cb242-18"><a href="#cb242-18" aria-hidden="true" tabindex="-1"></a>                                    df_test_overvaluation<span class="sc">$</span>overvaluation,</span>
<span id="cb242-19"><a href="#cb242-19" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">positive =</span> <span class="st">'1'</span>)</span>
<span id="cb242-20"><a href="#cb242-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb242-21"><a href="#cb242-21" aria-hidden="true" tabindex="-1"></a>confmat_test_1se <span class="ot">&lt;-</span> <span class="fu">confusionMatrix</span>(df_test_overvaluation<span class="sc">$</span>predictions_l1se,</span>
<span id="cb242-22"><a href="#cb242-22" aria-hidden="true" tabindex="-1"></a>                                    df_test_overvaluation<span class="sc">$</span>overvaluation,</span>
<span id="cb242-23"><a href="#cb242-23" aria-hidden="true" tabindex="-1"></a>                                    <span class="at">positive =</span> <span class="st">'1'</span>)</span>
<span id="cb242-24"><a href="#cb242-24" aria-hidden="true" tabindex="-1"></a>confmat_test_min</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1624  269
         1 1041  447
                                         
               Accuracy : 0.6125         
                 95% CI : (0.5959, 0.629)
    No Information Rate : 0.7882         
    P-Value [Acc &gt; NIR] : 1              
                                         
                  Kappa : 0.1676         
                                         
 Mcnemar's Test P-Value : &lt;2e-16         
                                         
            Sensitivity : 0.6243         
            Specificity : 0.6094         
         Pos Pred Value : 0.3004         
         Neg Pred Value : 0.8579         
             Prevalence : 0.2118         
         Detection Rate : 0.1322         
   Detection Prevalence : 0.4401         
      Balanced Accuracy : 0.6168         
                                         
       'Positive' Class : 1              
                                         </code></pre>
</div>
<div class="sourceCode cell-code" id="cb244"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb244-1"><a href="#cb244-1" aria-hidden="true" tabindex="-1"></a>confmat_test_1se</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Confusion Matrix and Statistics

          Reference
Prediction    0    1
         0 1213  159
         1 1452  557
                                          
               Accuracy : 0.5235          
                 95% CI : (0.5065, 0.5405)
    No Information Rate : 0.7882          
    P-Value [Acc &gt; NIR] : 1               
                                          
                  Kappa : 0.1404          
                                          
 Mcnemar's Test P-Value : &lt;2e-16          
                                          
            Sensitivity : 0.7779          
            Specificity : 0.4552          
         Pos Pred Value : 0.2773          
         Neg Pred Value : 0.8841          
             Prevalence : 0.2118          
         Detection Rate : 0.1647          
   Detection Prevalence : 0.5942          
      Balanced Accuracy : 0.6165          
                                          
       'Positive' Class : 1               
                                          </code></pre>
</div>
</div>
<p>Tidy LASSO 1se displays a higher sensitivity, which we selected as we prioritised identifying true positives, and the false positives identified by this model could be filtered out by the other dependent variables.</p>
<p>This LASSO model identified the following notable variables with a high correlation with oevrvaluation risk:</p>
<p>Market capitalisation % Change (1.9575): An increase in market capitalisation implies that the outlook of a company is more optimistic.</p>
<p>Note: Market cap change is very significant as it ties directly into the equation for overvaluation, which is market capitalisation being greater than equity</p>
<p>Working Capital (-1.4417): A particularly strong negative correlation with overvaluation risk as a higher working capital can signify better liquidity, justifying a higher price. A high working capital can also mean the company is less aggressive, decreasing the gap between optimism and fundamentals.</p>
<p>Return on Equity (0.1458): Investors may be more optimstic about companies with higher return on equity as it displays a company’s ability to generate profit from shareholder equity.</p>
</section>
</section>
<section id="predicting-companies-with-overvaluation" class="level2">
<h2 class="anchored" data-anchor-id="predicting-companies-with-overvaluation">Predicting companies with overvaluation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb246"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb246-1"><a href="#cb246-1" aria-hidden="true" tabindex="-1"></a>lasso_coefs <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb246-2"><a href="#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"(Intercept)"</span> <span class="ot">=</span> <span class="fl">0.0186576830</span>,</span>
<span id="cb246-3"><a href="#cb246-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"debt_to_equity"</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.0259492150</span>,</span>
<span id="cb246-4"><a href="#cb246-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"return_on_equity"</span> <span class="ot">=</span> <span class="fl">0.1458464157</span>,</span>
<span id="cb246-5"><a href="#cb246-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"profit_margin"</span> <span class="ot">=</span> <span class="fl">0.0005831538</span>,</span>
<span id="cb246-6"><a href="#cb246-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"current_ratio"</span> <span class="ot">=</span> <span class="fl">0.0044381229</span>,</span>
<span id="cb246-7"><a href="#cb246-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"inventory_turnover"</span> <span class="ot">=</span> <span class="fl">0.0141108078</span>,</span>
<span id="cb246-8"><a href="#cb246-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"z_score"</span> <span class="ot">=</span> <span class="fl">0.1303028750</span>,</span>
<span id="cb246-9"><a href="#cb246-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"restated_later"</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.0518944179</span>,</span>
<span id="cb246-10"><a href="#cb246-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"working_capital"</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">1.4417671928</span>,</span>
<span id="cb246-11"><a href="#cb246-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"net_income_pctc"</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.0035766419</span>,</span>
<span id="cb246-12"><a href="#cb246-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"cash_flow_pctc"</span> <span class="ot">=</span> <span class="sc">-</span><span class="fl">0.0331688013</span>,</span>
<span id="cb246-13"><a href="#cb246-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"total_debt_pctc"</span> <span class="ot">=</span> <span class="fl">0.0305909665</span>,</span>
<span id="cb246-14"><a href="#cb246-14" aria-hidden="true" tabindex="-1"></a>  <span class="st">"accounts_receivable_days_pctc"</span> <span class="ot">=</span> <span class="fl">0.0657267772</span>,</span>
<span id="cb246-15"><a href="#cb246-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"market_cap_pctc"</span> <span class="ot">=</span> <span class="fl">1.9575968849</span></span>
<span id="cb246-16"><a href="#cb246-16" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb246-17"><a href="#cb246-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-18"><a href="#cb246-18" aria-hidden="true" tabindex="-1"></a>predict_lasso_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(df, lasso_coefs, <span class="at">output_col =</span> <span class="st">"lasso_prob"</span>) {</span>
<span id="cb246-19"><a href="#cb246-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get variable names used in the model (excluding intercept)</span></span>
<span id="cb246-20"><a href="#cb246-20" aria-hidden="true" tabindex="-1"></a>  vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(lasso_coefs), <span class="st">"(Intercept)"</span>)</span>
<span id="cb246-21"><a href="#cb246-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb246-22"><a href="#cb246-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Check for missing variables</span></span>
<span id="cb246-23"><a href="#cb246-23" aria-hidden="true" tabindex="-1"></a>  missing_vars <span class="ot">&lt;-</span> <span class="fu">setdiff</span>(vars, <span class="fu">names</span>(df))</span>
<span id="cb246-24"><a href="#cb246-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(missing_vars) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb246-25"><a href="#cb246-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="fu">paste</span>(<span class="st">"Missing variables in df:"</span>, <span class="fu">paste</span>(missing_vars, <span class="at">collapse =</span> <span class="st">", "</span>)))</span>
<span id="cb246-26"><a href="#cb246-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb246-27"><a href="#cb246-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb246-28"><a href="#cb246-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate log-odds (excluding intercept)</span></span>
<span id="cb246-29"><a href="#cb246-29" aria-hidden="true" tabindex="-1"></a>  log_odds <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">as.matrix</span>(df[, vars, <span class="at">drop =</span> <span class="cn">FALSE</span>]) <span class="sc">%*%</span> lasso_coefs[vars])</span>
<span id="cb246-30"><a href="#cb246-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb246-31"><a href="#cb246-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add intercept manually</span></span>
<span id="cb246-32"><a href="#cb246-32" aria-hidden="true" tabindex="-1"></a>  log_odds <span class="ot">&lt;-</span> log_odds <span class="sc">+</span> lasso_coefs[<span class="st">"(Intercept)"</span>]</span>
<span id="cb246-33"><a href="#cb246-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb246-34"><a href="#cb246-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert log-odds to probabilities</span></span>
<span id="cb246-35"><a href="#cb246-35" aria-hidden="true" tabindex="-1"></a>  prob <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="sc">/</span> (<span class="dv">1</span> <span class="sc">+</span> <span class="fu">exp</span>(<span class="sc">-</span>log_odds))</span>
<span id="cb246-36"><a href="#cb246-36" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb246-37"><a href="#cb246-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add probabilities as new column in df</span></span>
<span id="cb246-38"><a href="#cb246-38" aria-hidden="true" tabindex="-1"></a>  df[[output_col]] <span class="ot">&lt;-</span> prob</span>
<span id="cb246-39"><a href="#cb246-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(df)</span>
<span id="cb246-40"><a href="#cb246-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb246-41"><a href="#cb246-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-42"><a href="#cb246-42" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use it on your data frame</span></span>
<span id="cb246-43"><a href="#cb246-43" aria-hidden="true" tabindex="-1"></a>df_to_test <span class="ot">&lt;-</span> <span class="fu">predict_lasso_prob</span>(df_to_test, lasso_coefs)</span>
<span id="cb246-44"><a href="#cb246-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-45"><a href="#cb246-45" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Amend df with the new classifications</span></span>
<span id="cb246-46"><a href="#cb246-46" aria-hidden="true" tabindex="-1"></a>df_to_test <span class="ot">&lt;-</span> df_to_test <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">overvaluation_prediction =</span> <span class="fu">ifelse</span>(lasso_prob <span class="sc">&gt;</span> <span class="fl">0.5</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb246-47"><a href="#cb246-47" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>lasso_prob)</span>
<span id="cb246-48"><a href="#cb246-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-49"><a href="#cb246-49" aria-hidden="true" tabindex="-1"></a><span class="co"># 5. Collect companies predicted to have overvaluation</span></span>
<span id="cb246-50"><a href="#cb246-50" aria-hidden="true" tabindex="-1"></a>predicted_positive_overvaluation <span class="ot">&lt;-</span> df_to_test <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code, overvaluation_prediction) <span class="sc">%&gt;%</span> <span class="fu">rename</span>(<span class="at">pred_overvaluation=</span>overvaluation_prediction)</span>
<span id="cb246-51"><a href="#cb246-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb246-52"><a href="#cb246-52" aria-hidden="true" tabindex="-1"></a>predicted_positive_overvaluation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,180 × 2
    code pred_overvaluation
   &lt;dbl&gt;              &lt;dbl&gt;
 1   677                  0
 2   801                  0
 3   823                  0
 4   824                  0
 5   985                  0
 6  1045                  0
 7  1069                  0
 8  1105                  0
 9  1148                  0
10  1174                  0
# ℹ 4,170 more rows</code></pre>
</div>
</div>
</section>
<section id="results-and-findings" class="level2">
<h2 class="anchored" data-anchor-id="results-and-findings">Results and Findings</h2>
<section id="finding-the-companies-that-tick-all-four-boxes" class="level3">
<h3 class="anchored" data-anchor-id="finding-the-companies-that-tick-all-four-boxes">Finding the companies that tick all four boxes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb248"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb248-1"><a href="#cb248-1" aria-hidden="true" tabindex="-1"></a>combined_predictions <span class="ot">&lt;-</span> predicted_positive_cr <span class="sc">%&gt;%</span></span>
<span id="cb248-2"><a href="#cb248-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(code, pred_cr) <span class="sc">%&gt;%</span></span>
<span id="cb248-3"><a href="#cb248-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb248-4"><a href="#cb248-4" aria-hidden="true" tabindex="-1"></a>    predicted_positive_dte <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code, pred_dte),</span>
<span id="cb248-5"><a href="#cb248-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"code"</span></span>
<span id="cb248-6"><a href="#cb248-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb248-7"><a href="#cb248-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb248-8"><a href="#cb248-8" aria-hidden="true" tabindex="-1"></a>    predicted_positive_restatement <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code, pred_restated),</span>
<span id="cb248-9"><a href="#cb248-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"code"</span></span>
<span id="cb248-10"><a href="#cb248-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb248-11"><a href="#cb248-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(</span>
<span id="cb248-12"><a href="#cb248-12" aria-hidden="true" tabindex="-1"></a>    predicted_positive_overvaluation <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code, pred_overvaluation),</span>
<span id="cb248-13"><a href="#cb248-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">by =</span> <span class="st">"code"</span></span>
<span id="cb248-14"><a href="#cb248-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">pred_restated =</span> <span class="fu">ifelse</span>(pred_restated <span class="sc">==</span> <span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">0</span>))</span>
<span id="cb248-15"><a href="#cb248-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-16"><a href="#cb248-16" aria-hidden="true" tabindex="-1"></a>combined_predictions <span class="ot">&lt;-</span> combined_predictions <span class="sc">%&gt;%</span></span>
<span id="cb248-17"><a href="#cb248-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_flags =</span> pred_cr <span class="sc">+</span> pred_dte <span class="sc">+</span> pred_restated <span class="sc">+</span> pred_overvaluation)</span>
<span id="cb248-18"><a href="#cb248-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-19"><a href="#cb248-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Companies that have at least 3 flags</span></span>
<span id="cb248-20"><a href="#cb248-20" aria-hidden="true" tabindex="-1"></a>high_risk_companies <span class="ot">&lt;-</span> combined_predictions <span class="sc">%&gt;%</span></span>
<span id="cb248-21"><a href="#cb248-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(total_flags <span class="sc">==</span> <span class="dv">4</span>)</span>
<span id="cb248-22"><a href="#cb248-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb248-23"><a href="#cb248-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(combined_predictions)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  code pred_cr pred_dte pred_restated pred_overvaluation total_flags
1  677       1        0             0                  0           1
2  801       1        1             0                  0           2
3  823       1        1             1                  0           3
4  824       1        0             0                  0           1
5  985       1        0             1                  0           2
6 1045       1        1             0                  0           2</code></pre>
</div>
<div class="sourceCode cell-code" id="cb250"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb250-1"><a href="#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Total companies:"</span>, <span class="fu">nrow</span>(combined_predictions)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Total companies: 4180"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb252"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb252-1"><a href="#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Companies with 4 flags:"</span>, <span class="fu">nrow</span>(high_risk_companies)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Companies with 4 flags: 211"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb254"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb254-1"><a href="#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="co">#company information</span></span>
<span id="cb254-2"><a href="#cb254-2" aria-hidden="true" tabindex="-1"></a>company_info <span class="ot">&lt;-</span> normal <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code, company_name) <span class="sc">|&gt;</span> <span class="fu">distinct</span>()</span>
<span id="cb254-3"><a href="#cb254-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb254-4"><a href="#cb254-4" aria-hidden="true" tabindex="-1"></a>high_risk <span class="ot">&lt;-</span> high_risk_companies <span class="sc">|&gt;</span> dplyr<span class="sc">::</span><span class="fu">select</span>(code) <span class="sc">|&gt;</span> <span class="fu">left_join</span>(company_info, <span class="at">by=</span><span class="st">'code'</span>)</span>
<span id="cb254-5"><a href="#cb254-5" aria-hidden="true" tabindex="-1"></a>high_risk <span class="co"># Flagged out companies</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      code
1     5457
2     7568
3     8960
4     9532
5    10554
6    11733
7    12031
8    13114
9    16604
10   16943
11   17040
12   17183
13   17221
14   17223
15   17259
16   17482
17   17730
18   25033
19   25941
20   28277
21   30055
22   46134
23   46775
24   47463
25   47882
26   47956
27   48080
28   48315
29   52000
30   52331
31   52365
32   52952
33   53088
34   53089
35   53251
36   53253
37   53265
38   53383
39   53626
40   53691
41   53783
42   65492
43   67219
44   67364
45   67371
46   67541
47   68026
48   68089
49   69237
50   69411
51   69952
52   70142
53   70229
54   71084
55   71819
56   73905
57   99999
58  101586
59  101652
60  103303
61  104266
62  104934
63  105271
64  106963
65  107357
66  107686
67  108260
68  108404
69  108528
70  108581
71  109138
72  109187
73  109206
74  109214
75  109376
76  109744
77  110639
78  111721
79  112461
80  114412
81  114444
82  114548
83  115217
84  115296
85  115756
86  117289
87  118228
88  117666
89  118385
90  119425
91  119905
92  120711
93  120864
94  121294
95  121475
96  121787
97  122100
98  122171
99  122383
100 122562
101 123608
102 123920
103 124122
104 124516
105 124525
106 124594
107 124657
108 125109
109 125845
110 126461
111 126490
112 127256
113 127338
114 128474
115 128519
116 128548
117 128901
118 129519
119 129699
120 129786
121 130137
122 130217
123 130315
124 130553
125 130925
126 130953
127 131548
128 131674
129 131795
130 131895
131 132164
132 132217
133 132469
134 132544
135 132937
136 133097
137 133205
138 133338
139 133776
140 133876
141 134108
142 134222
143 134680
144 134722
145 134903
146 136148
147 136282
148 136622
149 136789
150 137103
151 137242
152 137241
153 137294
154 137318
155 137335
156 137471
157 137582
158 137630
159 137662
160 137742
161 137778
162 137782
163 137809
164 137814
165 137917
166 138336
167 139851
168 140106
169 140699
170 140779
171 141074
172 141266
173 141257
174 141757
175 141996
176 142538
177 142946
178 143059
179 144227
180 145309
181 146459
182 147374
183 147923
184 148314
185 149049
186 149926
187 150670
188 150939
189 152479
190 152752
191 153680
192 154132
193 154394
194 154994
195 155519
196 155720
197 155771
198 155844
199 156112
200 156133
201 156506
202 157402
203 158075
204 158333
205 158713
206 160134
207 161248
208 161554
209 161700
210 161859
211 162587
                                                                     company_name
1                                             NORTH CHINA PHARMACEUTICAL, LIMITED
2                                                     RAMSAY GENERALE DE SANTE SA
3                                                           STADA ARZNEIMITTEL AG
4                                                            MATERNUS-KLINIKEN-AG
5                                                        ATHENS MEDICAL CENTER SA
6                                                 TORRENT PHARMACEUTICALS LIMITED
7                                                                INDOFARMA TBK PT
8                                                                    AMPLIFON SPA
9                                           TAKEDA PHARMACEUTICAL COMPANY LIMITED
10                                                       JEIL PHARMA HOLDINGS INC
11                                                                 SUHEUNG CO LTD
12                                                                     HANDOK INC
13                                                         ILDONG HOLDINGS CO LTD
14                                         IL-YANG PHARMACEUTICAL COMPANY LIMITED
15                                                           GREEN CROSS HOLDINGS
16                                                   DONG-A SOCIO HOLDINGS CO LTD
17                                                             PHARMANIAGA BERHAD
18                                   RAMKHAMHAENG HOSPITAL PUBLIC COMPANY LIMITED
19                                                                        GSK PLC
20                                                                ASTRAZENECA PLC
21                                                                ASTRAZENECA PLC
22                                                       BABYLON PUMP &amp; POWER LTD
23                                                              WOCKHARDT LIMITED
24                                                         KOLMAR HOLDINGS CO LTD
25                                                   VIBHAVADI MEDICAL CENTER PCL
26                         CHIANG MAI RAM MEDICAL BUSINESS PUBLIC COMPANY LIMITED
27                                                          MAHACHAI HOSPITAL PCL
28                            TIANJIN TEDA BIOMEDICAL ENGINEERING COMPANY LIMITED
29                                            ZHEJIANG HISUN PHARMACEUTICAL, LTD.
30                                          CHONGQING TAIJI INDUSTRY GROUP CO LTD
31                                          AVIC INDUSTRY FINANCE HOLDINGS CO LTD
32                                           XIAN QUJIANG CULTURAL TOURISM CO LTD
33                                                SHANGHAI JIAODA ONLLY CO., LTD.
34                                                 FAR EAST SMARTER ENERGY CO LTD
35                                                  HAINAN HAIYAO COMPANY LIMITED
36                                                 ZHEJIANG HUAMEI HOLDING CO LTD
37                                                    BOHAI WATER INDUSTRY CO LTD
38                                                  ANHUI FENGYUAN PHARMACEUTICAL
39                                                  GPRO TITANIUM INDUSTRY CO LTD
40                                                   JINHONG HOLDING GROUP CO LTD
41                                                            ELION ENERGY CO LTD
42                                                              PROBIOTEC LIMITED
43                                                                    WANBURY LTD
44                            BHARAT IMMUNOLOGICALS &amp; BIOLOGICALS CORPORATION LTD
45                                                              IND-SWIFT LIMITED
46                                                        KERALA AYURVEDA LIMITED
47                                             DR. AGARWAL'S EYE HOSPITAL LIMITED
48                                                        SHILPA MEDICARE LIMITED
49                                                      FORTIS HEALTHCARE LIMITED
50                                                        JW HOLDINGS CORPORATION
51                                                                     VITA 34 AG
52                                                                   RHINOMED LTD
53                                 QATARI GERMAN COMPANY FOR MEDICAL DEVICES QPSC
54                                                 GENERAL BIOLOGICAL CORPORATION
55                                                                   MIRACULUM SA
56                                       MYUNGMOON PHARMACEUTICAL COMPANY LIMITED
57                                     NEW JOURNEY HEALTH TECHNOLOGY GROUP CO LTD
58                                                                       NEUCA SA
59                                                       EMC INSTYTUT MEDYCZNY SA
60                                            MA KUANG HEALTHCARE HOLDING LIMITED
61                                         LIFE HEALTHCARE GROUP HOLDINGS LIMITED
62                                                    REYON PHARMACEUTICAL CO LTD
63                                      GUANGDONG TAIANTANG PHARMACEUTICAL CO LTD
64                                                     ASTEC LIFESCIENCES LIMITED
65                                                         NAWALOKA HOSPITALS PLC
66                                                   INTELGENX TECHNOLOGIES CORP.
67                                                        AQUA BIO TECHNOLOGY ASA
68                                                            ALBUS A.D. NOVI SAD
69                                         TIKUN OLAM CANNBIT PHARMACEUTICALS LTD
70                                    CONSULTANT AND INVESTMENT GROUP COMPANY PSC
71                                                          WONIK COMPANY LIMITED
72                                                                BILLIONS CO LTD
73                                                                ALPHANOX CO LTD
74                                                     BIOTOXTECH COMPANY LIMITED
75                                          DAEHWA PHARMACEUTICAL COMPANY LIMITED
76                                                 NEPTUNE WELLNESS SOLUTIONS INC
77                                                                   DIGNITANA AB
78                                                           PT MARTINA BERTO TBK
79                                                 XIANGXUE PHARMACEUTICAL CO LTD
80                                               PT SEJAHTERARAYA ANUGRAHJAYA TBK
81                                                    HYBIO PHARMACEUTICAL CO LTD
82                                       NEIMETH INTERNATIONAL PHARMACEUTICAL PLC
83                                                                   GENIC CO LTD
84  MAUNA KEA TECHNOLOGIES SAMAUNA KEA TEC  HNOLOGIES SAMAUNA KEA TECHNOLOGIES SA
85                                                  ACADIA HEALTHCARE COMPANY INC
86                                                    MEDEXUS PHARMACEUTICALS INC
87                                                     JINHE BIOTECHNOLOGY CO LTD
88                                                    ADOR MULTI PRODUCTS LIMITED
89                                                             IHH HEALTHCARE BHD
90                                                                     ABBVIE INC
91                                            SARANA MEDITAMA METROPOLITAN TBK PT
92                                                                       COTY INC
93                                                            KOLMAR KOREA CO LTD
94                                                                    PREMIER INC
95                                          TAIWAN ADVANCE BIO-PHARMACEUTICAL INC
96                                                             OUE HEALTHCARE LTD
97                               UNIVERSAL HEALTH INTERNATIONAL GROUP HOLDING LTD
98                                                                    IMPLANET SA
99                                                                   AMICOGEN INC
100                                                                  LUZ SAUDE SA
101                                                    SPIRE HEALTHCARE GROUP PLC
102                                                 AMERICAN CANNABIS COMPANY INC
103                                              MEDFIRST HEALTHCARE SERVICES INC
104                                                   ASIRI HOSPITAL HOLDINGS PLC
105                                              GREEN CROSS MEDICAL SCIENCE CORP
106                                                  WALGREENS BOOTS ALLIANCE INC
107                                                         BACTIGUARD HOLDING AB
108                                              ADVANCED CHEMICAL INDUSTRIES LTD
109                                         FUJIAN COSUNTER PHARMACEUTICAL CO LTD
110                                                              PIHLAJALINNA OYJ
111                                                            PURAPHARM CORP LTD
112                                                      INTEGRAL DIAGNOSTICS LTD
113                                                SUSTAINABLE PROJECTS GROUP INC
114                                                                 EC HEALTHCARE
115                                         ZHEJIANG STARRY PHARMACEUTICAL CO LTD
116                                                                    ADDLIFE AB
117                                                               SIMRIS GROUP AB
118                                                               KONTIGO CARE AB
119                                                                  GC CELL CORP
120                                                        RAJTHANEE HOSPITAL PCL
121                                                  RICI HEALTHCARE HOLDINGS LTD
122                                             ALLIANCA SAUDE E PARTICIPACOES SA
123                                                    MELODIOL GLOBAL HEALTH LTD
124                                                          EVEREST ORGANICS LTD
125                                                 IL DONG PHARMACEUTICAL CO LTD
126                                                               ATRYS HEALTH SA
127                                                                PARNAX LAB LTD
128                                                     NOVOLOG PHARM UP 1966 LTD
129                                                                   MED LIFE SA
130                                                  SINSIN PHARMACEUTICAL CO LTD
131                                                                CANN GROUP LTD
132                                                                  MEDICOVER AB
133                                                        C-CARE (MAURITIUS) LTD
134                                                      AUXLY CANNABIS GROUP INC
135                                                JIANGSU NANFANG MEDICAL CO LTD
136                                                                  NESTMEDIC SA
137                                                                  EUROESPES SA
138                                                    JEIL PHARMACEUTICAL CO LTD
139                                                        LASA SUPERGENERICS LTD
140                                                  NATIONAL VISION HOLDINGS INC
141                                         DASHENLIN PHARMACEUTICAL GROUP CO LTD
142                                                 THONBURI HEALTHCARE GROUP PCL
143                                                   LABORATORIOS RICHMOND SACIF
144                                                          LYKO GROUP AB (PUBL)
145                                                      MLP SAGLIK HIZMETLERI AS
146                                          EONE DIAGNOMICS GENOME CENTER CO LTD
147                                                   FUSEN PHARMACEUTICAL CO LTD
148                                                      ICURE PHARMACEUTICAL INC
149                                               CLOUDMD SOFTWARE &amp; SERVICES INC
150                                                     ALTHEA GROUP HOLDINGS LTD
151                                                                 CRONEX CO LTD
152                                                               BIO PROTECH INC
153                                                             JILGYUNGYI CO LTD
154                                                                  MEDINCELL SA
155                                                         ENSOL BIOSCIENCES INC
156                                                               LEEF BRANDS INC
157                                                                  GENCURIX INC
158                                                                PHARMADRUG INC
159                                                      GAROFALO HEALTH CARE SPA
160                                                                 SR BIOTEK INC
161                                                         MEDIZEN HUMANCARE INC
162                                                        INVITES BIOCORE CO LTD
163                                                      UNION KOREA PHARM CO LTD
164                                                           BIO SOLUTION CO LTD
165                                                                   CIGNA GROUP
166                                                           FARMINVESTE SGPS SA
167                                                            SEQUANA MEDICAL NV
168                                                              AYR WELLNESS INC
169                                                                   UNIPHAR PLC
170                                                               TALEA GROUP SPA
171                                                 DELTA ASIA INTERNATIONAL CORP
172                                                                 FRIULCHEM SPA
173                                                   IMRICOR MEDICAL SYSTEMS INC
174                                                 ARTEMIS MEDICARE SERVICES LTD
175                                                           SPEED MEDICAL S.A.E
176                                                           OBSERVE MEDICAL ASA
177                                       PHARBACO CENTRAL PHARMACEUTICAL NO1 JSC
178                                     HONLIV HEALTHCARE MANAGEMENT GROUP CO LTD
179                                                               FEMTOBIOMED INC
180                           RAILY AESTHETIC MEDICINE INTERNATIONAL HOLDINGS LTD
181                                                             MEDESIS PHARMA SA
182                                                          VERANO HOLDINGS CORP
183                                                     BIOINFRA LIFE SCIENCE INC
184                                                            PILULKA LEKARNY AS
185                                                                HK INNO.N CORP
186                                                   REVOLUTION BEAUTY GROUP PLC
187                                                             AB&amp;COMPANY CO LTD
188                                                 CANBRIDGE PHARMACEUTICALS INC
189                                                              BIO ESSENCE CORP
190                                                            MURNI SADAR TBK PT
191                                                                       GSK PLC
192                                                         RICEBRAN TECHNOLOGIES
193                WATANI IRON STEEL COMPANY SJSCWATANI I  RON STEEL COMPANY SJSC
194                                                             INVENTAGE LAB INC
195                                                    THERMOGENESIS HOLDINGS INC
196                                                    NAVANA PHARMACEUTICALS LTD
197                                                                 AIOBIO CO LTD
198                                     BEAUTY FARM MEDICAL &amp; HEALTH INDUSTRY INC
199                                                   OXYGENTA PHARMACEUTICAL LTD
200                                                       GFC LIFE SCIENCE CO LTD
201                                                                    AKDITAL SA
202                                                     ACORDA THERAPEUTICS, INC.
203                                                GUJARAT TERCE LABORATORIES LTD
204                                                                   AVINGER INC
205                                                             T2 BIOSYSTEMS INC
206                                                   CHINA PHARMA HOLDINGS, INC.
207                                                         SCORPIUS HOLDINGS INC
208                                                         NEXTBIOMEDICAL CO LTD
209                                                          NORRIS MEDICINES LTD
210                                                                 ONCONETIX INC
211                                                               MAINZ BIOMED NV</code></pre>
</div>
</div>
<p>Once we had run the four models, out of the 4,865 companies found in the raw data, we obtained the result of 211 companies. In other words, about 1 in 25 companies are flagged up. Our group tried to conduct research for some of these companies and discovered that there are only a few examples of news articles we could use to see any examples of accounting manipulations. We have stated four companies below to highlight some of the cases we identified.</p>
</section>
<section id="north-china-pharmaceutical-company-ltd.-ncpc" class="level3">
<h3 class="anchored" data-anchor-id="north-china-pharmaceutical-company-ltd.-ncpc">North China Pharmaceutical Company Ltd.&nbsp;(NCPC)</h3>
<p>This is a Chinese pharmaceutical enterprise specializing in the production and distribution of medications, with a focus on traditional Chinese medicine. In May 2020, the company was fined 600,000 yuan by the China Securities and Futures Division for financial fraud and an overstatement of incomes (Jabeen &amp; Rani, 2024).</p>
<p>Some of the methods by which NCPC committed financial misstatements include: - Cash on hand overstated by 29.944 billion, - Inventory understated by 19.546 billion - Operating income overstated by 8.898 billion - Operating cost overstated by 7.662 billion - Selling expenses understated by 0.497 billion - Management expenses understated by 0.228 billion</p>
<p>The net effect of these actions resulted in the overstatement of the net profit of NCPC, resulting in the overstatement of the company’s equity. The misstatements gave investors a false sense of confidence in investing in NCPC.</p>
</section>
<section id="kerala-ayurvedic-limited-kal" class="level3">
<h3 class="anchored" data-anchor-id="kerala-ayurvedic-limited-kal">Kerala Ayurvedic Limited (KAL)</h3>
<p>KAL is an Indian company specializing in the manufacturing and sale of Ayurvedic products, including therapeutic formulations, health supplements, skin and beauty care products, and specialty foods.</p>
<p>In February 2020, Tata Global Beverages Limited (TGBL) alleged that KAL defaulted on a financial debt amounting to ₹42.5 million (S$684,000). The National Company Law Tribunal (NCLT) acknowledged this claim (Times of India, 2020).</p>
<p>In May 2023, the Kerala Financial Corporation filed an Insolvency and Bankruptcy Code application against KAL, citing claims totaling approximately ₹286.4 million (S$4.64 million).</p>
<p>The net effect of both these legal cases is that it significantly increased the liabilities of KAL, hence vastly increasing the debt-to-equity ratio. A higher ratio, coupled with the reputational loss of KAL for not being able to pay off its debts, highlights the lack of financial prudence taken by the organisation to see if it can take on debts.</p>
</section>
<section id="pharmaniaga-berhad" class="level3">
<h3 class="anchored" data-anchor-id="pharmaniaga-berhad">Pharmaniaga Berhad</h3>
<p>Pharmaniaga is a pharmaceutical company based in Malaysia. In 2022, an independent audit by PwC showed that it was facing serious financial challenges. The group’s short-term debts surpassed its short-term assets by RM632.1 million, while the company reported a negative equity position of RM227.4 million. Large impairment of unsold COVID-19 vaccines worth RM552.3 million resulted in the group net loss amounting to RM85.47 million and sinking share price by 50% (Free Malaysia Today, 2023).</p>
<p>Just a single restatement of their expired vaccine inventory results in a drastic drop in the current ratio and a high net loss. These concerning financial indicators suggest Pharmaniaga may struggle to remain operational unless it undergoes restructuring or receives external financial assistance.</p>
</section>
<section id="indofarma-tbk-pt" class="level3">
<h3 class="anchored" data-anchor-id="indofarma-tbk-pt">IndoFarma Tbk PT</h3>
<p>IndoFarma is a state-owned manufacturer of medical supplies and medicines in Indonesia.</p>
<p>The financial manipulations involved their subsidiary, IndoFarma Global Medika. Indofarma’s financial problems were triggered by its subsidiary, PT Indofarma Global Medika (IGM), which led to state losses of Rp371.83 billion (US$23 million) (Indonesia Business Post, 2024).</p>
<p>IndoFarma manipulated financial reports, which included “window dressing” to improve the appearance of its financial health, involving the recording of fictitious sales while the company was facing financial troubles, leading to substantial losses.</p>
<p>The misstatements of the financial statements led to the loss of Rp371.83 billion, representing a significant blow to the state-owned company and the broader public sector. Furthermore, the fictitious reporting likely created a false impression of the company’s debt-to-equity ratio being healthy when it is not, resulting in poor decision-making by stakeholders, regulators, and investors.</p>
</section>
</section>
<section id="limitations" class="level2">
<h2 class="anchored" data-anchor-id="limitations">Limitations</h2>
<p>We faced the following three main limitations when embarking on this project:</p>
<section id="incomplete-data" class="level3">
<h3 class="anchored" data-anchor-id="incomplete-data">Incomplete Data</h3>
<p>Despite obtaining data from Wharton Research and Data Studies (WRDS), a reputable source in academic and financial research, there were still some empty cells when we first looked at the raw data. If we were to remove rows of data where there is even one cell of missing data, the number of observations left would be close to zero. Hence, we had to winsorise the data to make up for the missing data.</p>
</section>
<section id="varying-accounting-and-healthcare-standards" class="level3">
<h3 class="anchored" data-anchor-id="varying-accounting-and-healthcare-standards">Varying Accounting and Healthcare Standards</h3>
<p>Since the healthcare companies’ data we obtained covered many countries globally, this means that the different companies are subject to different regulations depending on where they operate. This is why we decided to use the most basic indicators that transcend boundaries like current ratio and debt-to-equity ratio to compare the financial health of companies in different countries. But differing audit and accounting standard in varying countries means that the threshold of an auditor requesting for restatement varies from country to country.</p>
</section>
<section id="larger-conglomerates" class="level3">
<h3 class="anchored" data-anchor-id="larger-conglomerates">Larger conglomerates</h3>
<p>Some of the companies in the data we obtained are part of the larger conglomerates, thus making it challenging to get a clear picture of its financial health. A key reason for this is due to internal transfers between different parts of the group being able to hide the true financial situation of the company and the group as a whole. This is especially true for multinational companies that move revenue and losses across borders to reduce taxes, making it difficult to accurately assess a company’s performance because they allow profits to be shifted to countries with lower tax rates and losses to be moved to countries with higher taxes. As a result, the financial data can be unclear, and the models we create may not fully reflect the company’s actual situation.</p>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<p>Acharya, V. V., Philippon, T., Richardson, M., &amp; Roubini, N. (2009). The financial crisis of 2007–2009: Causes and remedies. Journal of Corporate Finance, 15(3), 234–245. https://doi.org/10.1016/j.jcorpfin.2008.05.002</p>
<p>Asian Century Stocks. (n.d.). Simple tricks to spot fraud. Asian Century Stocks. Retrieved from https://www.asiancenturystocks.com/p/simple-tricks-to-spot-fraud</p>
<p>Berman, K., &amp; Knight, J. (2009, September 16). Lehman’s three big mistakes. Harvard Business Review.https://hbr.org/2009/09/lessons-from-lehman</p>
<p>Bhasin, M. L. (2013). Corporate accounting fraud: A case study of Satyam Computers Limited. Open Journal of Accounting, 2, 26–38. Available at SSRN: https://ssrn.com/abstract=2676467</p>
<p>BBC News. (2003, December 23). Parmalat’s Calisto Tanzi arrested. BBC News. Retrieved from http://news.bbc.co.uk/2/hi/business/3345735.stm</p>
<p>Center for Audit Quality. (2024, June). Financial restatement trends in the U.S.: 2013–2022. Center for Audit Quality. Retrieved from https://www.thecaq.org/financial-restatement-trends-us-2013-2022</p>
<p>Chen, J. (2023, April 12). Current ratio: What it is and what it tells you. Investopedia. Retrieved from https://www.investopedia.com/terms/c/currentratio.asp</p>
<p>Chen, Y., &amp; Li, J. (2022). Financial misstatements and market responses: The case of Kangmei Pharmaceutical. Journal of Accounting and Public Policy, 41(2), 115–132. https://doi.org/xxxx</p>
<p>Corporate Finance Institute. (n.d.). Altman’s Z-score model. Corporate Finance Institute. Retrieved from https://corporatefinanceinstitute.com/resources/commercial-lending/altmans-z-score-model/</p>
<p>Corporate Finance Institute. (n.d.). Debt schedule. Corporate Finance Institute. Retrieved from https://corporatefinanceinstitute.com/resources/financial-modeling/debt-schedule/</p>
<p>Corporate Finance Institute. (n.d.). Intangible assets. Corporate Finance Institute. Retrieved from https://corporatefinanceinstitute.com/resources/accounting/intangible-assets/</p>
<p>CSIMarket. (2024). Industry financial strength ratios: Biotechnology &amp; drugs industry. CSIMarket. Retrieved from https://csimarket.com/Industry/industry_Financial_Strength_Ratios.php?ind=1304</p>
<p>CSIMarket. (2024). Industry financial strength ratios: Regional banks industry. CSIMarket. Retrieved from https://csimarket.com/Industry/industry_Financial_Strength_Ratios.php?ind=804</p>
<p>Damodaran, A. (2025). Debt fund. NYU Stern School of Business. Retrieved from https://pages.stern.nyu.edu/~adamodar/New_Home_Page/datafile/dbtfund.html</p>
<p>Fabricant, F. (2002, April 24). AOL posts loss of $54 billion. The New York Times. Retrieved from https://www.nytimes.com/2002/04/24/business/aol-posts-loss-of-54-billion.html</p>
<p>Free Malaysia Today. (2023, February 28). Pharmaniaga shares plunge 43% after losses trigger PN17. Retrieved from https://www.freemalaysiatoday.com/category/highlight/2023/02/28/pharmaniaga-shares-plunge-43-after-losses-trigger-pn17/</p>
<p>FullRatio. (n.d.). Current ratio by industry. FullRatio. Retrieved from https://fullratio.com/current-ratio-by-industry</p>
<p>FullRatio. (n.d.). Debt to equity ratio by industry. FullRatio. Retrieved from https://fullratio.com/debt-to-equity-by-industry</p>
<p>Gelles, D., &amp; de la Merced, M. J. (2018, May 8). Valeant, Distancing Itself From Its Past, Will Change Its Name to Bausch Health. The New York Times. https://www.nytimes.com/2018/05/08/health/valeant-name-bausch-drugs.html</p>
<p>History.com. (2009). Enron files for bankruptcy. Retrieved from https://www.history.com/this-day-in-history/december-2/enron-files-for-bankruptcy</p>
<p>HG.org. (2023). 7 biggest healthcare fraud cases of 2023. HG.org Legal Resources. Retrieved from https://www.hg.org/legal-articles/7-biggest-healthcare-fraud-cases-of-2023</p>
<p>Inagaki, K. (2015, September 7). Toshiba slashes earnings for past 7 years. The Wall Street Journal. Retrieved from https://www.wsj.com/articles/toshiba-slashes-earnings-for-past-7-years-1441589473</p>
<p>Indonesia Business Post. (2024, May 21). BPK uncovers financial irregularities at PT Indofarma, resulting in state losses. Retrieved from https://indonesiabusinesspost.com/1959/Politics/bpk-uncovers-financial-irregularities-at-pt-indofarma-resulting-in-state-losses</p>
<p>Ingram, P. L., &amp; Malenko, N. (2022). The paradox of corporate debt growth: Valeant Pharmaceuticals and the limits of debt-financed acquisitions. Journal of Financial Economics, 143(2), 823-851.</p>
<p>Isidore, C. (2003, March 19). HealthSouth hit with SEC fraud charges. CNN Money. Retrieved from https://money.cnn.com/2003/03/19/news/companies/healthsouth/</p>
<p>Jabeen, S., &amp; Rani, R. (2024). Corporate accounting fraud: Causes, consequences and detection tools. In Proceedings of the 5th International Conference on Digital Data and Economy (ICDDE 2024) (Vol. 173, Article 01024). SHS Web of Conferences. https://www.shs-conferences.org/articles/shsconf/pdf/2024/08/shsconf_icdde2024_01024.pdf</p>
<p>JD Supra. (2024). Health care fraud and abuse: 2023 year in review. JD Supra. Retrieved from https://www.jdsupra.com/legalnews/health-care-fraud-and-abuse-2023-year-7533239</p>
<p>Kagan, J. (2023, February 9). Inventory turnover ratio: What it is, how it works, and formula. Investopedia. Retrieved from https://www.investopedia.com/terms/i/inventoryturnover.asp</p>
<p>Kagan, J. (2023, February 10). Revenue recognition: Principles, methods, and examples. Investopedia. Retrieved from https://www.investopedia.com/terms/r/revenuerecognition.asp</p>
<p>Kenton, W. (2023, March 2). WorldCom: What happened, and key facts. Investopedia. Retrieved from https://www.investopedia.com/terms/w/worldcom.asp</p>
<p>Kenton, W. (2023, March 5). Overvalued: What it means in investing. Investopedia. Retrieved from https://www.investopedia.com/terms/o/overvalued.asp</p>
<p>Kenton, W. (2023, March 21). Market capitalization: What it means and how it’s calculated. Investopedia. Retrieved from https://www.investopedia.com/terms/m/marketcapitalization.asp</p>
<p>Kenton, W. (2023, March 25). Research and development (R&amp;D): What it is, with examples. Investopedia. Retrieved from https://www.investopedia.com/terms/r/randd.asp</p>
<p>Kumar, S., &amp; Yamaoka, Y. (2008). Helicobacter pylori and gastric cancer. Biological Chemistry, 389(9), 1007–1014. https://www.sciencedirect.com/science/article/abs/pii/S0929119908000552</p>
<p>Marciukaityte, D., &amp; Varma, R. (2008). Consequences of overvalued equity: Evidence from earnings manipulation. Journal of Corporate Finance, 14(4), 418–430.</p>
<p>Maverick, J. B. (2025, March 20). Key financial ratios for pharmaceutical companies. Investopedia. Retrieved from https://www.investopedia.com/articles/financial-analysis/090616/key-financial-ratios-pharmaceutical-companies.asp</p>
<p>Murphy, C. B. (2023, February 26). Cash flow statement: What it is and how to read it. Investopedia. Retrieved from https://www.investopedia.com/terms/c/cashflowstatement.asp</p>
<p>Murphy, C. B. (2023, April 6). Property, plant, and equipment (PP&amp;E): What it is and how it works. Investopedia.Retrieved from https://www.investopedia.com/terms/p/ppe.asp</p>
<p>Nasr, J., &amp; Schuetze, A. (2020, June 25). ‘Total disaster’: Phantom billions plunge Wirecard into chaos. Reuters. Retrieved from https://www.reuters.com/article/technology/total-disaster-phantom-billions-plunge-wirecard-into-chaos-idUSKBN23T06V/</p>
<p>Public Company Accounting Oversight Board. (n.d.). AS 3101: The auditor’s report on an audit of financial statements. PCAOB. Retrieved from https://pcaobus.org/oversight/standards/auditing-standards/details/AS3101</p>
<p>Rathburn, T. (2023, January 12). Return on equity (ROE): Definition and how to calculate it. The Balance. Retrieved from https://www.thebalancemoney.com/return-on-equity-roe-357601</p>
<p>Rathburn, T. (2023, January 20). Selling, general &amp; administrative expenses (SG&amp;A): Definition. The Balance. Retrieved from https://www.thebalancemoney.com/selling-general-and-administrative-expenses-sga-357595</p>
<p>ReadyRatios. (2023). Health services: Industry financial ratios benchmarking. ReadyRatios. Retrieved from https://www.readyratios.com/sec/industry/80/</p>
<p>Securities and Exchange Commission. (2002). SEC Complaint No.&nbsp;17829. U.S. Securities and Exchange Commission.Retrieved from https://www.sec.gov/litigation/complaints/comp17829.htm Securities and Exchange Commission. (2020, December 4). SEC charges General Electric with disclosure failures. U.S. Securities and Exchange Commission. Retrieved from https://www.sec.gov/newsroom/press-releases/2020-319</p>
<p>Story, L., &amp; Morgenson, G. (2010, March 12). Lehman channeled risks through ‘alter ego’ firm. The New York Times.Retrieved from https://www.nytimes.com/2010/03/13/business/13lehman.html</p>
<p>Tan, A., &amp; Benoit, D. (2017, March 13). William Ackman’s Pershing Square Sold Stake in Valeant. The Wall Street Journal. https://www.wsj.com/articles/william-ackmans-pershing-square-sold-stake-in-valeant-1489439314</p>
<p>Times of India. (2020, March 17). NCLAT rejects Kerala Ayurveda’s plea. Retrieved from https://timesofindia.indiatimes.com/nclat-rejects-kerala-ayurvedas-plea/articleshow/74677720.cms</p>
<p>Transparently.AI. (n.d.). The Valeant scandal: A cautionary tale. Transparently.AI Blog. Retrieved from https://www.transparently.ai/blog/the-valeant-scandal</p>
<p>United States v. Holmes, No.&nbsp;5:18-cr-00258-EJD (N.D. Cal. 2022). Retrieved from https://en.wikipedia.org/wiki/United_States_v._Elizabeth_A._Holmes,_et_al</p>
<p>U.S. Department of Justice. (2022, January 3). Theranos founder Elizabeth Holmes found guilty of investor fraud. U.S. Department of Justice. Retrieved from https://www.justice.gov/usao-ndca/pr/theranos-founder-elizabeth-holmes-found-guilty-investor-fraud</p>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>